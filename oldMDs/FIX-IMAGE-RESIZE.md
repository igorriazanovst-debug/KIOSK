# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å ImageWidget

## –ü—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤–∏–¥–∂–µ—Ç–∞ "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ":
- ‚ùå –í–∏–¥–∂–µ—Ç —Ç–µ—Ä—è–ª –∑–∞–ª–∏–≤–∫—É —Ü–≤–µ—Ç–æ–º
- ‚ùå –û—Å—Ç–∞–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –≥–æ–ª—É–±–∞—è —Ä–∞–º–∫–∞
- ‚ùå –†–∞–∑–º–µ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –Ω–∞ 5x5

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≤–∏–¥–∂–µ—Ç
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –∫–ª–∏–∫–Ω—É—Ç—å
- ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
- ‚ùå –ù–µ–ª—å–∑—è –±—ã–ª–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å

## –ü—Ä–∏—á–∏–Ω—ã

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ä–∞–±–æ—Ç–µ Konva —Å Group-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:
1. `Group` –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥–∞ `width()` - –Ω—É–∂–Ω–æ –±—Ä–∞—Ç—å –∏–∑ `attrs`
2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 5x5 –±—ã–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `scaleX/scaleY` –¥–ª—è Group

### –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ `listening={false}` –Ω–∞ –≤—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö - —ç—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–∫–∞.

## –†–µ—à–µ–Ω–∏–µ ‚úÖ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω handleTransformEnd –≤ Canvas.tsx

**–ö–æ–¥:**
```typescript
const nodeWidth = node.width ? node.width() : node.attrs.width || 100;
const nodeHeight = node.height ? node.height() : node.attrs.height || 100;

let width = Math.max(10, nodeWidth * scaleX);
let height = Math.max(10, nodeHeight * scaleY);
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω –Ω–µ–≤–∏–¥–∏–º—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤ ImageWidget

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π `Rect` —Å–≤–µ—Ä—Ö—É –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏:

```typescript
<Group ...>
  {/* –ù–µ–≤–∏–¥–∏–º—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∫–ª–∏–∫–æ–≤ */}
  <Rect
    width={widget.width}
    height={widget.height}
    fill="transparent"
    listening={true}  // <-- –ö–õ–Æ–ß–ï–í–û–ï: —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–∫–∞—Ç—å
  />
  
  {/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å listening={false} */}
  <Rect ... listening={false} />
  <KonvaImage ... listening={false} />
</Group>
```

### 3. –£–≤–µ–ª–∏—á–µ–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–∏–¥–∂–µ—Ç–æ–≤: **10x10** –ø–∏–∫—Å–µ–ª–µ–π (–±—ã–ª–æ 5x5)

## –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å

### ‚ö° –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–∞—á–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–±:

- [‚¨áÔ∏è kiosk-content-platform.zip](computer:///mnt/user-data/outputs/kiosk-content-platform.zip) - –¥–ª—è Windows
- [‚¨áÔ∏è kiosk-content-platform.tar.gz](computer:///mnt/user-data/outputs/kiosk-content-platform.tar.gz) - –¥–ª—è Linux/macOS

**–®–∞–≥–∏:**
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä (Ctrl+C)
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã (—Ñ–∞–π–ª—ã .kiosk.json)
3. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É `kiosk-content-platform`
4. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –Ω–æ–≤—ã–π –∞—Ä—Ö–∏–≤
5. `npm install`
6. `npm run dev:editor`

### üîß –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Å—ë:

#### –§–∞–π–ª: `packages/editor/src/components/ImageWidget.tsx`

**–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ** - –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ–≤–∏–¥–∏–º—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤ –Ω–∞—á–∞–ª–æ Group:

```typescript
<Group
  ref={groupRef}
  id={widget.id}
  x={widget.x}
  y={widget.y}
  width={widget.width}
  height={widget.height}
  rotation={widget.rotation || 0}
  draggable
  onClick={onSelect}
  onTap={onSelect}
  onDragEnd={onDragEnd}
  onTransformEnd={handleTransform}
>
  {/* –î–û–ë–ê–í–¨–¢–ï –≠–¢–û - –Ω–µ–≤–∏–¥–∏–º—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –∫–ª–∏–∫–æ–≤ */}
  <Rect
    width={widget.width}
    height={widget.height}
    fill="transparent"
    listening={true}
  />

  {/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å */}
  {!image && (
    <Rect
      width={widget.width}
      height={widget.height}
      fill="#9b59b6"
      listening={false}  {/* –í–ê–ñ–ù–û: –æ—Å—Ç–∞–≤—å—Ç–µ false */}
    />
  )}
  
  {/* ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ... */}
</Group>
```

**–í–∞–∂–Ω–æ:** –ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ! –ù–µ–≤–∏–¥–∏–º—ã–π `Rect` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–ø–µ—Ä–≤—ã–º** –≤–Ω—É—Ç—Ä–∏ `Group`.

#### –§–∞–π–ª: `packages/editor/src/components/Canvas.tsx`

–£–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, –Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```typescript
const handleTransformEnd = (id: string, e: any) => {
  const node = e.target;
  const scaleX = node.scaleX();
  const scaleY = node.scaleY();

  node.scaleX(1);
  node.scaleY(1);

  const nodeWidth = node.width ? node.width() : node.attrs.width || 100;
  const nodeHeight = node.height ? node.height() : node.attrs.height || 100;

  let width = Math.max(10, nodeWidth * scaleX);
  let height = Math.max(10, nodeHeight * scaleY);
  // ... rest
};
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –¢–µ—Å—Ç 1: –í—ã–±–æ—Ä –≤–∏–¥–∂–µ—Ç–∞
1. –î–æ–±–∞–≤—å—Ç–µ –≤–∏–¥–∂–µ—Ç "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" –Ω–∞ —Ö–æ–ª—Å—Ç
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL –∏–ª–∏ —Ñ–∞–π–ª)
3. **–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –≤–∏–¥–∂–µ—Ç—É**
4. ‚úÖ –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–¥–µ–ª–∏—Ç—å—Å—è —Å–∏–Ω–µ–π —Ä–∞–º–∫–æ–π
5. ‚úÖ –°–ø—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤

### –¢–µ—Å—Ç 2: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –í—ã–¥–µ–ª–∏—Ç–µ –≤–∏–¥–∂–µ—Ç "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
2. –ü–æ—Ç—è–Ω–∏—Ç–µ –∑–∞ —É–≥–ª–æ–≤–æ–π —è–∫–æ—Ä—å (–º–∞—Ä–∫–µ—Ä)
3. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è
4. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∏–¥–∏–º—ã–º
5. ‚úÖ –†–∞–∑–º–µ—Ä –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

### –¢–µ—Å—Ç 3: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
1. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
2. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ
3. ‚úÖ –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è
4. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ –≤–Ω—É—Ç—Ä–∏ –≤–∏–¥–∂–µ—Ç–∞

**–ï—Å–ª–∏ –≤—Å–µ 3 —Ç–µ—Å—Ç–∞ –ø—Ä–æ–π–¥–µ–Ω—ã - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** üéâ

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–∫–∂–µ:
- –£–ª—É—á—à–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å crop –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ objectFit
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–∞–º–æ–∫
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

**–í–µ—Ä—Å–∏—è —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º:** 1.1.0  
**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
