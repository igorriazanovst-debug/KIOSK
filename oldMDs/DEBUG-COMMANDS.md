# üîç –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã 400 Bad Request

JSON –≤–∞–ª–∏–¥–Ω—ã–π, –Ω–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400. –ó–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º –∫–æ–¥–µ.

## –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É:

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ debug —Å–∫—Ä–∏–ø—Ç:
```bash
cd /opt/kiosk/packages/server
chmod +x debug-server.sh
./debug-server.sh > debug-output.txt 2>&1
cat debug-output.txt
```

### 2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
journalctl -u kiosk-server -n 50
```

**–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å:**
- `Error`
- `undefined`
- `Cannot read`
- `400`

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª routes/templates.js:
```bash
cat src/routes/templates.js
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª!**

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª routes/devices.js:
```bash
cat src/routes/devices.js
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª!**

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª index.js:
```bash
cat src/index.js | grep -A 5 "express.json"
cat src/index.js | grep -A 2 "app.use.*api"
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ body-parser:
```bash
grep -r "body-parser" src/
```

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ package.json:
```bash
cat package.json | grep -A 10 "dependencies"
```

---

## –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

### –ü—Ä–∏—á–∏–Ω–∞ 1: –ù–µ—Ç body-parser middleware
**–°–∏–º–ø—Ç–æ–º:** –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–∞—Ä—Å–∏—Ç JSON body
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** `grep "express.json" src/index.js`
**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `app.use(express.json())`

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è routes
**–°–∏–º–ø—Ç–æ–º:** Routes –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** `grep "app.use.*templates" src/index.js`
**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `app.use('/api/templates', templatesRouter)`

### –ü—Ä–∏—á–∏–Ω–∞ 3: Validation –æ—à–∏–±–∫–∞ –≤ route
**–°–∏–º–ø—Ç–æ–º:** Route –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å routes/templates.js
**–ò—Å–∫–∞—Ç—å:** –°—Ç—Ä–æ–∫–∏ —Å `if (!req.body...)` –∏–ª–∏ validation

### –ü—Ä–∏—á–∏–Ω–∞ 4: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ –≤ —Å—Ö–µ–º–µ
**–°–∏–º–ø—Ç–æ–º:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ö–∞–∫–∏–µ –ø–æ–ª—è —Ç—Ä–µ–±—É–µ—Ç route
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è

---

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç:

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –∑–∞–ø—Ä–æ—Å:

```bash
curl -v -X POST http://localhost:3001/api/templates \
  -H "Content-Type: application/json" \
  -d '{"name":"Test"}'
```

–ï—Å–ª–∏ —ç—Ç–æ —Ç–æ–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ middleware.
–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –∫–∞–∫–æ–µ-—Ç–æ –ø–æ–ª–µ –≤ –ø–æ–ª–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## –°—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å:

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:**
1. –í—ã–≤–æ–¥ `./debug-server.sh`
2. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `src/routes/templates.js`
3. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `src/routes/devices.js`
4. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤: `journalctl -u kiosk-server -n 50`

–° —ç—Ç–∏–º —è —Ç–æ—á–Ω–æ –Ω–∞–π–¥—É –ø—Ä–æ–±–ª–µ–º—É!
