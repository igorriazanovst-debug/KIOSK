import{r as je,d as Ve,g as Fe,b as S,u as Le,e as Xe,R as V,N as ge,B as Ge,f as Ye,h as re}from"./vendor-CAp4Hrcn.js";import{I as ie,G as J,R as W,S as De,a as G,E as $e,C as _e,T as $,L as ne,b as Ke,c as Je,d as Ze}from"./konva-CVeCxRDN.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))r(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(h){if(h.ep)return;h.ep=!0;const a=n(h);fetch(h.href,a)}})();var ce={exports:{}},se={};var be;function Qe(){if(be)return se;be=1;var t=je(),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,h=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(c,i,d){var p,x={},j=null,m=null;d!==void 0&&(j=""+d),i.key!==void 0&&(j=""+i.key),i.ref!==void 0&&(m=i.ref);for(p in i)r.call(i,p)&&!a.hasOwnProperty(p)&&(x[p]=i[p]);if(c&&c.defaultProps)for(p in i=c.defaultProps,i)x[p]===void 0&&(x[p]=i[p]);return{$$typeof:o,type:c,key:j,ref:m,props:x,_owner:h.current}}return se.Fragment=n,se.jsx=s,se.jsxs=s,se}var ke;function et(){return ke||(ke=1,ce.exports=Qe()),ce.exports}var e=et(),ae={},Se;function tt(){if(Se)return ae;Se=1;var t=Ve();return ae.createRoot=t.createRoot,ae.hydrateRoot=t.hydrateRoot,ae}var rt=tt();const st=Fe(rt);var nt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const it=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ot=(t,o)=>{const n=S.forwardRef(({color:r="currentColor",size:h=24,strokeWidth:a=2,absoluteStrokeWidth:s,children:c,...i},d)=>S.createElement("svg",{ref:d,...nt,width:h,height:h,stroke:r,strokeWidth:s?Number(a)*24/Number(h):a,className:`lucide lucide-${it(t)}`,...i},[...o.map(([p,x])=>S.createElement(p,x)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${t}`,n};var L=ot;const ve=L("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),at=L("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),lt=L("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),ct=L("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),dt=L("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),le=L("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),ht=L("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),pt=L("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Ce=L("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),ye=L("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),ut=L("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),xt=L("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),ft=L("Magnet",[["path",{d:"m6 15-4-4 6.75-6.77a7.79 7.79 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15",key:"1i3lhw"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}],["path",{d:"m12 15 4 4",key:"lnac28"}]]),gt=L("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),mt=L("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),me=L("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),jt=L("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),vt=L("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),yt=L("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]),bt=L("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),kt=L("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),St=L("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Oe=L("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ct=L("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Nt=L("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),wt=L("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Et=L("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),It=L("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),Be=L("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Tt=L("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Pt=L("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);class zt{logs=[];MAX_LOGS=100;log(o,n,r){const h={timestamp:new Date().toISOString(),level:o,message:n,details:r};this.logs.push(h),this.logs.length>this.MAX_LOGS&&this.logs.shift(),(o==="error"?console.error:o==="warn"?console.warn:console.log)(`[${o.toUpperCase()}] ${n}`,r||"")}info(o,n){this.log("info",o,n)}warn(o,n){this.log("warn",o,n)}error(o,n){this.log("error",o,n)}getLogs(){return[...this.logs]}clear(){this.logs=[]}export(){return JSON.stringify(this.logs,null,2)}}const D=new zt;class Wt{DEBUG_MODE=!1;DEBUG_INACTIVITY_MINUTES=3;baseUrl="";getBaseUrl(){return this.baseUrl}token=null;organizationName=null;plan=null;lastActivity=Date.now();inactivityTimer=null;warningTimer=null;INACTIVITY_TIMEOUT=this.DEBUG_MODE?this.DEBUG_INACTIVITY_MINUTES*60*1e3:3600*1e3;WARNING_TIME=this.DEBUG_MODE?(this.DEBUG_INACTIVITY_MINUTES-2)*60*1e3:3480*1e3;constructor(){this.loadToken(),this.startActivityMonitoring()}loadToken(){const o=sessionStorage.getItem("kiosk_auth_token");if(o)try{const n=JSON.parse(o),r=n.lastActivityTime||Date.now(),h=Date.now()-r;h<this.INACTIVITY_TIMEOUT?(this.token=n.token,this.organizationName=n.organizationName||null,this.plan=n.plan||null,this.lastActivity=Date.now(),this.updateActivityTime(),D.info("Token loaded from sessionStorage",{hasToken:!!this.token,organization:this.organizationName,plan:this.plan,inactiveDuration:Math.round(h/1e3)+"s"})):(D.warn("Session expired due to inactivity",{inactiveDuration:Math.round(h/1e3/60)+" minutes"}),this.clearToken())}catch(n){D.error("Failed to parse stored token",n),this.clearToken()}}saveToken(o,n,r){const h={token:o,organizationName:n,plan:r,lastActivityTime:Date.now(),savedAt:new Date().toISOString()};sessionStorage.setItem("kiosk_auth_token",JSON.stringify(h)),sessionStorage.setItem("kiosk_org_data",JSON.stringify({name:n,plan:r})),this.token=o,this.organizationName=n,this.plan=r,this.lastActivity=Date.now(),D.info("Token saved to sessionStorage",{organization:n,plan:r})}updateActivityTime(){const o=sessionStorage.getItem("kiosk_auth_token");if(o)try{const n=JSON.parse(o);n.lastActivityTime=Date.now(),sessionStorage.setItem("kiosk_auth_token",JSON.stringify(n))}catch(n){D.error("Failed to update activity time",n)}}clearToken(){sessionStorage.removeItem("kiosk_auth_token"),sessionStorage.removeItem("kiosk_org_data"),this.token=null,this.organizationName=null,this.plan=null,D.info("Token cleared from sessionStorage")}isAuthenticated(){return this.token!==null}getToken(){return this.token}getOrganizationData(){return{name:this.organizationName,plan:this.plan}}async loginWithLicense(o){D.info("Attempting login with license key");try{const n=await this.request("/api/auth/license",{method:"POST",body:JSON.stringify({licenseKey:o})});return n.token&&n.license&&(this.saveToken(n.token,n.license.organizationName,n.license.plan),D.info("Login successful",{organization:n.license.organizationName,plan:n.license.plan})),n}catch(n){throw D.error("Login failed",n),n}}async refreshToken(){D.info("Refreshing token");try{const o=await this.request("/api/auth/refresh",{method:"POST",authenticated:!0});return o.token&&o.license&&(this.saveToken(o.token,o.license.organizationName,o.license.plan),D.info("Token refreshed successfully")),o}catch(o){throw D.error("Token refresh failed",o),o}}async verifyToken(){try{return await this.request("/api/auth/verify",{method:"GET",authenticated:!0}),D.info("Token verified successfully"),!0}catch(o){return D.warn("Token verification failed",o),this.clearToken(),!1}}logout(){D.info("User logout"),this.clearToken(),this.stopActivityMonitoring(),window.dispatchEvent(new CustomEvent("auth:logout"))}updateActivity(){this.lastActivity=Date.now(),this.updateActivityTime(),this.resetTimers()}resetTimers(){this.warningTimer&&clearTimeout(this.warningTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer=setTimeout(()=>{D.warn("Inactivity warning - 2 minutes until logout"),window.dispatchEvent(new CustomEvent("auth:inactivity-warning",{detail:{timeRemaining:120*1e3}}))},this.WARNING_TIME),this.inactivityTimer=setTimeout(()=>{D.warn("Session expired due to inactivity"),this.logout()},this.INACTIVITY_TIMEOUT)}startActivityMonitoring(){if(!this.isAuthenticated())return;["mousemove","keypress","click","scroll","touchstart"].forEach(n=>{window.addEventListener(n,()=>this.updateActivity(),{passive:!0})}),this.resetTimers(),D.info("Activity monitoring started",{timeout:this.INACTIVITY_TIMEOUT/1e3/60+" minutes",warning:this.WARNING_TIME/1e3/60+" minutes"})}stopActivityMonitoring(){this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null),this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),D.info("Activity monitoring stopped")}async getProjects(o){const n=new URLSearchParams;o?.search&&n.append("search",o.search),o?.tags&&n.append("tags",o.tags.join(",")),o?.isPublished!==void 0&&n.append("isPublished",String(o.isPublished)),o?.page&&n.append("page",String(o.page)),o?.limit&&n.append("limit",String(o.limit));const r=n.toString(),h=`/api/projects${r?"?"+r:""}`;return this.request(h,{method:"GET",authenticated:!0})}async createProject(o){return(await this.request("/api/projects",{method:"POST",authenticated:!0,body:JSON.stringify(o)})).project}async getProject(o){return(await this.request(`/api/projects/${o}`,{method:"GET",authenticated:!0})).project}async updateProject(o,n){return(await this.request(`/api/projects/${o}`,{method:"PUT",authenticated:!0,body:JSON.stringify(n)})).project}async deleteProject(o){await this.request(`/api/projects/${o}`,{method:"DELETE",authenticated:!0})}async getProjectFiles(o){return(await this.request(`/api/projects/${o}/files`,{method:"GET",authenticated:!0})).files}async uploadFile(o,n,r){const h=new FormData;return h.append("file",n),new Promise((a,s)=>{const c=new XMLHttpRequest;r&&c.upload.addEventListener("progress",i=>{if(i.lengthComputable){const d=i.loaded/i.total*100;r(d)}}),c.addEventListener("load",()=>{if(c.status===200||c.status===201)try{const i=JSON.parse(c.responseText);a(i.file||i)}catch{s(new Error("Failed to parse response"))}else try{const i=JSON.parse(c.responseText);s(new Error(i.message||`Upload failed: ${c.status}`))}catch{s(new Error(`Upload failed: ${c.status}`))}}),c.addEventListener("error",()=>{s(new Error("Network error"))}),c.open("POST",`/api/projects/${o}/files`),this.token&&c.setRequestHeader("Authorization",`Bearer ${this.token}`),c.send(h)})}async downloadFile(o,n){const r=await fetch(`/api/projects/${o}/files/${n}`,{method:"GET",headers:this.token?{Authorization:`Bearer ${this.token}`}:{}});if(!r.ok)throw new Error(`Download failed: ${r.status}`);return r.blob()}async deleteFile(o,n){await this.request(`/api/projects/${o}/files/${n}`,{method:"DELETE",authenticated:!0})}async getStorageStats(){return this.request("/api/storage/stats",{method:"GET",authenticated:!0})}async request(o,n){const r=`${this.baseUrl}${o}`,h={"Content-Type":"application/json"};n.authenticated&&this.token&&(h.Authorization=`Bearer ${this.token}`);try{const a=await fetch(r,{method:n.method,headers:h,body:n.body});if(n.authenticated&&a.ok&&this.updateActivity(),!a.ok){if(a.status===401)throw D.warn("Unauthorized - clearing token"),this.clearToken(),window.dispatchEvent(new CustomEvent("auth:unauthorized")),new Error("Unauthorized");const s=await a.json().catch(()=>({}));throw new Error(s.message||`HTTP ${a.status}`)}return await a.json()}catch(a){throw D.error("Request failed",{endpoint:o,method:n.method,error:a}),a}}}const H=new Wt,Rt=()=>{const t=Le(),[o,n]=S.useState(""),[r,h]=S.useState(!1),[a,s]=S.useState(null);S.useEffect(()=>{const m=sessionStorage.getItem("kiosk_logout_reason");m==="inactivity"?(i("Вы были автоматически выведены из системы из-за неактивности"),D.info("Logout reason: inactivity")):m==="session_expired"&&(i("Ваша сессия истекла. Пожалуйста, войдите снова"),D.info("Logout reason: session expired")),sessionStorage.removeItem("kiosk_logout_reason"),m&&setTimeout(()=>i(null),5e3)},[]);const[c,i]=S.useState(null),d=m=>(m.replace(/[^A-Z0-9]/gi,"").toUpperCase().match(/.{1,4}/g)||[]).join("-").substring(0,19),p=m=>{const k=d(m.target.value);n(k),s(null)},x=async m=>{if(m.preventDefault(),o.length<19){s("Введите полный ключ лицензии (16 символов)");return}h(!0),s(null);try{console.log("[LoginPage] Attempting login");const k=await H.loginWithLicense(o);console.log("[LoginPage] Login successful, redirecting to /editor"),t("/editor",{replace:!0})}catch(k){console.error("[LoginPage] Login failed:",k),s(k.message||"Не удалось выполнить вход. Проверьте ключ лицензии."),h(!1)}},j=m=>{m.preventDefault();const k=m.clipboardData.getData("text"),b=d(k);n(b)};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-header",children:[e.jsx(Ce,{size:48,className:"login-icon"}),e.jsx("h1",{children:"Kiosk Editor"}),e.jsx("p",{children:"Вход в систему"})]}),e.jsxs("form",{onSubmit:x,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"licenseKey",children:"Ключ лицензии"}),e.jsx("input",{type:"text",id:"licenseKey",placeholder:"XXXX-XXXX-XXXX-XXXX",value:o,onChange:p,onPaste:j,disabled:r,autoFocus:!0,maxLength:19,className:a?"error":""}),e.jsx("span",{className:"input-hint",children:"Формат: 4 группы по 4 символа"})]}),a&&e.jsxs("div",{className:"error-message",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:a})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:r||o.length<19,children:r?e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:20,className:"spinner"}),e.jsx("span",{children:"Вход..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{size:20}),e.jsx("span",{children:"Войти"})]})})]}),e.jsxs("div",{className:"test-keys",children:[e.jsx("p",{children:"Тестовые ключи:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"BASIC:"})," ",e.jsx("code",{children:"EWZA-E5LJ-Z558-9LUQ"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PRO:"})," ",e.jsx("code",{children:"3VBN-8ZQ9-1MKO-AK0R"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"MAX:"})," ",e.jsx("code",{children:"T8MH-FJE3-ETAC-YOZF"})]})]})]})]})})};function Ne(t,o,n,r=0,h=!1){const a=o/2,s=n/2,c=Math.min(o,n)/2,i=(p,x)=>h?`${p.toFixed(1)}px ${x.toFixed(1)}px`:`${(p/o*100).toFixed(1)}% ${(x/n*100).toFixed(1)}%`,d=(p,x=-Math.PI/2)=>{const j=[];for(let m=0;m<p;m++){const k=x+2*Math.PI*m/p;j.push(i(a+c*Math.cos(k),s+c*Math.sin(k)))}return`polygon(${j.join(", ")})`};switch(t){case"circle":return h?`circle(${c.toFixed(1)}px at ${a.toFixed(1)}px ${s.toFixed(1)}px)`:`circle(${c}px at ${a}px ${s}px)`;case"ellipse":return h?`ellipse(${(o/2).toFixed(1)}px ${(n/2).toFixed(1)}px at ${a.toFixed(1)}px ${s.toFixed(1)}px)`:"ellipse(50% 50% at 50% 50%)";case"triangle":return`polygon(${[-Math.PI/2,Math.PI/6,5*Math.PI/6].map(j=>i(a+c*Math.cos(j),s+c*Math.sin(j))).join(", ")})`;case"diamond":return`polygon(${i(a,0)}, ${i(o,s)}, ${i(a,n)}, ${i(0,s)})`;case"pentagon":return d(5);case"hexagon":return d(6);case"octagon":return d(8);case"star":{const p=[];for(let x=0;x<10;x++){const j=x*Math.PI/5-Math.PI/2,m=x%2===0?c:c*.5;p.push(i(a+m*Math.cos(j),s+m*Math.sin(j)))}return`polygon(${p.join(", ")})`}default:return}}const Mt=({widgetId:t,commonStyle:o,items:n,isHorizontal:r,backgroundColor:h,textColor:a,hoverColor:s,fontSize:c,fontFamily:i,itemPadding:d,itemHeight:p,submenuBackgroundColor:x,submenuTextColor:j,borderWidth:m,borderColor:k,executeActions:b})=>{const[u,g]=S.useState(null),[N,I]=S.useState(null),y={...o,backgroundColor:h,display:"flex",flexDirection:r?"row":"column",border:m>0?`${m}px solid ${k}`:"none",overflow:"visible",position:"absolute"},w=l=>({display:"flex",alignItems:"center",padding:`0 ${d}px`,height:`${p}px`,minWidth:r?"auto":"100%",color:u===l?j:a,backgroundColor:u===l?s:"transparent",fontSize:`${c}px`,fontFamily:i,cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",transition:"background-color 0.15s",position:"relative",boxSizing:"border-box"}),E=l=>({display:N===l?"flex":"none",flexDirection:"column",position:"absolute",top:r?`${p}px`:"0",left:r?"0":"100%",backgroundColor:x,zIndex:9999,minWidth:"150px",boxShadow:"2px 4px 12px rgba(0,0,0,0.4)"});return e.jsx("div",{"data-widget-id":t,style:y,children:n.map(l=>{const v=l.children&&l.children.length>0;return e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>{g(l.id),v&&I(l.id)},onMouseLeave:()=>{g(null),v&&I(null)},children:[e.jsxs("div",{style:w(l.id),onClick:()=>{l.actions&&l.actions.length>0&&b(l.actions)},children:[l.label,v&&e.jsx("span",{style:{marginLeft:"6px",fontSize:"10px",opacity:.7},children:r?"▼":"▶"})]}),v&&e.jsx("div",{style:E(l.id),children:l.children.map(f=>e.jsx("div",{style:{padding:`0 ${d}px`,height:`${p}px`,display:"flex",alignItems:"center",color:u===f.id?a:j,backgroundColor:u===f.id?s:"transparent",fontSize:`${c-2}px`,fontFamily:i,cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",transition:"background-color 0.15s"},onMouseEnter:()=>g(f.id),onMouseLeave:()=>g(null),onClick:()=>{f.actions&&f.actions.length>0&&b(f.actions)},children:f.label},f.id))})]},l.id)})})},At=()=>{const[t]=Xe(),o=t.get("projectId"),[n,r]=S.useState(null),[h,a]=S.useState(!0),[s,c]=S.useState(null),[i,d]=S.useState(!1),[p,x]=S.useState(null),[j,m]=S.useState(new Set);S.useEffect(()=>{if(!o){c("Project ID not provided"),a(!1);return}(async()=>{try{const g=await H.getProject(o),N={id:g.id,version:"1.0",name:g.name,canvas:{width:g.canvasWidth,height:g.canvasHeight,backgroundColor:g.canvasBackground},widgets:g.projectData?.widgets||[]};r(N)}catch(g){c(g.message||"Failed to load project")}finally{a(!1)}})()},[o]),S.useEffect(()=>{const u=g=>{g.key==="Escape"&&(i?d(!1):window.close())};return document.documentElement.requestFullscreen?.().catch(()=>{}),window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[i]);const k=u=>{u.forEach(g=>{switch(g.type){case"url":g.url&&(g.openInNewTab?window.open(g.url,"_blank"):window.location.href=g.url);break;case"popup":x({title:g.popupTitle||"Информация",content:g.popupContent||"",width:g.popupWidth||400,height:g.popupHeight||300}),d(!0);break;case"widget_show":g.targetWidgetId&&m(N=>{const I=new Set(N);return I.delete(g.targetWidgetId),I});break;case"widget_hide":g.targetWidgetId&&m(N=>new Set(N).add(g.targetWidgetId));break;case"video_play":if(g.targetWidgetId){const N=document.querySelector(`[data-widget-id="${g.targetWidgetId}"] video`);N&&N.play()}break;case"video_stop":if(g.targetWidgetId){const N=document.querySelector(`[data-widget-id="${g.targetWidgetId}"] video`);N&&(N.pause(),N.currentTime=0)}break}})},b=u=>{if(j.has(u.id))return null;const g=u.events,N=()=>{g&&g.filter(y=>y.trigger==="click").forEach(y=>k(y.actions))},I={position:"absolute",left:u.x,top:u.y,width:u.width,height:u.height,transform:u.rotation?`rotate(${u.rotation}deg)`:void 0,transformOrigin:"top left",cursor:g&&g.some(y=>y.trigger==="click")?"pointer":"default",zIndex:u.zIndex||0};if(u.type==="shape"){const{shapeType:y="rectangle",fillColor:w="#4a90e2",strokeColor:E="#000000",strokeWidth:l=0,cornerRadius:v=0,opacity:f=1}=u.properties,C=Ne(y,u.width,u.height,v),M=C!==void 0,F=y==="circle"?"50%":y==="rounded-rectangle"||y==="rectangle"?`${v}px`:void 0;if(M&&l>0){const P=(u.width-l*4)/u.width,z=(u.height-l*4)/u.height;return e.jsxs("div",{"data-widget-id":u.id,style:{...I,opacity:f},onClick:N,children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:E,clipPath:C,WebkitClipPath:C}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:w,clipPath:C,WebkitClipPath:C,transform:`scale(${P}, ${z})`}})]},u.id)}return M?e.jsx("div",{"data-widget-id":u.id,style:{...I,backgroundColor:w,clipPath:C,WebkitClipPath:C,opacity:f},onClick:N},u.id):e.jsx("div",{"data-widget-id":u.id,style:{...I,backgroundColor:w,border:l>0?`${l}px solid ${E}`:"none",borderRadius:F,opacity:f},onClick:N},u.id)}if(u.type==="text"){const{text:y="Text",fontSize:w=24,color:E="#000000",fontFamily:l="Arial",fontWeight:v="normal",textAlign:f="left",verticalAlign:C="top",backgroundColor:M="transparent"}=u.properties;return e.jsx("div",{"data-widget-id":u.id,style:{...I,fontSize:`${w}px`,color:E,fontFamily:l,fontWeight:v,backgroundColor:M,textAlign:f,display:"flex",alignItems:C==="middle"?"center":C==="bottom"?"flex-end":"flex-start",whiteSpace:"pre-wrap",wordWrap:"break-word"},onClick:N,children:y},u.id)}if(u.type==="image"){const{src:y="",objectFit:w="contain",opacity:E=1,clipShape:l="rectangle",cornerRadius:v=0,borderEnabled:f=!1,borderWidth:C=2,borderColor:M="#000000"}=u.properties;if(!y)return null;const F=l&&l!=="rectangle",P=F?Ne(l,u.width,u.height,v):void 0,z=F?"cover":w,A=l==="rounded-rectangle"&&v?`${v}px`:void 0;if(F&&f&&C>0){const T=(u.width-C*4)/u.width,R=(u.height-C*4)/u.height;return e.jsxs("div",{"data-widget-id":u.id,style:{...I,opacity:E},onClick:N,children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:M,clipPath:P,WebkitClipPath:P}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",clipPath:P,WebkitClipPath:P,transform:`scale(${T}, ${R})`},children:e.jsx("img",{src:y,alt:"",style:{width:"100%",height:"100%",objectFit:z}})})]},u.id)}return e.jsx("div",{"data-widget-id":u.id,style:{...I,opacity:E,borderRadius:A,overflow:"hidden",clipPath:P,WebkitClipPath:P,border:f&&C>0&&!F?`${C}px solid ${M}`:void 0},onClick:N,children:e.jsx("img",{src:y,alt:"",style:{width:"100%",height:"100%",objectFit:z}})},u.id)}if(u.type==="video"){const{src:y="",autoplay:w=!1,loop:E=!1,muted:l=!0,objectFit:v="contain"}=u.properties;return y?e.jsx("div",{"data-widget-id":u.id,style:I,onClick:N,children:e.jsx("video",{src:y,autoPlay:w,loop:E,muted:l,style:{width:"100%",height:"100%",objectFit:v}})},u.id):null}if(u.type==="button"){const{text:y="Button",backgroundColor:w="#4a90e2",textColor:E="#ffffff",fontSize:l=16,fontFamily:v="Arial",fontWeight:f="normal",textAlign:C="center",borderRadius:M=4,borderWidth:F=0,borderColor:P="#000000",borderStyle:z="solid",paddingX:A=16,paddingY:T=8,shadowEnabled:R=!1,shadowColor:O="#000000",shadowBlur:B=10,shadowOffsetX:q=0,shadowOffsetY:_=4,shadowOpacity:Y=.3}=u.properties;return e.jsx("div",{"data-widget-id":u.id,style:{...I,backgroundColor:w,color:E,fontSize:`${l}px`,fontFamily:v,fontWeight:f,borderRadius:`${M}px`,border:F>0?`${F}px ${z} ${P}`:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",userSelect:"none",boxShadow:R?`${q}px ${_}px ${B}px ${O}${Math.round(Y*255).toString(16).padStart(2,"0")}`:void 0},onClick:N,children:y},u.id)}if(u.type==="menu"){const{items:y=[],orientation:w="horizontal",backgroundColor:E="#2c3e50",textColor:l="#ffffff",hoverColor:v="#34495e",fontSize:f=16,fontFamily:C="Arial",itemPadding:M=16,itemHeight:F=40,submenuBackgroundColor:P="#34495e",submenuTextColor:z="#ffffff",borderWidth:A=0,borderColor:T="#000000"}=u.properties;return e.jsx(Mt,{widgetId:u.id,commonStyle:I,items:y,isHorizontal:w==="horizontal",backgroundColor:E,textColor:l,hoverColor:v,fontSize:f,fontFamily:C,itemPadding:M,itemHeight:F,submenuBackgroundColor:P,submenuTextColor:z,borderWidth:A,borderColor:T,executeActions:k},u.id)}return null};return h?e.jsx("div",{className:"preview-page preview-loading",children:e.jsx("div",{className:"loading-spinner"})}):s||!n?e.jsx("div",{className:"preview-page preview-error",children:e.jsx("p",{children:s||"Проект не найден"})}):e.jsxs("div",{className:"preview-page",children:[e.jsx("div",{className:"preview-canvas",style:{width:n.canvas.width,height:n.canvas.height,backgroundColor:n.canvas.backgroundColor||"#ffffff",position:"relative"},children:n.widgets.slice().sort((u,g)=>(u.zIndex||0)-(g.zIndex||0)).map(u=>b(u))}),i&&p&&e.jsx("div",{className:"preview-popup-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"preview-popup",style:{width:p.width,maxHeight:p.height},onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"preview-popup-header",children:[e.jsx("h3",{children:p.title}),e.jsx("button",{onClick:()=>d(!1),children:"×"})]}),e.jsx("div",{className:"preview-popup-content",children:p.content})]})})]})},Ft=()=>{const[t,o]=S.useState(!1),[n,r]=S.useState(120);if(S.useEffect(()=>{const s=()=>{o(!0),r(120)},c=()=>{o(!1)},i=()=>{t&&o(!1)};window.addEventListener("auth:inactivity-warning",s),window.addEventListener("auth:logout",c);const d=["mousemove","keypress","click","scroll","touchstart"];return d.forEach(p=>{window.addEventListener(p,i)}),()=>{window.removeEventListener("auth:inactivity-warning",s),window.removeEventListener("auth:logout",c),d.forEach(p=>{window.removeEventListener(p,i)})}},[t]),S.useEffect(()=>{if(!t)return;const s=setInterval(()=>{r(c=>c<=1?(o(!1),0):c-1)},1e3);return()=>clearInterval(s)},[t]),!t)return null;const h=Math.floor(n/60),a=n%60;return e.jsx("div",{className:"inactivity-warning-overlay",children:e.jsxs("div",{className:"inactivity-warning",children:[e.jsx("div",{className:"warning-icon",children:"⏱️"}),e.jsx("h3",{children:"Сессия скоро истечёт"}),e.jsxs("p",{children:["Вы будете автоматически выведены из системы через"," ",e.jsxs("strong",{children:[h,":",a.toString().padStart(2,"0")]})]}),e.jsx("p",{className:"hint",children:"Нажмите любую клавишу или кликните мышью, чтобы продолжить работу"}),e.jsx("button",{className:"continue-btn",onClick:()=>o(!1),children:"Продолжить работу"})]})})},Lt={},we=t=>{let o;const n=new Set,r=(p,x)=>{const j=typeof p=="function"?p(o):p;if(!Object.is(j,o)){const m=o;o=x??(typeof j!="object"||j===null)?j:Object.assign({},o,j),n.forEach(k=>k(o,m))}},h=()=>o,i={setState:r,getState:h,getInitialState:()=>d,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(Lt?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},d=o=t(r,h,i);return i},Dt=t=>t?we(t):we;var de={exports:{}},he={},pe={exports:{}},ue={};var Ee;function $t(){if(Ee)return ue;Ee=1;var t=je();function o(x,j){return x===j&&(x!==0||1/x===1/j)||x!==x&&j!==j}var n=typeof Object.is=="function"?Object.is:o,r=t.useState,h=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function c(x,j){var m=j(),k=r({inst:{value:m,getSnapshot:j}}),b=k[0].inst,u=k[1];return a(function(){b.value=m,b.getSnapshot=j,i(b)&&u({inst:b})},[x,m,j]),h(function(){return i(b)&&u({inst:b}),x(function(){i(b)&&u({inst:b})})},[x]),s(m),m}function i(x){var j=x.getSnapshot;x=x.value;try{var m=j();return!n(x,m)}catch{return!0}}function d(x,j){return j()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:c;return ue.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:p,ue}var Ie;function _t(){return Ie||(Ie=1,pe.exports=$t()),pe.exports}var Te;function Ot(){if(Te)return he;Te=1;var t=je(),o=_t();function n(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var r=typeof Object.is=="function"?Object.is:n,h=o.useSyncExternalStore,a=t.useRef,s=t.useEffect,c=t.useMemo,i=t.useDebugValue;return he.useSyncExternalStoreWithSelector=function(d,p,x,j,m){var k=a(null);if(k.current===null){var b={hasValue:!1,value:null};k.current=b}else b=k.current;k=c(function(){function g(E){if(!N){if(N=!0,I=E,E=j(E),m!==void 0&&b.hasValue){var l=b.value;if(m(l,E))return y=l}return y=E}if(l=y,r(I,E))return l;var v=j(E);return m!==void 0&&m(l,v)?(I=E,l):(I=E,y=v)}var N=!1,I,y,w=x===void 0?null:x;return[function(){return g(p())},w===null?void 0:function(){return g(w())}]},[p,x,j,m]);var u=h(d,k[0],k[1]);return s(function(){b.hasValue=!0,b.value=u},[u]),i(u),u},he}var Pe;function Bt(){return Pe||(Pe=1,de.exports=Ot()),de.exports}var Ht=Bt();const Ut=Fe(Ht),He={},{useDebugValue:qt}=V,{useSyncExternalStoreWithSelector:Vt}=Ut;let ze=!1;const Xt=t=>t;function Gt(t,o=Xt,n){(He?"production":void 0)!=="production"&&n&&!ze&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ze=!0);const r=Vt(t.subscribe,t.getState,t.getServerState||t.getInitialState,o,n);return qt(r),r}const We=t=>{(He?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof t=="function"?Dt(t):t,n=(r,h)=>Gt(o,r,h);return Object.assign(n,o),n},Yt=t=>t?We(t):We;let te=null;function X(t,o=18e4){te&&clearTimeout(te),te=setTimeout(async()=>{try{console.log("[Editor] Auto-saving project..."),await t(),console.log("[Editor] Auto-save completed")}catch(n){console.error("[Editor] Auto-save failed:",n)}},o)}function Ue(){te&&(clearTimeout(te),te=null)}function xe(t){t?(sessionStorage.setItem("kiosk_current_project_id",t),console.log("[Editor] Current project ID saved:",t)):(sessionStorage.removeItem("kiosk_current_project_id"),console.log("[Editor] Current project ID cleared"))}function Kt(){const t=sessionStorage.getItem("kiosk_current_project_id");return t&&console.log("[Editor] Restoring project ID:",t),t}const U=Yt((t,o)=>({project:{version:"1.0.0",name:"Новый проект",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,isLoading:!1,isSaving:!1,lastSaved:null,saveError:null,selectedWidgetIds:[],clipboard:[],history:{past:[],future:[]},zoom:1,gridEnabled:!0,snapToGrid:!0,gridSize:20,gridLineWidth:1,gridColor:"#e0e0e0",pendingWidget:null,restoreProject:async()=>{const n=Kt();if(n)try{return console.log("[Editor] Restoring last opened project:",n),await o().loadProject(n),!0}catch(r){return console.error("[Editor] Failed to restore project:",r),xe(null),!1}return!1},createProject:async(n,r)=>{t({isLoading:!0,saveError:null});try{const h={version:"1.0",name:n,canvas:r,widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},a=await H.createProject({name:n,canvasWidth:r.width,canvasHeight:r.height,canvasBackground:r.backgroundColor||"#1a1a1a",projectData:h});t({project:{...h,id:a.id},projectId:a.id,isLoading:!1,lastSaved:new Date,history:{past:[],future:[]}}),console.log("[Editor] Project created:",a.id),xe(a.id),X(o().saveProject)}catch(h){throw console.error("[Editor] Failed to create project:",h),t({isLoading:!1,saveError:h.message||"Failed to create project"}),h}},loadProject:async n=>{t({isLoading:!0,saveError:null});try{const r=await H.getProject(n),h={id:r.id,version:"1.0",name:r.name,canvas:{width:r.canvasWidth,height:r.canvasHeight,backgroundColor:r.canvasBackground},widgets:r.projectData?.widgets||[],metadata:{createdAt:r.createdAt,updatedAt:r.updatedAt}};t({project:h,projectId:r.id,isLoading:!1,lastSaved:new Date(r.updatedAt),history:{past:[],future:[]}}),console.log("[Editor] Project loaded:",n),xe(n),X(o().saveProject)}catch(r){throw console.error("[Editor] Failed to load project:",r),t({isLoading:!1,saveError:r.message||"Failed to load project"}),r}},saveProject:async()=>{const{project:n,projectId:r,isSaving:h}=o();if(!n||!r){console.warn("[Editor] No project to save");return}if(h){console.warn("[Editor] Save already in progress");return}t({isSaving:!0,saveError:null});try{await H.updateProject(r,{name:n.name,projectData:n,canvasWidth:n.canvas.width,canvasHeight:n.canvas.height,canvasBackground:n.canvas.backgroundColor}),t({isSaving:!1,lastSaved:new Date,saveError:null}),console.log("[Editor] Project saved:",r)}catch(a){throw console.error("[Editor] Failed to save project:",a),t({isSaving:!1,saveError:a.message||"Failed to save project"}),a}},deleteProject:async n=>{try{await H.deleteProject(n),o().projectId===n&&(t({project:{version:"1.0.0",name:"Новый проект",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,selectedWidgetIds:[],history:{past:[],future:[]}}),Ue()),console.log("[Editor] Project deleted:",n)}catch(r){throw console.error("[Editor] Failed to delete project:",r),r}},savePreviewSnapshot:async()=>{const{project:n}=o();if(!n)throw new Error("No project to preview");console.log("[Editor] Creating preview snapshot...");try{const r=`_preview_${n.name}_${Date.now()}`,h=await H.createProject({name:r,canvasWidth:n.canvas.width,canvasHeight:n.canvas.height,canvasBackground:n.canvas.backgroundColor||"#1a1a1a",projectData:n});return console.log("[Editor] Preview snapshot created:",h.id),h.id}catch(r){throw console.error("[Editor] Failed to create preview snapshot:",r),r}},updateProjectMetadata:n=>{const{project:r}=o();r&&(t({project:{...r,...n,metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),X(o().saveProject))},addWidget:n=>{const{project:r}=o();r&&(o().saveToHistory(),t({project:{...r,widgets:[...r.widgets,n],metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),X(o().saveProject))},setPendingWidget:(n,r)=>{t({pendingWidget:{type:n,defaultProps:r}})},clearPendingWidget:()=>{t({pendingWidget:null})},addWidgetAtPosition:(n,r)=>{const{pendingWidget:h,project:a,snapToGrid:s,gridSize:c}=o();if(!h||!a)return;let i=n,d=r;s&&(i=Math.round(n/c)*c,d=Math.round(r/c)*c);const x={shape:{width:200,height:200},button:{width:200,height:60},text:{width:300,height:100},image:{width:300,height:200},video:{width:640,height:360},menu:{width:600,height:40}}[h.type]||{width:200,height:100},j=h.defaultProps.width||x.width,m=h.defaultProps.height||x.height;i=i-j/2,d=d-m/2;const{width:k,height:b,...u}=h.defaultProps,g={id:`widget-${Date.now()}-${Math.random()}`,type:h.type,x:Math.max(0,i),y:Math.max(0,d),width:j,height:m,zIndex:0,properties:u};o().addWidget(g),o().clearPendingWidget()},updateWidget:(n,r)=>{const{project:h}=o();h&&(t({project:{...h,widgets:h.widgets.map(a=>a.id===n?{...a,...r}:a),metadata:{...h.metadata,updatedAt:new Date().toISOString()}}}),X(o().saveProject))},deleteWidget:n=>{const{project:r}=o();r&&(o().saveToHistory(),t({project:{...r,widgets:r.widgets.filter(h=>h.id!==n),metadata:{...r.metadata,updatedAt:new Date().toISOString()}},selectedWidgetIds:o().selectedWidgetIds.filter(h=>h!==n)}),X(o().saveProject))},duplicateWidget:n=>{const{project:r}=o();if(!r)return;const h=r.widgets.find(s=>s.id===n);if(!h)return;const a={...h,id:`widget-${Date.now()}`,x:h.x+20,y:h.y+20};o().addWidget(a)},selectWidget:(n,r=!1)=>{const{selectedWidgetIds:h}=o();r?h.includes(n)?t({selectedWidgetIds:h.filter(a=>a!==n)}):t({selectedWidgetIds:[...h,n]}):t({selectedWidgetIds:[n]})},clearSelection:()=>{t({selectedWidgetIds:[]})},saveToHistory:()=>{const{project:n,history:r}=o();n&&t({history:{past:[...r.past,n],future:[]}})},undo:()=>{const{history:n,project:r}=o();if(n.past.length===0||!r)return;const h=n.past[n.past.length-1],a=n.past.slice(0,-1);t({project:h,history:{past:a,future:[r,...n.future]}}),X(o().saveProject)},redo:()=>{const{history:n,project:r}=o();if(n.future.length===0||!r)return;const h=n.future[0],a=n.future.slice(1);t({project:h,history:{past:[...n.past,r],future:a}}),X(o().saveProject)},copy:()=>{const{project:n,selectedWidgetIds:r}=o();if(!n)return;const h=n.widgets.filter(a=>r.includes(a.id));t({clipboard:h})},paste:()=>{const{clipboard:n,project:r}=o();if(!r||n.length===0)return;const h=n.map(a=>({...a,id:`widget-${Date.now()}-${Math.random()}`,x:a.x+20,y:a.y+20}));o().saveToHistory(),t({project:{...r,widgets:[...r.widgets,...h]},selectedWidgetIds:h.map(a=>a.id)}),X(o().saveProject)},cut:()=>{const{selectedWidgetIds:n}=o();o().copy(),n.forEach(r=>o().deleteWidget(r))},setZoom:n=>{t({zoom:Math.max(.1,Math.min(5,n))})},toggleGrid:()=>{t(n=>({gridEnabled:!n.gridEnabled}))},toggleSnapToGrid:()=>{t(n=>({snapToGrid:!n.snapToGrid}))},setGridSize:n=>{t({gridSize:Math.max(5,Math.min(100,n))})}}));typeof window<"u"&&window.addEventListener("beforeunload",()=>{Ue()});const Jt=()=>{const{isSaving:t,lastSaved:o,saveError:n}=U(),h=n?"error":t?"saving":o?"saved":"idle",a=c=>{const d=new Date().getTime()-c.getTime(),p=Math.floor(d/1e3),x=Math.floor(p/60);return p<10?"Только что":p<60?`${p} сек назад`:x===1?"1 мин назад":x<60?`${x} мин назад`:c.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})},s=()=>{switch(h){case"saving":return e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:16,className:"spinner"}),e.jsx("span",{children:"Сохранение..."})]});case"saved":return e.jsxs(e.Fragment,{children:[e.jsx(lt,{size:16}),e.jsxs("span",{children:["Сохранено ",o&&a(o)]})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:16}),e.jsx("span",{title:n||void 0,children:"Ошибка сохранения"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx(ct,{size:16}),e.jsx("span",{children:"Не сохранено"})]})}};return e.jsx("div",{className:`autosave-indicator status-${h}`,children:s()})},Zt=({onClose:t,onSuccess:o})=>{const[n,r]=S.useState(""),[h,a]=S.useState(""),[s,c]=S.useState(1920),[i,d]=S.useState(1080),[p,x]=S.useState(!1),{createProject:j}=U(),m=async b=>{if(b.preventDefault(),!n.trim()){alert("Введите название проекта");return}try{x(!0),console.log("[CreateProjectDialog] Creating project:",n),await j(n.trim(),{width:s,height:i,backgroundColor:"#ffffff"}),console.log("[CreateProjectDialog] Project created successfully"),o?.(),t()}catch(u){console.error("[CreateProjectDialog] Failed to create project:",u),alert("Не удалось создать проект")}finally{x(!1)}},k=[{name:"Full HD (горизонтально)",width:1920,height:1080},{name:"Full HD (вертикально)",width:1080,height:1920},{name:"4K (горизонтально)",width:3840,height:2160},{name:"HD (горизонтально)",width:1280,height:720}];return e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content create-project-dialog",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"Создать новый проект"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"Закрыть",children:e.jsx(Be,{size:24})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"dialog-body",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-name",children:"Название проекта *"}),e.jsx("input",{id:"project-name",type:"text",value:n,onChange:b=>r(b.target.value),placeholder:"Мой проект",maxLength:100,autoFocus:!0})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-description",children:"Описание (необязательно)"}),e.jsx("textarea",{id:"project-description",value:h,onChange:b=>a(b.target.value),placeholder:"Краткое описание проекта...",maxLength:500,rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Размер холста"}),e.jsx("div",{className:"presets-grid",children:k.map((b,u)=>e.jsxs("button",{type:"button",className:`preset-btn ${s===b.width&&i===b.height?"active":""}`,onClick:()=>{c(b.width),d(b.height)},children:[e.jsx("span",{className:"preset-name",children:b.name}),e.jsxs("span",{className:"preset-size",children:[b.width,"×",b.height]})]},u))}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-width",children:"Ширина (px)"}),e.jsx("input",{id:"canvas-width",type:"number",value:s,onChange:b=>c(parseInt(b.target.value)||1920),min:320,max:7680})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-height",children:"Высота (px)"}),e.jsx("input",{id:"canvas-height",type:"number",value:i,onChange:b=>d(parseInt(b.target.value)||1080),min:240,max:4320})]})]})]})]}),e.jsxs("div",{className:"dialog-footer",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:t,children:"Отмена"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p,children:p?"Создание...":"Создать проект"})]})]})]})})},Qt=({onClose:t,onProjectLoaded:o})=>{const[n,r]=S.useState([]),[h,a]=S.useState(!0),[s,c]=S.useState(""),[i,d]=S.useState(!1),{loadProject:p,projectId:x}=U();S.useEffect(()=>{j()},[]);const j=async()=>{try{a(!0);const g=await H.getProjects();console.log("[ProjectsDialog] Projects loaded:",g.projects.length),r(g.projects)}catch(g){console.error("[ProjectsDialog] Failed to load projects:",g),alert("Не удалось загрузить список проектов")}finally{a(!1)}},m=async g=>{try{console.log("[ProjectsDialog] Opening project:",g),await p(g),o?.(),t()}catch(N){console.error("[ProjectsDialog] Failed to open project:",N),alert("Не удалось открыть проект")}},k=async(g,N)=>{if(confirm(`Вы уверены что хотите удалить проект "${N}"?`))try{console.log("[ProjectsDialog] Deleting project:",g),await H.deleteProject(g),r(n.filter(I=>I.id!==g)),alert("Проект удалён")}catch(I){console.error("[ProjectsDialog] Failed to delete project:",I),alert("Не удалось удалить проект")}},b=()=>{d(!1),j()},u=n.filter(g=>g.name.toLowerCase().includes(s.toLowerCase())||g.description?.toLowerCase().includes(s.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content projects-dialog",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"Мои проекты"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"Закрыть",children:e.jsx(Be,{size:24})})]}),e.jsxs("div",{className:"projects-toolbar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(kt,{size:18}),e.jsx("input",{type:"text",placeholder:"Поиск проектов...",value:s,onChange:g=>c(g.target.value)})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>d(!0),children:[e.jsx(vt,{size:18}),e.jsx("span",{children:"Создать проект"})]})]}),e.jsx("div",{className:"projects-list",children:h?e.jsx("div",{className:"loading-state",children:e.jsx("p",{children:"Загрузка проектов..."})}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(le,{size:48}),e.jsx("p",{children:s?"Проекты не найдены":"У вас пока нет проектов"}),e.jsx("button",{className:"btn-primary",onClick:()=>d(!0),children:"Создать первый проект"})]}):u.map(g=>e.jsxs("div",{className:`project-card ${g.id===x?"active":""}`,children:[e.jsx("div",{className:"project-thumbnail",children:g.thumbnail?e.jsx("img",{src:g.thumbnail,alt:g.name}):e.jsx("div",{className:"thumbnail-placeholder",children:e.jsx(le,{size:32})})}),e.jsxs("div",{className:"project-info",children:[e.jsx("h3",{children:g.name}),g.description&&e.jsx("p",{className:"project-description",children:g.description}),e.jsxs("div",{className:"project-meta",children:[e.jsxs("span",{children:[g.canvasWidth,"×",g.canvasHeight]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(g.updatedAt).toLocaleDateString("ru-RU")})]}),g.tags&&g.tags.length>0&&e.jsx("div",{className:"project-tags",children:g.tags.map((N,I)=>e.jsx("span",{className:"tag",children:N},I))})]}),e.jsxs("div",{className:"project-actions",children:[e.jsxs("button",{className:"btn-primary",onClick:()=>m(g.id),title:"Открыть проект",children:[e.jsx(le,{size:18}),e.jsx("span",{children:"Открыть"})]}),e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>k(g.id,g.name),title:"Удалить проект",children:e.jsx(Oe,{size:18})})]})]},g.id))}),e.jsx("div",{className:"dialog-footer",children:e.jsxs("p",{className:"projects-count",children:["Всего проектов: ",n.length]})})]})}),i&&e.jsx(Zt,{onClose:()=>d(!1),onSuccess:b})]})},er=({onClose:t})=>{const{project:o}=U(),[n,r]=S.useState(o?.name||"Kiosk Player"),[h,a]=S.useState(null),[s,c]=S.useState(null),[i,d]=S.useState(!1),[p,x]=S.useState(null),[j,m]=S.useState(null),k=S.useRef(null);if(S.useEffect(()=>()=>{j&&clearInterval(j)},[j]),!o)return null;const b=w=>{const E=w.target.files?.[0];if(E){a(E);const l=new FileReader;l.onload=v=>c(v.target?.result),l.readAsDataURL(E)}},u=async()=>{d(!0),x(null);try{const w=new FormData;w.append("project",JSON.stringify(o)),w.append("appName",n),w.append("appId","com.kiosk.player"),h&&w.append("icon",h);const E=H.getBaseUrl(),v=await(await fetch(`${E}/api/builds`,{method:"POST",body:w})).json();if(!v.success)throw new Error(v.error||"Ошибка запуска сборки");const f=v.data.build_id,C=setInterval(async()=>{try{const F=await(await fetch(`${E}/api/builds/${f}`)).json();F.success&&(x(F.data),(F.data.status==="completed"||F.data.status==="failed")&&(clearInterval(C),d(!1)))}catch(M){console.error("Poll error:",M)}},2e3);m(C),x({id:f,status:"queued",progress:0,message:"Запуск сборки..."})}catch(w){console.error("Build error:",w),x({id:"",status:"failed",progress:0,message:w.message,error:w.message}),d(!1)}},g=()=>{if(p?.download_url){const w=H.getBaseUrl();window.open(`${w}${p.download_url}`,"_blank")}},N=p?.status==="completed",I=p?.status==="failed",y=i&&!N&&!I;return e.jsx("div",{className:"build-dialog-overlay",onClick:y?void 0:t,children:e.jsxs("div",{className:"build-dialog",onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"build-dialog-header",children:[e.jsxs("h2",{children:[e.jsx(me,{size:20})," Сборка плеера Windows"]}),!y&&e.jsx("button",{className:"build-dialog-close",onClick:t,children:"×"})]}),e.jsxs("div",{className:"build-dialog-body",children:[e.jsxs("div",{className:"build-project-info",children:[e.jsx("h4",{children:"Проект"}),e.jsxs("div",{className:"build-project-info-grid",children:[e.jsxs("div",{children:["Название: ",e.jsx("span",{children:o.name})]}),e.jsxs("div",{children:["Виджетов: ",e.jsx("span",{children:o.widgets.length})]}),e.jsxs("div",{children:["Размер: ",e.jsxs("span",{children:[o.canvas.width,"×",o.canvas.height]})]})]})]}),!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"build-form-group",children:[e.jsx("label",{children:"Имя приложения"}),e.jsx("input",{type:"text",value:n,onChange:w=>r(w.target.value),placeholder:"Kiosk Player"})]}),e.jsxs("div",{className:"build-form-group",children:[e.jsx("label",{children:"Иконка приложения (.ico)"}),e.jsxs("div",{className:"build-icon-upload",children:[e.jsx("button",{className:"build-icon-btn",onClick:()=>k.current?.click(),children:h?"Изменить":"Выбрать .ico файл"}),s&&e.jsx("div",{className:"build-icon-preview",children:e.jsx("img",{src:s,alt:"icon"})}),h&&e.jsx("span",{className:"build-icon-name",children:h.name}),e.jsx("input",{ref:k,type:"file",accept:".ico",onChange:b,style:{display:"none"}})]})]})]}),p&&e.jsxs("div",{className:"build-progress-section",children:[y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"build-progress-percent",children:[p.progress,"%"]}),e.jsx("div",{className:"build-progress-bar-bg",children:e.jsx("div",{className:"build-progress-bar-fill",style:{width:`${p.progress}%`}})}),e.jsxs("div",{className:"build-progress-status",children:[e.jsx(ye,{size:14,style:{display:"inline",marginRight:6,animation:"spin 1s linear infinite"}}),p.message]})]}),N&&e.jsxs("div",{className:"build-result",children:[e.jsx(at,{size:48,color:"#48bb78"}),e.jsx("div",{className:"build-result-success",children:"Установщик готов!"}),e.jsxs("div",{className:"build-result-info",children:[p.file_name,e.jsx("br",{}),"Размер: ",p.file_size]})]}),I&&e.jsxs("div",{className:"build-result",children:[e.jsx(ve,{size:48,color:"#f56565"}),e.jsx("div",{className:"build-result-error",children:p.error||p.message})]})]})]}),e.jsxs("div",{className:"build-dialog-footer",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Отмена"}),e.jsxs("button",{className:"build-btn build-btn-primary",onClick:u,disabled:!n.trim(),children:[e.jsx(me,{size:16})," Собрать .exe"]})]}),y&&e.jsx("button",{className:"build-btn build-btn-secondary",disabled:!0,children:"Сборка... ~2 мин"}),N&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Закрыть"}),e.jsxs("button",{className:"build-btn build-btn-success",onClick:g,children:[e.jsx(dt,{size:16})," Скачать .exe"]})]}),I&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Закрыть"}),e.jsx("button",{className:"build-btn build-btn-primary",onClick:()=>{x(null),d(!1)},children:"Попробовать снова"})]})]})]})})},tr=()=>{const{project:t,history:o,zoom:n,gridEnabled:r,snapToGrid:h,undo:a,redo:s,setZoom:c,toggleGrid:i,toggleSnapToGrid:d,saveProject:p}=U(),{project:x,savePreviewSnapshot:j}=U(),[m,k]=V.useState(!1),[b,u]=S.useState(null),[g,N]=S.useState(null),[I,y]=S.useState(!1),[w,E]=S.useState(!1);S.useEffect(()=>{const P=H.getOrganizationData();u(P.name),N(P.plan)},[]);const l=()=>{c(Math.min(n+.1,3))},v=()=>{c(Math.max(n-.1,.1))},f=()=>{confirm("Вы уверены что хотите выйти?")&&(D.info("User initiated logout"),H.logout(),window.location.href="/login")},C=async()=>{if(!(x||t)){alert("Нет открытого проекта для предпросмотра");return}k(!0);try{console.log("[Toolbar] Starting preview...");const z=await j();window.open(`/preview?projectId=${z}`,"_blank"),console.log("[Toolbar] Preview opened")}catch(z){console.error("[Toolbar] Error:",z),alert(`Ошибка: ${z.message}`)}finally{k(!1)}},M=o.past.length>0,F=o.future.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsx("div",{className:"toolbar-logo",children:e.jsx("span",{className:"logo-text",children:"Kiosk Editor"})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:()=>p(),disabled:!t,title:"Сохранить (Ctrl+S)",children:e.jsx(bt,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:()=>y(!0),disabled:!t,title:"Мои проекты",children:e.jsx(le,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:a,disabled:!M,title:"Отменить (Ctrl+Z)",children:e.jsx(Nt,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:s,disabled:!F,title:"Вернуть (Ctrl+Shift+Z)",children:e.jsx(yt,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:v,disabled:n<=.1,title:"Уменьшить (Ctrl+-)",children:e.jsx(Pt,{size:18})}),e.jsxs("span",{className:"toolbar-zoom",children:[Math.round(n*100),"%"]}),e.jsx("button",{className:"toolbar-btn",onClick:l,disabled:n>=3,title:"Увеличить (Ctrl++)",children:e.jsx(Tt,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-btn ${r?"active":""}`,onClick:i,title:"Показать сетку",children:e.jsx(ht,{size:18})}),e.jsx("button",{className:`toolbar-btn ${h?"active":""}`,onClick:d,title:"Привязка к сетке",children:e.jsx(ft,{size:18})})]}),e.jsxs("div",{className:"toolbar-section",children:[t&&e.jsx(Jt,{}),e.jsx("div",{className:"toolbar-divider"}),b&&e.jsxs("div",{className:"toolbar-user-info",children:[e.jsx(Et,{size:16}),e.jsx("span",{className:"user-org",children:b}),g&&e.jsx("span",{className:"user-plan",children:g})]}),e.jsx("button",{className:"toolbar-btn logout-btn",onClick:f,title:"Выйти",children:e.jsx(xt,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",disabled:!t,onClick:()=>E(!0),title:"Собрать плеер Windows",children:e.jsx(me,{size:18})}),e.jsxs("button",{className:"toolbar-btn preview-btn",disabled:!t||m,onClick:C,title:"Предпросмотр",children:[e.jsx(jt,{size:18}),e.jsx("span",{children:m?"Загрузка...":"Предпросмотр"})]})]})]}),I&&e.jsx(Qt,{onClose:()=>y(!1)}),w&&e.jsx(er,{onClose:()=>E(!1)})]})},qe=({widget:t,image:o})=>{const n=S.useRef(null),{clipShape:r="rectangle",cornerRadius:h=0,opacity:a=1}=t.properties;return S.useEffect(()=>{if(!n.current||!o)return;const s=n.current,c=document.createElement("canvas"),i=c.getContext("2d");if(!i)return;c.width=t.width,c.height=t.height,i.clearRect(0,0,c.width,c.height),i.save();const d=t.width/2,p=t.height/2,x=Math.min(t.width,t.height)/2;switch(r){case"circle":i.beginPath(),i.arc(d,p,x,0,Math.PI*2),i.closePath();break;case"ellipse":i.beginPath(),i.ellipse(d,p,t.width/2,t.height/2,0,0,Math.PI*2),i.closePath();break;case"triangle":i.beginPath(),i.moveTo(d,p-x),i.lineTo(d+x*Math.cos(Math.PI/6),p+x*Math.sin(Math.PI/6)),i.lineTo(d-x*Math.cos(Math.PI/6),p+x*Math.sin(Math.PI/6)),i.closePath();break;case"diamond":i.beginPath(),i.moveTo(d,0),i.lineTo(t.width,p),i.lineTo(d,t.height),i.lineTo(0,p),i.closePath();break;case"pentagon":fe(i,d,p,x,5);break;case"hexagon":fe(i,d,p,x,6);break;case"octagon":fe(i,d,p,x,8);break;case"star":i.beginPath();for(let l=0;l<10;l++){const v=l*Math.PI/5-Math.PI/2,f=l%2===0?x:x*.5,C=d+f*Math.cos(v),M=p+f*Math.sin(v);l===0?i.moveTo(C,M):i.lineTo(C,M)}i.closePath();break;case"rounded-rectangle":rr(i,0,0,t.width,t.height,h);break;default:i.rect(0,0,t.width,t.height);break}i.clip();const j=o.width/o.height,m=t.width/t.height;let k=0,b=0,u=o.width,g=o.height,N=0,I=0,y=t.width,w=t.height;j>m?(u=o.height*m,k=(o.width-u)/2):(g=o.width/m,b=(o.height-g)/2),i.drawImage(o,k,b,u,g,N,I,y,w),i.restore();const E=new window.Image;E.src=c.toDataURL(),E.onload=()=>{s&&(s.image(E),s.getLayer()?.batchDraw())}},[o,t.width,t.height,r,h]),o?e.jsx(ie,{ref:n,image:void 0,width:t.width,height:t.height,opacity:a,listening:!1}):null};function fe(t,o,n,r,h){t.beginPath();for(let a=0;a<h;a++){const s=a*2*Math.PI/h-Math.PI/2,c=o+r*Math.cos(s),i=n+r*Math.sin(s);a===0?t.moveTo(c,i):t.lineTo(c,i)}t.closePath()}function rr(t,o,n,r,h,a){t.beginPath(),t.moveTo(o+a,n),t.lineTo(o+r-a,n),t.quadraticCurveTo(o+r,n,o+r,n+a),t.lineTo(o+r,n+h-a),t.quadraticCurveTo(o+r,n+h,o+r-a,n+h),t.lineTo(o+a,n+h),t.quadraticCurveTo(o,n+h,o,n+h-a),t.lineTo(o,n+a),t.quadraticCurveTo(o,n,o+a,n),t.closePath()}const sr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),[c,i]=S.useState({}),[d,p]=S.useState(0),[x,j]=S.useState(!1),m=S.useRef(),{sources:k=[],autoSwitch:b=!1,switchInterval:u=3,transition:g="fade",clipShape:N="rectangle",loop:I=!0}=t.properties;S.useEffect(()=>{const l={};let v=0;return k.forEach(f=>{const C=new window.Image;C.crossOrigin="anonymous",C.onload=()=>{l[f.id]=C,v++,v===k.length&&i({...l})},C.onerror=()=>{console.error("Failed to load image:",f.value),v++,v===k.length&&i({...l})},C.src=f.value}),()=>{Object.values(l).forEach(f=>{f.onload=null,f.onerror=null})}},[k]),S.useEffect(()=>{if(!b||k.length<=1){m.current&&clearInterval(m.current);return}return m.current=setInterval(()=>{p(l=>{const v=l+1;return v>=k.length?I?0:l:v})},u*1e3),()=>{m.current&&clearInterval(m.current)}},[b,u,k.length,I]);const y=t.locked||!1,w=k[d],E=w?c[w.id]:null;return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!y,dragBoundFunc:a,opacity:y?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),(!E||k.length===0)&&e.jsx(W,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),E&&(N&&N!=="rectangle"?e.jsx(qe,{widget:t,image:E}):e.jsx(ie,{image:E,x:0,y:0,width:t.width,height:t.height,listening:!1})),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),k.length>1&&e.jsx(W,{x:t.width-40,y:t.height-20,width:35,height:15,fill:"rgba(0, 0, 0, 0.7)",cornerRadius:3,listening:!1}),k.length>1&&e.jsx(ie,{x:t.width-35,y:t.height-18,width:10,height:10,image:(()=>{const l=document.createElement("canvas");l.width=10,l.height=10;const v=l.getContext("2d");v&&(v.fillStyle="#fff",v.font="10px Arial",v.fillText("📷",0,9));const f=new window.Image;return f.src=l.toDataURL(),f})(),listening:!1})]})},nr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{if(t.properties.galleryMode)return e.jsx(sr,{widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a});const[s,c]=S.useState(null),i=S.useRef(null),{clipShape:d="rectangle"}=t.properties;S.useEffect(()=>{if(!t.properties.src){c(null);return}const y=new window.Image;return y.crossOrigin="anonymous",y.onload=()=>{c(y)},y.onerror=()=>{console.error("Failed to load image:",t.properties.src),c(null)},y.src=t.properties.src,()=>{y.onload=null,y.onerror=null}},[t.properties.src]),S.useEffect(()=>{if(!s||t.properties.objectFit!=="adaptive")return;const{updateWidget:y}=U.getState(),w=s.width/s.height,E=t.width/t.height;if(Math.abs(w-E)>.01){const l=t.width/w;y(t.id,{height:Math.round(l)})}},[s,t.properties.objectFit,t.width,t.height,t.id]);const x=(()=>{if(!s)return null;const{width:y,height:w}=t,{objectFit:E="contain"}=t.properties,l=s.width/s.height,v=y/w;let f=0,C=0,M=s.width,F=s.height;switch(E){case"cover":{l>v?(M=s.height*v,f=(s.width-M)/2):(F=s.width/v,C=(s.height-F)/2);break}case"contain":break;case"fill":break;case"scale-down":{s.width<=y&&s.height<=w&&(M=s.width,F=s.height);break}}return{cropX:f,cropY:C,cropWidth:M,cropHeight:F}})(),{borderEnabled:j,borderStyle:m,borderWidth:k=2,borderColor:b="#000000"}=t.properties,u=y=>{switch(y){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},g=y=>{i.current&&h(y)},N=t.locked||!1,I=()=>{if(!j)return null;const y={stroke:b,strokeWidth:k,dash:u(m),fill:void 0,listening:!1},w=d||"rectangle",E=t.width,l=t.height,v=Math.min(E,l)/2,f=E/2,C=l/2;switch(w){case"circle":return e.jsx(_e,{x:f,y:C,radius:v,...y});case"ellipse":return e.jsx($e,{x:f,y:C,radiusX:E/2,radiusY:l/2,...y});case"triangle":return e.jsx(G,{x:f,y:C,sides:3,radius:v,...y});case"diamond":return e.jsx(G,{x:f,y:C,sides:4,radius:v,rotation:45,...y});case"pentagon":return e.jsx(G,{x:f,y:C,sides:5,radius:v,...y});case"hexagon":return e.jsx(G,{x:f,y:C,sides:6,radius:v,...y});case"octagon":return e.jsx(G,{x:f,y:C,sides:8,radius:v,...y});case"star":return e.jsx(De,{x:f,y:C,numPoints:5,innerRadius:v*.5,outerRadius:v,...y});case"rounded-rectangle":return e.jsx(W,{width:E,height:l,cornerRadius:t.properties.cornerRadius||20,...y});default:return e.jsx(W,{width:E,height:l,...y})}};return e.jsxs(J,{ref:i,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!N,dragBoundFunc:a,opacity:N?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:g,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),!s&&e.jsx(W,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),s&&(d&&d!=="rectangle"?e.jsx(qe,{widget:t,image:s}):x&&e.jsx(ie,{image:s,x:0,y:0,width:t.width,height:t.height,crop:{x:x.cropX,y:x.cropY,width:x.cropWidth,height:x.cropHeight},listening:!1})),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),I()]})},ir=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),c=S.useRef(null),{text:i="Button",backgroundColor:d="#2ecc71",textColor:p="#ffffff",fontSize:x=16,fontFamily:j="Arial",fontWeight:m="normal",fontStyle:k="normal",textAlign:b="center",borderRadius:u=8,borderWidth:g=0,borderColor:N="#000000",borderStyle:I="solid",paddingX:y=16,paddingY:w=8,shadowEnabled:E=!1,shadowColor:l="#000000",shadowBlur:v=10,shadowOffsetX:f=0,shadowOffsetY:C=4,shadowOpacity:M=.3}=t.properties,F=t.locked||!1,P=()=>{switch(I){case"dashed":return[10,5];case"dotted":return[3,3];default:return[]}};return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!F,dragBoundFunc:a,opacity:F?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[E&&e.jsx(W,{x:f,y:C,width:t.width,height:t.height,cornerRadius:u,fill:l,opacity:M,blur:v,listening:!1}),e.jsx(W,{width:t.width,height:t.height,fill:d,cornerRadius:u,stroke:g>0?N:void 0,strokeWidth:g,dash:P(),listening:!1}),e.jsx($,{ref:c,text:i,x:y,y:0,width:t.width-y*2,height:t.height,fontSize:x,fontFamily:j,fontStyle:m==="bold"?"bold":k,fill:p,align:b,verticalAlign:"middle",listening:!1}),e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,cornerRadius:u,listening:!1})]})},or=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),{text:c="Text",fontSize:i=16,fontFamily:d="Arial",fontWeight:p="normal",fontStyle:x="normal",textAlign:j="left",verticalAlign:m="top",textColor:k="#000000",backgroundColor:b="#ffffff",lineHeight:u=1.2,padding:g=8,textDecoration:N="none"}=t.properties,I=t.locked||!1,y=()=>N==="underline"?"underline":N==="line-through"?"line-through":"";return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!I,dragBoundFunc:a,opacity:I?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[b!=="transparent"&&e.jsx(W,{width:t.width,height:t.height,fill:b,listening:!1}),e.jsx($,{text:c,x:g,y:g,width:t.width-g*2,height:t.height-g*2,fontSize:i,fontFamily:d,fontStyle:p==="bold"?"bold":x,fill:k,align:j,verticalAlign:m,lineHeight:u,textDecoration:y(),listening:!1}),e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},ar=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),[c,i]=S.useState(0),{sources:d=[],autoNext:p=!0,loop:x=!0}=t.properties,j=t.locked||!1;return d[c],e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!j,dragBoundFunc:a,opacity:j?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(W,{width:t.width,height:t.height,fill:"#000000",listening:!1}),e.jsx($,{x:t.width/2,y:t.height/2-30,text:"▶",fontSize:60,fill:"#ffffff",align:"center",width:t.width,offsetX:t.width/2,listening:!1}),e.jsx($,{x:0,y:t.height/2+40,text:"PLAYLIST",fontSize:16,fill:"#ffffff",align:"center",width:t.width,listening:!1}),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(W,{x:t.width-50,y:t.height-25,width:45,height:20,fill:"rgba(0, 0, 0, 0.8)",cornerRadius:4,listening:!1}),e.jsx($,{x:t.width-48,y:t.height-21,text:`🎬 ${d.length}`,fontSize:12,fill:"#ffffff",listening:!1})]})]})},lr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{if(t.properties.playlistMode)return e.jsx(ar,{widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a});const s=S.useRef(null),c=S.useRef(null),[i,d]=S.useState(null),p=S.useRef(),{sourceType:x="url",src:j="",rtspUrl:m="",isLocalFile:k=!1,fileName:b="",objectFit:u="contain",borderEnabled:g=!1,borderStyle:N="solid",borderWidth:I=2,borderColor:y="#000000",autoplay:w=!1,loop:E=!1,muted:l=!0,controls:v=!1}=t.properties;S.useEffect(()=>{const T=document.createElement("video");return T.crossOrigin="anonymous",T.loop=E,T.muted=l,T.playsInline=!0,x==="url"&&j?(T.src=j,T.onloadedmetadata=()=>{d(T),w&&T.play().catch(R=>{console.log("Autoplay prevented:",R)})},T.onerror=()=>{console.error("Failed to load video:",j),d(null)}):d(null),c.current=T,()=>{p.current&&cancelAnimationFrame(p.current),T.pause(),T.src="",T.load()}},[j,x,w,E,l]),S.useEffect(()=>{if(!i)return;const T=()=>{const R=s.current?.getLayer();R&&R.batchDraw(),p.current=requestAnimationFrame(T)};return p.current=requestAnimationFrame(T),()=>{p.current&&cancelAnimationFrame(p.current)}},[i]),S.useEffect(()=>{if(u!=="adaptive"||!i)return;const{updateWidget:T}=U.getState(),R=i.videoWidth/i.videoHeight||16/9,O=t.width/t.height;if(Math.abs(R-O)>.01){const B=t.width/R;T(t.id,{height:Math.round(B)})}},[u,i,t.width,t.height,t.id]);const C=(()=>{if(!i||i.videoWidth===0)return null;const{width:T,height:R}=t,O=i.videoWidth/i.videoHeight,B=T/R;let q=0,_=0,Y=i.videoWidth,K=i.videoHeight,Z=0,oe=0,Q=T,ee=R;switch(u){case"cover":{O>B?(Y=i.videoHeight*B,q=(i.videoWidth-Y)/2):(K=i.videoWidth/B,_=(i.videoHeight-K)/2);break}case"contain":{O>B?(ee=T/O,oe=(R-ee)/2):(Q=R*O,Z=(T-Q)/2);break}case"scale-down":{i.videoWidth<=T&&i.videoHeight<=R?(Q=i.videoWidth,ee=i.videoHeight,Z=(T-Q)/2,oe=(R-ee)/2):O>B?(ee=T/O,oe=(R-ee)/2):(Q=R*O,Z=(T-Q)/2);break}}return{crop:{x:q,y:_,width:Y,height:K},position:{x:Z,y:oe,width:Q,height:ee}}})(),M=T=>{switch(T){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},F=T=>{s.current&&h(T)},P=T=>{n(T),v&&i&&(i.paused?i.play():i.pause())},z=t.locked||!1,A=()=>x==="rtsp"&&m?`📹 RTSP
${m.substring(0,30)}...`:x==="url"&&j?k&&b?`📁 ${b}`:`🎥 Видео
${j.substring(0,30)}...`:`🎥 Видео
Нажмите для настройки`;return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!z,dragBoundFunc:a,opacity:z?.6:1,onClick:P,onTap:P,onDragEnd:r,onTransformEnd:F,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(W,{width:t.width,height:t.height,fill:x==="rtsp"?"#2c3e50":"#f39c12",listening:!1}),i&&C?e.jsx(ie,{image:i,x:C.position.x,y:C.position.y,width:C.position.width,height:C.position.height,crop:C.crop,listening:!1}):e.jsx($,{text:A(),x:0,y:0,width:t.width,height:t.height,fontSize:14,fontFamily:"Arial",fill:"#ffffff",align:"center",verticalAlign:"middle",listening:!1}),x==="rtsp"&&e.jsx(W,{x:10,y:10,width:45,height:20,fill:"#ff0000",cornerRadius:4,listening:!1}),x==="rtsp"&&e.jsx($,{text:"LIVE",x:10,y:13,width:45,fontSize:12,fontFamily:"Arial",fontWeight:"bold",fill:"#ffffff",align:"center",listening:!1}),i&&!i.paused&&e.jsx($,{text:"▶",x:t.width-30,y:10,fontSize:16,fontFamily:"Arial",fill:"#00ff00",listening:!1}),v&&i&&e.jsx($,{text:i.paused?"⏸ Пауза":"▶ Играет",x:10,y:t.height-30,fontSize:12,fontFamily:"Arial",fill:"#ffffff",listening:!1}),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),g&&e.jsx(W,{width:t.width,height:t.height,stroke:y,strokeWidth:I,dash:M(N),listening:!1})]})},cr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),{shapeType:c="rectangle",fillColor:i="#4a90e2",strokeColor:d="#2c3e50",strokeWidth:p=0,cornerRadius:x=0,opacity:j=1}=t.properties,m=t.locked||!1,k=()=>{const b={fill:i,stroke:p>0?d:void 0,strokeWidth:p,opacity:j,listening:!1};switch(c){case"rectangle":return e.jsx(W,{x:0,y:0,width:t.width,height:t.height,cornerRadius:x,...b});case"circle":const u=Math.min(t.width,t.height)/2;return e.jsx(_e,{x:t.width/2,y:t.height/2,radius:u,...b});case"ellipse":return e.jsx($e,{x:t.width/2,y:t.height/2,radiusX:t.width/2,radiusY:t.height/2,...b});case"triangle":return e.jsx(G,{x:t.width/2,y:t.height/2,sides:3,radius:Math.min(t.width,t.height)/2,...b});case"pentagon":return e.jsx(G,{x:t.width/2,y:t.height/2,sides:5,radius:Math.min(t.width,t.height)/2,...b});case"hexagon":return e.jsx(G,{x:t.width/2,y:t.height/2,sides:6,radius:Math.min(t.width,t.height)/2,...b});case"star":return e.jsx(De,{x:t.width/2,y:t.height/2,numPoints:5,innerRadius:Math.min(t.width,t.height)/4,outerRadius:Math.min(t.width,t.height)/2,...b});case"diamond":return e.jsx(G,{x:t.width/2,y:t.height/2,sides:4,radius:Math.min(t.width,t.height)/2,rotation:45,...b});case"line":return e.jsx(ne,{points:[0,t.height/2,t.width,t.height/2],stroke:d,strokeWidth:Math.max(p,2),opacity:j,listening:!1});case"arrow":const g=t.width,N=t.height,I=N*.6,y=N*.4;return e.jsx(ne,{points:[0,N/2-y/2,g-I,N/2-y/2,g-I,0,g,N/2,g-I,N,g-I,N/2+y/2,0,N/2+y/2],closed:!0,fill:i,stroke:p>0?d:void 0,strokeWidth:p,opacity:j,listening:!1});default:return e.jsx(W,{x:0,y:0,width:t.width,height:t.height,...b})}};return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!m,dragBoundFunc:a,opacity:m?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),k(),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},dr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=S.useRef(null),[c,i]=S.useState(null),[d,p]=S.useState(null),{orientation:x="horizontal",items:j=[{id:"1",label:"Главная"},{id:"2",label:"О нас"},{id:"3",label:"Услуги",children:[{id:"3-1",label:"Услуга 1"},{id:"3-2",label:"Услуга 2"}]},{id:"4",label:"Контакты"}],backgroundColor:m="#2c3e50",textColor:k="#ffffff",hoverColor:b="#34495e",fontSize:u=16,fontFamily:g="Arial",itemPadding:N=16,submenuBackgroundColor:I="#34495e",submenuTextColor:y="#ffffff",borderWidth:w=0,borderColor:E="#000000",itemHeight:l=40}=t.properties,v=t.locked||!1,f=x==="horizontal",C=P=>P.length*(u*.6)+N*2,M=()=>{const P=[];let z=0;return j.forEach((A,T)=>{const R=C(A.label),O=c===A.id,B=d===A.id,q=A.children&&A.children.length>0;P.push(e.jsx(W,{x:z,y:0,width:R,height:l,fill:O?b:m,listening:!0,onMouseEnter:()=>i(A.id),onMouseLeave:()=>i(null),onClick:()=>{q&&p(d===A.id?null:A.id)}},`bg-${A.id}`)),P.push(e.jsx($,{x:z,y:0,width:R,height:l,text:A.label,fontSize:u,fontFamily:g,fill:k,align:"center",verticalAlign:"middle",listening:!1},`text-${A.id}`)),q&&P.push(e.jsx($,{x:z+R-20,y:0,width:20,height:l,text:"▼",fontSize:10,fill:k,align:"center",verticalAlign:"middle",listening:!1},`arrow-${A.id}`)),T<j.length-1&&P.push(e.jsx(ne,{points:[z+R,5,z+R,l-5],stroke:E,strokeWidth:1,opacity:.3,listening:!1},`divider-${A.id}`)),B&&q&&A.children.forEach((_,Y)=>{const K=l+Y*l,Z=Math.max(R,C(_.label));P.push(e.jsx(W,{x:z,y:K,width:Z,height:l,fill:I,listening:!0,onMouseEnter:()=>i(_.id),onMouseLeave:()=>i(null)},`submenu-bg-${_.id}`)),P.push(e.jsx($,{x:z+N/2,y:K,width:Z-N/2,height:l,text:_.label,fontSize:u-2,fontFamily:g,fill:y,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`))}),z+=R}),P},F=()=>{const P=[];let z=0;const A=t.width;return j.forEach((T,R)=>{const O=c===T.id,B=d===T.id,q=T.children&&T.children.length>0;P.push(e.jsx(W,{x:0,y:z,width:A,height:l,fill:O?b:m,listening:!0,onMouseEnter:()=>i(T.id),onMouseLeave:()=>i(null),onClick:()=>{q&&p(d===T.id?null:T.id)}},`bg-${T.id}`)),P.push(e.jsx($,{x:N,y:z,width:A-N*2-(q?20:0),height:l,text:T.label,fontSize:u,fontFamily:g,fill:k,align:"left",verticalAlign:"middle",listening:!1},`text-${T.id}`)),q&&P.push(e.jsx($,{x:A-20,y:z,width:20,height:l,text:B?"▼":"▶",fontSize:10,fill:k,align:"center",verticalAlign:"middle",listening:!1},`arrow-${T.id}`)),z+=l,R<j.length-1&&!B&&P.push(e.jsx(ne,{points:[10,z,A-10,z],stroke:E,strokeWidth:1,opacity:.3,listening:!1},`divider-${T.id}`)),B&&q&&(T.children.forEach((_,Y)=>{const K=c===_.id;P.push(e.jsx(W,{x:0,y:z,width:A,height:l,fill:K?b:I,listening:!0,onMouseEnter:()=>i(_.id),onMouseLeave:()=>i(null)},`submenu-bg-${_.id}`)),P.push(e.jsx($,{x:N*2,y:z,width:A-N*3,height:l,text:_.label,fontSize:u-2,fontFamily:g,fill:y,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`)),z+=l}),R<j.length-1&&P.push(e.jsx(ne,{points:[10,z,A-10,z],stroke:E,strokeWidth:1,opacity:.3,listening:!1},`divider-after-${T.id}`)))}),P};return e.jsxs(J,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!v,dragBoundFunc:a,opacity:v?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(W,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(W,{width:t.width,height:t.height,fill:m,listening:!1}),w>0&&e.jsx(W,{width:t.width,height:t.height,stroke:E,strokeWidth:w,listening:!1}),f?M():F(),o&&e.jsx(W,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},hr={shape:"#4a90e2",rectangle:"#4a90e2",button:"#2ecc71",text:"#e74c3c",image:"#9b59b6",video:"#f39c12"},pr=()=>{const{project:t,selectedWidgetIds:o,selectWidget:n,clearSelection:r,updateWidget:h,zoom:a,gridEnabled:s,snapToGrid:c,gridSize:i,gridLineWidth:d,gridColor:p,pendingWidget:x,addWidgetAtPosition:j,clearPendingWidget:m}=U(),k=S.useRef(null),b=S.useRef(null),u=l=>c?Math.round(l/i)*i:l,g=l=>({x:u(l.x),y:u(l.y)});if(S.useEffect(()=>{if(!b.current||!t)return;const l=k.current,v=o.map(f=>t.widgets.find(M=>M.id===f)?.locked?null:l.findOne(`#${f}`)).filter(Boolean);b.current.nodes(v),b.current.getLayer().batchDraw()},[o,t]),!t)return null;const N=l=>{if(x){const C=l.target.getStage().getPointerPosition();C&&j(C.x,C.y);return}(l.target===l.target.getStage()||l.target.attrs.id==="canvas-background")&&r()},I=(l,v)=>{v.cancelBubble=!0;const f=v.evt.ctrlKey||v.evt.metaKey;n(l,f)},y=(l,v)=>{const f=u(v.target.x()),C=u(v.target.y());h(l,{x:f,y:C})},w=(l,v)=>{const f=v.target,C=f.scaleX(),M=f.scaleY();f.scaleX(1),f.scaleY(1);const F=f.width?f.width():f.attrs.width||100,P=f.height?f.height():f.attrs.height||100;let z=Math.max(10,F*C),A=Math.max(10,P*M),T=f.x(),R=f.y();c&&(z=u(z),A=u(A),T=u(T),R=u(R)),h(l,{x:T,y:R,width:z,height:A,rotation:f.rotation()})},E=()=>{if(!s)return null;const l=[],{width:v,height:f}=t.canvas;for(let C=0;C<=v/i;C++)l.push(e.jsx(W,{x:C*i,y:0,width:d,height:f,fill:p},`v-${C}`));for(let C=0;C<=f/i;C++)l.push(e.jsx(W,{x:0,y:C*i,width:v,height:d,fill:p},`h-${C}`));return l};return e.jsxs("div",{className:"canvas-container",children:[e.jsx("div",{className:"canvas-scroll",children:e.jsx("div",{className:"canvas-wrapper",style:{transform:`scale(${a})`,transformOrigin:"top left",cursor:x?"crosshair":"default"},children:e.jsx(Ke,{ref:k,width:t.canvas.width,height:t.canvas.height,onClick:N,onTap:N,children:e.jsxs(Je,{children:[e.jsx(W,{id:"canvas-background",x:0,y:0,width:t.canvas.width,height:t.canvas.height,fill:t.canvas.backgroundColor||"#ffffff"}),E(),t.widgets.slice().sort((l,v)=>(l.zIndex||0)-(v.zIndex||0)).map(l=>{const v=l.locked||!1;return l.type==="image"?e.jsxs(V.Fragment,{children:[e.jsx(nr,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="button"?e.jsxs(V.Fragment,{children:[e.jsx(ir,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="text"?e.jsxs(V.Fragment,{children:[e.jsx(or,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="video"?e.jsxs(V.Fragment,{children:[e.jsx(lr,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="shape"||l.type==="rectangle"?e.jsxs(V.Fragment,{children:[e.jsx(cr,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="menu"?e.jsxs(V.Fragment,{children:[e.jsx(dr,{widget:l,isSelected:o.includes(l.id),onSelect:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f),dragBoundFunc:c?g:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):e.jsxs(V.Fragment,{children:[e.jsx(W,{id:l.id,x:l.x,y:l.y,width:l.width,height:l.height,rotation:l.rotation||0,fill:hr[l.type]||"#4a90e2",stroke:o.includes(l.id)?"#007acc":void 0,strokeWidth:o.includes(l.id)?2:0,opacity:v?.6:1,draggable:!v,onClick:f=>I(l.id,f),onTap:f=>I(l.id,f),onDragEnd:f=>y(l.id,f),onTransformEnd:f=>w(l.id,f)}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id)}),e.jsx(Ze,{ref:b,boundBoxFunc:(l,v)=>v.width<10||v.height<10?l:v})]})})})}),e.jsxs("div",{className:"canvas-info",children:[e.jsxs("span",{children:[t.canvas.width," × ",t.canvas.height," px"]}),o.length>0&&e.jsxs("span",{children:["Выбрано: ",o.length]})]})]})},ur=()=>{const{project:t,selectedWidgetIds:o,selectWidget:n,updateWidget:r,deleteWidget:h}=U();if(!t)return null;const a=i=>({shape:"🔷",rectangle:"🔷",text:"📝",button:"🔘",image:"🖼️",video:"🎬",menu:"🍔"})[i]||"⬜",s=i=>{if(i.properties.text){const d=i.properties.text.substring(0,20);return d.length<i.properties.text.length?`${d}...`:d}return i.properties.items?`Меню (${i.properties.items.length} пунктов)`:i.type.charAt(0).toUpperCase()+i.type.slice(1)},c=[...t.widgets].sort((i,d)=>(d.zIndex||0)-(i.zIndex||0));return e.jsxs("div",{className:"outline-panel",children:[e.jsxs("div",{className:"outline-header",children:[e.jsx("h3",{children:"Структура"}),e.jsxs("span",{className:"outline-count",children:[t.widgets.length," виджетов"]})]}),e.jsx("div",{className:"outline-list",children:c.length===0?e.jsxs("div",{className:"outline-empty",children:[e.jsx("p",{children:"Нет виджетов"}),e.jsx("span",{children:"Добавьте виджеты из библиотеки"})]}):c.map(i=>{const d=o.includes(i.id),p=i.locked||!1;return e.jsxs("div",{className:`outline-item ${d?"selected":""} ${p?"locked":""}`,onClick:()=>n(i.id,!1),children:[e.jsxs("div",{className:"outline-item-main",children:[e.jsx("span",{className:"outline-icon",children:a(i.type)}),e.jsxs("div",{className:"outline-info",children:[e.jsx("span",{className:"outline-label",children:s(i)}),e.jsxs("span",{className:"outline-meta",children:[i.width,"×",i.height," • z:",i.zIndex||0]})]})]}),e.jsxs("div",{className:"outline-actions",onClick:x=>x.stopPropagation(),children:[e.jsx("button",{className:"outline-action-btn",onClick:()=>{r(i.id,{locked:!p})},title:p?"Разблокировать":"Заблокировать",children:p?e.jsx(ut,{size:14}):e.jsx(wt,{size:14})}),e.jsx("button",{className:"outline-action-btn delete",onClick:()=>{window.confirm(`Удалить виджет "${s(i)}"?`)&&h(i.id)},title:"Удалить",children:e.jsx(Oe,{size:14})})]})]},i.id)})})]})},xr=()=>{const{addWidget:t,project:o}=U(),n=[{type:"shape",name:"Фигура",icon:St,defaultProps:{shapeType:"rectangle",fillColor:"#4a90e2",strokeColor:"#2c3e50",strokeWidth:0,cornerRadius:0,opacity:1}},{type:"button",name:"Кнопка",icon:mt,defaultProps:{text:"Нажми меня",backgroundColor:"#4a90e2",textColor:"#ffffff"}},{type:"text",name:"Текст",icon:Ct,defaultProps:{text:"Введите текст",fontSize:24,color:"#000000"}},{type:"image",name:"Изображение",icon:pt,defaultProps:{src:""}},{type:"video",name:"Видео",icon:It,defaultProps:{src:"",autoplay:!1,loop:!1}},{type:"menu",name:"Меню",icon:gt,defaultProps:{orientation:"horizontal",items:[{id:"1",label:"Главная"},{id:"2",label:"О нас"},{id:"3",label:"Услуги",children:[{id:"3-1",label:"Услуга 1"},{id:"3-2",label:"Услуга 2"}]},{id:"4",label:"Контакты"}],backgroundColor:"#2c3e50",textColor:"#ffffff",hoverColor:"#34495e",fontSize:16,fontFamily:"Arial",itemPadding:16,submenuBackgroundColor:"#34495e",submenuTextColor:"#ffffff",borderWidth:0,borderColor:"#000000",itemHeight:40}}],r=(h,a)=>{if(!o)return;const{setPendingWidget:s}=U.getState();s(h,a)};return e.jsxs("div",{className:"widget-library panel",children:[e.jsx("div",{className:"widget-library-header",children:e.jsx("h3",{children:"Виджеты"})}),e.jsx("div",{className:"widget-library-content",children:n.map(h=>{const a=h.icon;return e.jsxs("button",{className:"widget-item",onClick:()=>r(h.type,h.defaultProps),title:`Добавить ${h.name}`,children:[e.jsx(a,{size:24}),e.jsx("span",{children:h.name})]},h.type)})}),e.jsx("div",{className:"widget-library-footer",children:e.jsx("button",{className:"btn-secondary",style:{width:"100%",fontSize:"12px"},children:"+ Импорт виджета"})}),e.jsx(ur,{})]})},fr="modulepreload",gr=function(t){return"/"+t},Re={},Me=function(o,n,r){let h=Promise.resolve();if(n&&n.length>0){let i=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");h=i(n.map(d=>{if(d=gr(d),d in Re)return;Re[d]=!0;const p=d.endsWith(".css"),x=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${x}`))return;const j=document.createElement("link");if(j.rel=p?"stylesheet":fr,p||(j.as="script"),j.crossOrigin="",j.href=d,c&&j.setAttribute("nonce",c),document.head.appendChild(j),p)return new Promise((m,k)=>{j.addEventListener("load",m),j.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return h.then(s=>{for(const c of s||[])c.status==="rejected"&&a(c.reason);return o().catch(a)})},Ae=({widget:t,onUpdate:o,allWidgets:n})=>{const r=t.properties.actions||[],h=()=>{const c={type:"url",url:""};o([...r,c])},a=(c,i)=>{const d=[...r];d[c]={...d[c],...i},o(d)},s=c=>{const i=r.filter((d,p)=>p!==c);o(i)};return e.jsxs("div",{className:"action-editor",children:[e.jsx("h4",{style:{marginBottom:"12px",fontSize:"12px",color:"#aaa"},children:"Действия при клике"}),r.length===0&&e.jsx("div",{style:{padding:"16px",background:"#252525",borderRadius:"6px",textAlign:"center",color:"#888",fontSize:"13px",marginBottom:"12px"},children:"Нет действий. Добавьте действие ниже."}),r.map((c,i)=>e.jsxs("div",{className:"action-item",children:[e.jsxs("div",{className:"action-header",children:[e.jsxs("span",{className:"action-number",children:["#",i+1]}),e.jsx("button",{className:"btn-danger-small",onClick:()=>s(i),title:"Удалить действие",children:"🗑️"})]}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип действия"}),e.jsxs("select",{value:c.type,onChange:d=>a(i,{type:d.target.value}),children:[e.jsx("option",{value:"url",children:"🔗 Открыть URL"}),e.jsx("option",{value:"page",children:"📄 Перейти на страницу"}),e.jsx("option",{value:"popup",children:"💬 Показать popup"}),e.jsx("option",{value:"widget_show",children:"👁️ Показать виджет"}),e.jsx("option",{value:"widget_hide",children:"🙈 Скрыть виджет"}),e.jsx("option",{value:"video_play",children:"▶️ Воспроизвести видео"}),e.jsx("option",{value:"video_stop",children:"⏸️ Остановить видео"})]})]}),c.type==="url"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL адрес"}),e.jsx("input",{type:"text",value:c.url||"",onChange:d=>a(i,{url:d.target.value}),placeholder:"https://example.com"})]}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:c.openInNewTab||!1,onChange:d=>a(i,{openInNewTab:d.target.checked})}),"Открыть в новой вкладке"]})})]}),c.type==="page"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID страницы"}),e.jsx("input",{type:"text",value:c.pageId||"",onChange:d=>a(i,{pageId:d.target.value}),placeholder:"page-1"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Укажите ID страницы для перехода"})]}),c.type==="popup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Заголовок popup"}),e.jsx("input",{type:"text",value:c.popupTitle||"",onChange:d=>a(i,{popupTitle:d.target.value}),placeholder:"Заголовок"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Содержимое popup"}),e.jsx("textarea",{value:c.popupContent||"",onChange:d=>a(i,{popupContent:d.target.value}),rows:4,placeholder:"Текст сообщения..."})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"Ширина (px)"}),e.jsx("input",{type:"number",value:c.popupWidth||400,onChange:d=>a(i,{popupWidth:parseInt(d.target.value)}),min:200,max:1e3})]}),e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"Высота (px)"}),e.jsx("input",{type:"number",value:c.popupHeight||300,onChange:d=>a(i,{popupHeight:parseInt(d.target.value)}),min:150,max:800})]})]})]}),(c.type==="widget_show"||c.type==="widget_hide")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Целевой виджет"}),e.jsxs("select",{value:c.targetWidgetId||"",onChange:d=>a(i,{targetWidgetId:d.target.value}),children:[e.jsx("option",{value:"",children:"Выберите виджет..."}),n.filter(d=>d.id!==t.id).map(d=>e.jsxs("option",{value:d.id,children:[d.type," - ",d.id]},d.id))]})]}),(c.type==="video_play"||c.type==="video_stop")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Видео виджет"}),e.jsxs("select",{value:c.targetWidgetId||"",onChange:d=>a(i,{targetWidgetId:d.target.value}),children:[e.jsx("option",{value:"",children:"Выберите видео..."}),n.filter(d=>d.type==="video").map(d=>e.jsxs("option",{value:d.id,children:["Video - ",d.id]},d.id))]})]})]})]},i)),e.jsx("button",{className:"btn-secondary",onClick:h,style:{width:"100%",marginTop:"8px"},children:"➕ Добавить действие"})]})},mr=()=>{const{project:t,selectedWidgetIds:o,updateWidget:n}=U();if(!t)return null;const r=o.length===1?t.widgets.find(s=>s.id===o[0]):null,h=(s,c)=>{r&&n(r.id,{[s]:c})},a=(s,c)=>{r&&n(r.id,{properties:{...r.properties,[s]:c}})};return r?e.jsxs("div",{className:"properties-panel panel",children:[e.jsxs("div",{className:"properties-header",children:[e.jsx("h3",{children:"Свойства"}),e.jsx("span",{className:"widget-type-badge",children:r.type})]}),e.jsxs("div",{className:"properties-content",children:[e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"Позиция и размер"}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"X"}),e.jsx("input",{type:"number",value:Math.round(r.x),onChange:s=>h("x",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Y"}),e.jsx("input",{type:"number",value:Math.round(r.y),onChange:s=>h("y",parseFloat(s.target.value))})]})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Ширина"}),e.jsx("input",{type:"number",value:Math.round(r.width),onChange:s=>h("width",parseFloat(s.target.value)),min:1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Высота"}),e.jsx("input",{type:"number",value:Math.round(r.height),onChange:s=>h("height",parseFloat(s.target.value)),min:1})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Поворот (градусы)"}),e.jsx("input",{type:"number",value:Math.round(r.rotation||0),onChange:s=>h("rotation",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Z-Index (порядок)"}),e.jsx("input",{type:"number",min:"0",value:r.zIndex||0,onChange:s=>h("zIndex",Math.max(0,parseInt(s.target.value)||0))}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"4px"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"На передний план",children:"⬆️ Наверх"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"На задний план",children:"⬇️ Вниз"})]})]}),e.jsxs("div",{className:"property-field",style:{marginTop:"12px"},children:[e.jsx("button",{className:r.locked?"btn-danger":"btn-secondary",onClick:()=>{},style:{width:"100%"},children:r.locked?"🔒 Разблокировать":"🔓 Заблокировать"}),r.locked&&e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Заблокированный виджет нельзя перемещать и изменять размер"})]})]}),e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"Параметры виджета"}),r.type==="shape"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип фигуры"}),e.jsxs("select",{value:r.properties.shapeType||"rectangle",onChange:s=>a("shapeType",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"Прямоугольник"}),e.jsx("option",{value:"circle",children:"Круг"}),e.jsx("option",{value:"ellipse",children:"Эллипс"}),e.jsx("option",{value:"triangle",children:"Треугольник"}),e.jsx("option",{value:"pentagon",children:"Пятиугольник"}),e.jsx("option",{value:"hexagon",children:"Шестиугольник"}),e.jsx("option",{value:"star",children:"Звезда"}),e.jsx("option",{value:"diamond",children:"Ромб"}),e.jsx("option",{value:"line",children:"Линия"}),e.jsx("option",{value:"arrow",children:"Стрелка"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Заливка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет заливки"}),e.jsx("input",{type:"color",value:r.properties.fillColor||"#4a90e2",onChange:s=>a("fillColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Прозрачность"}),e.jsx("input",{type:"range",value:(r.properties.opacity||1)*100,onChange:s=>a("opacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.opacity||1)*100),"%"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Контур"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина контура"}),e.jsx("input",{type:"number",value:r.properties.strokeWidth||0,onChange:s=>a("strokeWidth",parseInt(s.target.value)),min:0,max:20})]}),r.properties.strokeWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет контура"}),e.jsx("input",{type:"color",value:r.properties.strokeColor||"#2c3e50",onChange:s=>a("strokeColor",s.target.value)})]}),r.properties.shapeType==="rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Скругление углов"}),e.jsx("input",{type:"number",value:r.properties.cornerRadius||0,onChange:s=>a("cornerRadius",parseInt(s.target.value)),min:0,max:100})]})]}),r.type==="button"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль кнопки"}),e.jsxs("select",{onChange:s=>{const c=s.target.value;c!=="custom"&&Me(async()=>{const{buttonStyles:i}=await import("./buttonStyles-VsZJSFTR.js");return{buttonStyles:i}},[]).then(({buttonStyles:i})=>{const d=i.find(p=>p.name===c);d&&n(r.id,{properties:{...r.properties,...d.properties}})})},children:[e.jsx("option",{value:"custom",children:"Пользовательский"}),e.jsx("option",{value:"По умолчанию",children:"По умолчанию"}),e.jsx("option",{value:"Основная",children:"Основная (синяя с тенью)"}),e.jsx("option",{value:"Успех",children:"Успех (зелёная)"}),e.jsx("option",{value:"Опасность",children:"Опасность (красная)"}),e.jsx("option",{value:"Контурная",children:"Контурная"}),e.jsx("option",{value:"Призрак",children:"Призрак"}),e.jsx("option",{value:"Градиент",children:"Градиент"}),e.jsx("option",{value:"Минимализм",children:"Минимализм"}),e.jsx("option",{value:"Неон",children:"Неон"}),e.jsx("option",{value:"Классика",children:"Классика"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Текст"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Текст кнопки"}),e.jsx("input",{type:"text",value:r.properties.text||"Button",onChange:s=>a("text",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:72})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Шрифт"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Начертание"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"bold",children:"Жирный"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Выравнивание"}),e.jsxs("select",{value:r.properties.textAlign||"center",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"По левому краю"}),e.jsx("option",{value:"center",children:"По центру"}),e.jsx("option",{value:"right",children:"По правому краю"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Фон"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2ecc71",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Скругление углов"}),e.jsx("input",{type:"number",value:r.properties.borderRadius||8,onChange:s=>a("borderRadius",parseInt(s.target.value)),min:0,max:50})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"})]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Тень"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.shadowEnabled||!1,onChange:s=>a("shadowEnabled",s.target.checked)}),"Включить тень"]})}),r.properties.shadowEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет тени"}),e.jsx("input",{type:"color",value:r.properties.shadowColor||"#000000",onChange:s=>a("shadowColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размытие"}),e.jsx("input",{type:"number",value:r.properties.shadowBlur||10,onChange:s=>a("shadowBlur",parseInt(s.target.value)),min:0,max:50})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Смещение X"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetX||0,onChange:s=>a("shadowOffsetX",parseInt(s.target.value)),min:-50,max:50})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Смещение Y"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetY||4,onChange:s=>a("shadowOffsetY",parseInt(s.target.value)),min:-50,max:50})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Прозрачность"}),e.jsx("input",{type:"range",value:(r.properties.shadowOpacity||.3)*100,onChange:s=>a("shadowOpacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.shadowOpacity||.3)*100),"%"]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Действия"}),e.jsx(Ae,{widget:r,onUpdate:s=>{n(r.id,{properties:{...r.properties,actions:s}})},allWidgets:t.widgets})]}),r.type==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Текст"}),e.jsx("textarea",{value:r.properties.text||"Text",onChange:s=>a("text",s.target.value),rows:6})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить текстовый файл"}),e.jsx("input",{type:"file",accept:".txt,.pdf,.odt,.docx",onChange:async s=>{const c=s.target.files?.[0];if(c)try{const{extractTextFromFile:i,loadRequiredLibraries:d}=await Me(async()=>{const{extractTextFromFile:x,loadRequiredLibraries:j}=await import("./fileTextExtractor-HZqzU4jo.js");return{extractTextFromFile:x,loadRequiredLibraries:j}},[]);d(),a("text","Загрузка файла...");const p=await i(c);n(r.id,{properties:{...r.properties,text:p,sourceFile:c.name}})}catch(i){console.error("Error loading file:",i),alert(`Ошибка: ${i instanceof Error?i.message:"Не удалось загрузить файл"}`),a("text","Text")}s.target.value=""}}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Поддерживаются: TXT, PDF, ODT, DOCX"}),r.properties.sourceFile&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📄 ",r.properties.sourceFile]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Шрифт"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:144})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Семейство шрифта"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Impact",children:"Impact"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Начертание"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"bold",children:"Жирный"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль"}),e.jsxs("select",{value:r.properties.fontStyle||"normal",onChange:s=>a("fontStyle",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"italic",children:"Курсив"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Декорация"}),e.jsxs("select",{value:r.properties.textDecoration||"none",onChange:s=>a("textDecoration",s.target.value),children:[e.jsx("option",{value:"none",children:"Нет"}),e.jsx("option",{value:"underline",children:"Подчёркнутый"}),e.jsx("option",{value:"line-through",children:"Зачёркнутый"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Выравнивание"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"По горизонтали"}),e.jsxs("select",{value:r.properties.textAlign||"left",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"По левому краю"}),e.jsx("option",{value:"center",children:"По центру"}),e.jsx("option",{value:"right",children:"По правому краю"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"По вертикали"}),e.jsxs("select",{value:r.properties.verticalAlign||"top",onChange:s=>a("verticalAlign",s.target.value),children:[e.jsx("option",{value:"top",children:"Сверху"}),e.jsx("option",{value:"middle",children:"По центру"}),e.jsx("option",{value:"bottom",children:"Снизу"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Цвета и фон"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#000000",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#ffffff",onChange:s=>a("backgroundColor",s.target.value)}),e.jsxs("label",{style:{marginTop:"4px",fontSize:"11px"},children:[e.jsx("input",{type:"checkbox",checked:r.properties.backgroundColor==="transparent",onChange:s=>a("backgroundColor",s.target.checked?"transparent":"#ffffff")}),"Прозрачный фон"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Дополнительно"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Межстрочный интервал"}),e.jsx("input",{type:"number",value:r.properties.lineHeight||1.2,onChange:s=>a("lineHeight",parseFloat(s.target.value)),min:.5,max:3,step:.1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Отступ от края"}),e.jsx("input",{type:"number",value:r.properties.padding||8,onChange:s=>a("padding",parseInt(s.target.value)),min:0,max:50})]})]}),r.type==="image"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"0",marginBottom:"12px",fontSize:"13px",fontWeight:"bold"},children:"Режим"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:!r.properties.galleryMode,onChange:()=>a("galleryMode",!1)})," ","Одиночное изображение"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:r.properties.galleryMode||!1,onChange:()=>{a("galleryMode",!0),r.properties.sources||a("sources",[])}})," ","Галерея изображений"]})}),!r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL изображения"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить файл"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{const c=s.target.files?.[0];if(c){const i=new FileReader;i.onload=d=>{const p=d.target?.result;p&&n(r.id,{properties:{...r.properties,src:p,isLocalFile:!0,fileName:c.name}})},i.readAsDataURL(c)}s.target.value=""}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📁 ",r.properties.fileName]})]})]}),r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Источники (макс. 50)"}),e.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"8px",marginBottom:"8px",backgroundColor:"#fafafa"},children:[(r.properties.sources||[]).map((s,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",padding:"6px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #e0e0e0"},children:[e.jsxs("span",{style:{fontSize:"11px",color:"#666",minWidth:"20px"},children:[c+1,"."]}),e.jsx("span",{style:{fontSize:"11px",color:s.type==="url"?"#007acc":"#2ecc71"},children:s.type==="url"?"🌐":"📷"}),e.jsx("span",{style:{flex:1,fontSize:"11px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.value.length>40?s.value.substring(0,40)+"...":s.value}),e.jsx("button",{onClick:()=>{const i=(r.properties.sources||[]).filter((d,p)=>p!==c);a("sources",i)},style:{padding:"2px 6px",fontSize:"10px",border:"none",background:"#e74c3c",color:"#fff",borderRadius:"3px",cursor:"pointer"},children:"✕"})]},s.id)),(!r.properties.sources||r.properties.sources.length===0)&&e.jsx("div",{style:{textAlign:"center",color:"#999",fontSize:"11px",padding:"20px"},children:"Нет изображений в галерее"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,id:`gallery-upload-${r.id}`,style:{display:"none"},onChange:s=>{const c=Array.from(s.target.files||[]),i=r.properties.sources||[];if(i.length+c.length>50){alert("Максимум 50 изображений в галерее"),s.target.value="";return}let d=0;const p=[];c.forEach(x=>{const j=new FileReader;j.onload=m=>{const k=m.target?.result;k&&p.push({id:`img-${Date.now()}-${Math.random()}`,type:"local",value:k}),d++,d===c.length&&a("sources",[...i,...p])},j.readAsDataURL(x)}),s.target.value=""}}),e.jsx("button",{onClick:()=>{document.getElementById(`gallery-upload-${r.id}`)?.click()},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"📷 Добавить файлы"}),e.jsx("button",{onClick:()=>{const s=prompt("Введите URL изображения:");if(s){const c=r.properties.sources||[];if(c.length>=50){alert("Максимум 50 изображений в галерее");return}a("sources",[...c,{id:`img-${Date.now()}-${Math.random()}`,type:"url",value:s}])}},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"🌐 Добавить URL"})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Автопереключение"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoSwitch||!1,onChange:s=>a("autoSwitch",s.target.checked)})," ","Включить автопереключение"]})}),r.properties.autoSwitch&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Интервал (секунды)"}),e.jsx("input",{type:"number",min:"1",max:"60",value:r.properties.switchInterval||3,onChange:s=>a("switchInterval",parseInt(s.target.value)||3)})]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Эффекты перехода"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Эффект"}),e.jsxs("select",{value:r.properties.transition||"fade",onChange:s=>a("transition",s.target.value),children:[e.jsx("option",{value:"none",children:"Нет (мгновенно)"}),e.jsx("option",{value:"fade",children:"Затухание"}),e.jsx("option",{value:"slide",children:"Скольжение"}),e.jsx("option",{value:"zoom",children:"Увеличение"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Длительность (мс)"}),e.jsx("input",{type:"number",min:"100",max:"2000",step:"100",value:r.properties.transitionDuration||500,onChange:s=>a("transitionDuration",parseInt(s.target.value)||500)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Контролы"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showControls!==!1,onChange:s=>a("showControls",s.target.checked)})," ","Показать стрелки"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showIndicators!==!1,onChange:s=>a("showIndicators",s.target.checked)})," ","Показать индикаторы"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop!==!1,onChange:s=>a("loop",s.target.checked)})," ","Зацикливание"]})})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип заполнения"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"Пропорционально (вписать)"}),e.jsx("option",{value:"cover",children:"Заполнить весь виджет"}),e.jsx("option",{value:"fill",children:"Растянуть"}),e.jsx("option",{value:"scale-down",children:"Оригинальный размер"}),e.jsx("option",{value:"adaptive",children:"Адаптивный (изменить виджет)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Форма обрезки"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Форма"}),e.jsxs("select",{value:r.properties.clipShape||"rectangle",onChange:s=>a("clipShape",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"⬜ Прямоугольник"}),e.jsx("option",{value:"circle",children:"⚫ Круг"}),e.jsx("option",{value:"ellipse",children:"🔴 Эллипс"}),e.jsx("option",{value:"triangle",children:"🔺 Треугольник"}),e.jsx("option",{value:"diamond",children:"🔶 Ромб"}),e.jsx("option",{value:"pentagon",children:"⬢ Пятиугольник"}),e.jsx("option",{value:"hexagon",children:"⬡ Шестиугольник"}),e.jsx("option",{value:"octagon",children:"⭐ Восьмиугольник"}),e.jsx("option",{value:"rounded-rectangle",children:"🏷️ Закругленный прямоугольник"})]})]}),r.properties.clipShape==="rounded-rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Радиус углов (px)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.properties.cornerRadius||20,onChange:s=>a("cornerRadius",parseInt(s.target.value)||20)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"Включить рамку"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"}),e.jsx("option",{value:"double",children:"Двойная"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки (px)"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseFloat(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="video"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип источника"}),e.jsxs("select",{value:r.properties.sourceType||"url",onChange:s=>a("sourceType",s.target.value),children:[e.jsx("option",{value:"url",children:"URL / Файл"}),e.jsx("option",{value:"rtsp",children:"RTSP поток"})]})]}),r.properties.sourceType==="rtsp"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"RTSP URL"}),e.jsx("input",{type:"text",value:r.properties.rtspUrl||"",onChange:s=>a("rtspUrl",s.target.value),placeholder:"rtsp://username:password@host:554/stream"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Пример: rtsp://admin:12345@192.168.1.100:554/live"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL видео"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/video.mp4"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить файл"}),e.jsx("input",{type:"file",accept:"video/*",onChange:async s=>{const c=s.target.files?.[0];if(c){if(c.size>524288e3){alert("⚠️ Файл слишком большой! Максимум 500 MB"),s.target.value="";return}try{if(console.log(`⏳ Загрузка видео (${(c.size/(1024*1024)).toFixed(1)} MB)...`),!t?.id){alert("❌ Сначала создайте или откройте проект"),s.target.value="";return}const d=await H.uploadFile(t.id,c);d&&(n(r.id,{properties:{...r.properties,src:d.url,isLocalFile:!1,fileName:c.name}}),alert("✅ Видео загружено на сервер!"))}catch(d){console.error("Upload error:",d),alert("❌ Ошибка загрузки: "+d.message)}s.target.value=""}}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📁 ",r.properties.fileName]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Отображение"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип заполнения"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"Пропорционально (вписать)"}),e.jsx("option",{value:"cover",children:"Заполнить весь виджет"}),e.jsx("option",{value:"fill",children:"Растянуть"}),e.jsx("option",{value:"scale-down",children:"Оригинальный размер"}),e.jsx("option",{value:"adaptive",children:"Адаптивный (изменить виджет)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Воспроизведение"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoplay||!1,onChange:s=>a("autoplay",s.target.checked)}),"Автовоспроизведение"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop||!1,onChange:s=>a("loop",s.target.checked)}),"Повтор (loop)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.muted!==!1,onChange:s=>a("muted",s.target.checked)}),"Без звука (muted)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.controls!==!1,onChange:s=>a("controls",s.target.checked)}),"Показывать элементы управления"]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"Включить рамку"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"}),e.jsx("option",{value:"double",children:"Двойная"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="menu"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Ориентация"}),e.jsxs("select",{value:r.properties.orientation||"horizontal",onChange:s=>a("orientation",s.target.value),children:[e.jsx("option",{value:"horizontal",children:"Горизонтальная"}),e.jsx("option",{value:"vertical",children:"Вертикальная"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Внешний вид"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2c3e50",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет при наведении"}),e.jsx("input",{type:"color",value:r.properties.hoverColor||"#34495e",onChange:s=>a("hoverColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Шрифт"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:10,max:32})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Семейство шрифта"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Размеры"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Высота пункта"}),e.jsx("input",{type:"number",value:r.properties.itemHeight||40,onChange:s=>a("itemHeight",parseInt(s.target.value)),min:30,max:100})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Отступ пункта"}),e.jsx("input",{type:"number",value:r.properties.itemPadding||16,onChange:s=>a("itemPadding",parseInt(s.target.value)),min:8,max:40})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Подменю"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона подменю"}),e.jsx("input",{type:"color",value:r.properties.submenuBackgroundColor||"#34495e",onChange:s=>a("submenuBackgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста подменю"}),e.jsx("input",{type:"color",value:r.properties.submenuTextColor||"#ffffff",onChange:s=>a("submenuTextColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Пункты меню"}),e.jsx("div",{className:"property-field",children:e.jsx("button",{className:"btn-secondary",onClick:()=>{const s=r.properties.items||[],c={id:`item-${Date.now()}`,label:"Новый пункт"};n(r.id,{properties:{...r.properties,items:[...s,c]}})},style:{width:"100%"},children:"➕ Добавить пункт"})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:(r.properties.items||[]).map((s,c)=>e.jsxs("div",{style:{background:"#252525",padding:"12px",marginBottom:"8px",borderRadius:"6px",border:"1px solid #333"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("strong",{style:{fontSize:"12px",color:"#aaa"},children:["Пункт ",c+1]}),e.jsx("button",{className:"btn-danger",onClick:()=>{const i=r.properties.items||[];n(r.id,{properties:{...r.properties,items:i.filter(d=>d.id!==s.id)}})},style:{fontSize:"11px",padding:"4px 8px"},children:"🗑️ Удалить"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Название"}),e.jsx("input",{type:"text",value:s.label,onChange:i=>{const d=[...r.properties.items||[]];d[c]={...d[c],label:i.target.value},n(r.id,{properties:{...r.properties,items:d}})}})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"Действия при клике"}),e.jsx(Ae,{widget:{...r,id:s.id,properties:s},onUpdate:i=>{const d=[...r.properties.items||[]];d[c]={...d[c],actions:i},n(r.id,{properties:{...r.properties,items:d}})},allWidgets:t.widgets})]}),e.jsxs("div",{style:{marginTop:"12px",paddingLeft:"12px",borderLeft:"2px solid #444"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"Подпункты"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{const i=[...r.properties.items||[]],d=i[c].children||[];i[c]={...i[c],children:[...d,{id:`subitem-${Date.now()}`,label:"Подпункт"}]},n(r.id,{properties:{...r.properties,items:i}})},style:{width:"100%",fontSize:"11px",padding:"6px",marginBottom:"8px"},children:"➕ Добавить подпункт"}),(s.children||[]).map((i,d)=>e.jsx("div",{style:{background:"#1e1e1e",padding:"8px",marginBottom:"6px",borderRadius:"4px",border:"1px solid #2a2a2a"},children:e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"text",value:i.label,onChange:p=>{const x=[...r.properties.items||[]],j=[...x[c].children||[]];j[d]={...j[d],label:p.target.value},x[c]={...x[c],children:j},n(r.id,{properties:{...r.properties,items:x}})},style:{flex:1,fontSize:"12px",padding:"4px 8px"}}),e.jsx("button",{className:"btn-danger",onClick:()=>{const p=[...r.properties.items||[]],x=p[c].children?.filter(j=>j.id!==i.id)||[];p[c]={...p[c],children:x},n(r.id,{properties:{...r.properties,items:p}})},style:{fontSize:"11px",padding:"4px 8px"},children:"🗑️"})]})},i.id))]})]},s.id))})]})]}),e.jsx("div",{className:"property-section",children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID"}),e.jsx("input",{type:"text",value:r.id,disabled:!0,style:{opacity:.5,cursor:"not-allowed"}})]})})]})]}):e.jsxs("div",{className:"properties-panel panel",children:[e.jsx("div",{className:"properties-header",children:e.jsx("h3",{children:"Свойства"})}),e.jsx("div",{className:"properties-empty",children:e.jsx("p",{children:"Выберите виджет для редактирования"})})]})},jr=()=>{const t=Le(),[o,n]=S.useState(0),{project:r,restoreProject:h,selectedWidgetIds:a,copy:s,paste:c,cut:i,deleteWidget:d,undo:p,redo:x}=U();return S.useEffect(()=>{(async()=>{console.log("[Editor] Checking for project to restore...");const m=await h();console.log(m?"[Editor] Project restored successfully":"[Editor] No project to restore")})()},[]),S.useEffect(()=>{const j=k=>{const u=k.detail?.reason||"unknown";console.log("[Editor] Logout event received, reason:",u),u==="inactivity"&&sessionStorage.setItem("kiosk_logout_reason","inactivity"),t("/login",{replace:!0})},m=()=>{console.log("[Editor] Unauthorized event received"),sessionStorage.setItem("kiosk_logout_reason","session_expired"),t("/login",{replace:!0})};return window.addEventListener("auth:logout",j),window.addEventListener("auth:unauthorized",m),()=>{window.removeEventListener("auth:logout",j),window.removeEventListener("auth:unauthorized",m)}},[t]),S.useEffect(()=>{const j=m=>{(m.ctrlKey||m.metaKey)&&m.key==="z"&&!m.shiftKey&&(m.preventDefault(),p()),(m.ctrlKey||m.metaKey)&&m.key==="z"&&m.shiftKey&&(m.preventDefault(),x()),(m.ctrlKey||m.metaKey)&&m.key==="c"&&(m.preventDefault(),s()),(m.ctrlKey||m.metaKey)&&m.key==="v"&&(m.preventDefault(),c()),(m.ctrlKey||m.metaKey)&&m.key==="x"&&(m.preventDefault(),i()),m.key==="Delete"&&(m.preventDefault(),a.forEach(k=>d(k)))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[]),S.useEffect(()=>{const j=()=>{n(m=>m+1)};return window.addEventListener("auth:login",j),()=>window.removeEventListener("auth:login",j)},[]),e.jsxs("div",{className:"editor",children:[e.jsx(Ft,{}),e.jsx(tr,{}),e.jsxs("div",{className:"editor-main",children:[e.jsx(xr,{}),e.jsx(pr,{}),e.jsx(mr,{})]})]})},vr=({children:t})=>H.isAuthenticated()?e.jsx(e.Fragment,{children:t}):(console.log("[ProtectedRoute] Not authenticated, redirecting to /login"),e.jsx(ge,{to:"/login",replace:!0})),yr=()=>(console.log("[App.tsx] App component rendering with Router"),e.jsx(Ge,{children:e.jsxs(Ye,{children:[e.jsx(re,{path:"/",element:e.jsx(ge,{to:"/login",replace:!0})}),e.jsx(re,{path:"/login",element:e.jsx(Rt,{})}),e.jsx(re,{path:"/editor",element:e.jsx(vr,{children:e.jsx(jr,{})})}),e.jsx(re,{path:"*",element:e.jsx(ge,{to:"/login",replace:!0})}),e.jsx(re,{path:"/preview",element:e.jsx(At,{})})]})}));try{const t=document.getElementById("root");if(!t)throw new Error("Root element not found");st.createRoot(t).render(e.jsx(V.StrictMode,{children:e.jsx(yr,{})}))}catch(t){console.error("Failed to mount React app:",t),document.body.innerHTML=`
    <div style="
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #1e1e1e;
      color: #ff6b6b;
      font-family: Arial, sans-serif;
      padding: 20px;
    ">
      <div style="text-align: center; max-width: 600px;">
        <h1>❌ Ошибка загрузки редактора</h1>
        <p style="color: #cccccc;">Проверьте консоль браузера (F12) для деталей.</p>
        <pre style="
          text-align: left;
          background: #2a2a2a;
          padding: 15px;
          border-radius: 5px;
          overflow-x: auto;
          color: #ff6b6b;
        ">${t}</pre>
        <button onclick="location.reload()" style="
          margin-top: 20px;
          padding: 10px 20px;
          background: #4a90e2;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        ">
          Перезагрузить страницу
        </button>
      </div>
    </div>
  `}
//# sourceMappingURL=index-0F-Ru_uO.js.map
