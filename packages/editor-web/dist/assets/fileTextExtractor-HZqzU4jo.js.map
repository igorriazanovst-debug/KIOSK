{"version":3,"file":"fileTextExtractor-HZqzU4jo.js","sources":["../../src/utils/fileTextExtractor.ts"],"sourcesContent":["// Утилита для извлечения текста из различных форматов файлов\n\n/**\n * Извлекает текст из текстового файла\n */\nexport const extractTextFromTxt = (file: File): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      resolve(e.target?.result as string);\n    };\n    reader.onerror = reject;\n    reader.readAsText(file);\n  });\n};\n\n/**\n * Извлекает текст из PDF файла\n * Использует встроенный браузерный парсер или библиотеку pdf.js\n */\nexport const extractTextFromPdf = async (file: File): Promise<string> => {\n  try {\n    // Используем pdfjs-dist если доступен\n    // @ts-ignore\n    if (typeof window !== 'undefined' && window.pdfjsLib) {\n      // @ts-ignore\n      const pdfjsLib = window.pdfjsLib;\n      \n      const arrayBuffer = await file.arrayBuffer();\n      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\n      \n      let fullText = '';\n      \n      for (let i = 1; i <= pdf.numPages; i++) {\n        const page = await pdf.getPage(i);\n        const textContent = await page.getTextContent();\n        const pageText = textContent.items.map((item: any) => item.str).join(' ');\n        fullText += pageText + '\\n\\n';\n      }\n      \n      return fullText.trim();\n    }\n    \n    // Fallback: базовое извлечение текста\n    const text = await file.text();\n    return text;\n  } catch (error) {\n    console.error('Error extracting PDF text:', error);\n    throw new Error('Не удалось извлечь текст из PDF. Убедитесь, что файл не защищён паролем.');\n  }\n};\n\n/**\n * Извлекает текст из ODT файла\n * ODT - это ZIP архив с XML файлами\n */\nexport const extractTextFromOdt = async (file: File): Promise<string> => {\n  try {\n    // Используем JSZip если доступен\n    // @ts-ignore\n    if (typeof window !== 'undefined' && window.JSZip) {\n      // @ts-ignore\n      const JSZip = window.JSZip;\n      \n      const arrayBuffer = await file.arrayBuffer();\n      const zip = await JSZip.loadAsync(arrayBuffer);\n      \n      // content.xml содержит основной текст\n      const contentXml = await zip.file('content.xml')?.async('text');\n      \n      if (!contentXml) {\n        throw new Error('content.xml not found in ODT file');\n      }\n      \n      // Простой парсинг XML для извлечения текста\n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(contentXml, 'text/xml');\n      \n      // Извлекаем все текстовые узлы\n      const textNodes = xmlDoc.querySelectorAll('text\\\\:p, text\\\\:h, text\\\\:span');\n      const texts: string[] = [];\n      \n      textNodes.forEach(node => {\n        const text = node.textContent?.trim();\n        if (text) {\n          texts.push(text);\n        }\n      });\n      \n      return texts.join('\\n\\n');\n    }\n    \n    // Fallback\n    throw new Error('JSZip library not available');\n  } catch (error) {\n    console.error('Error extracting ODT text:', error);\n    throw new Error('Не удалось извлечь текст из ODT файла. Убедитесь, что файл не повреждён.');\n  }\n};\n\n/**\n * Извлекает текст из DOCX файла\n * DOCX - это тоже ZIP архив с XML\n */\nexport const extractTextFromDocx = async (file: File): Promise<string> => {\n  try {\n    // @ts-ignore\n    if (typeof window !== 'undefined' && window.JSZip) {\n      // @ts-ignore\n      const JSZip = window.JSZip;\n      \n      const arrayBuffer = await file.arrayBuffer();\n      const zip = await JSZip.loadAsync(arrayBuffer);\n      \n      // word/document.xml содержит текст\n      const documentXml = await zip.file('word/document.xml')?.async('text');\n      \n      if (!documentXml) {\n        throw new Error('document.xml not found in DOCX file');\n      }\n      \n      const parser = new DOMParser();\n      const xmlDoc = parser.parseFromString(documentXml, 'text/xml');\n      \n      // Извлекаем текст из параграфов\n      const textNodes = xmlDoc.querySelectorAll('w\\\\:t');\n      const texts: string[] = [];\n      \n      textNodes.forEach(node => {\n        const text = node.textContent?.trim();\n        if (text) {\n          texts.push(text);\n        }\n      });\n      \n      return texts.join(' ');\n    }\n    \n    throw new Error('JSZip library not available');\n  } catch (error) {\n    console.error('Error extracting DOCX text:', error);\n    throw new Error('Не удалось извлечь текст из DOCX файла.');\n  }\n};\n\n/**\n * Универсальная функция для извлечения текста из файла\n */\nexport const extractTextFromFile = async (file: File): Promise<string> => {\n  const extension = file.name.split('.').pop()?.toLowerCase();\n  \n  switch (extension) {\n    case 'txt':\n    case 'text':\n      return extractTextFromTxt(file);\n    \n    case 'pdf':\n      return extractTextFromPdf(file);\n    \n    case 'odt':\n      return extractTextFromOdt(file);\n    \n    case 'docx':\n      return extractTextFromDocx(file);\n    \n    case 'doc':\n      throw new Error('Формат .doc не поддерживается. Пожалуйста, конвертируйте в .docx или .txt');\n    \n    default:\n      // Пытаемся прочитать как текст\n      return extractTextFromTxt(file);\n  }\n};\n\n/**\n * Загружает необходимые библиотеки\n */\nexport const loadRequiredLibraries = () => {\n  // Загружаем JSZip для ODT/DOCX\n  if (typeof window !== 'undefined') {\n    // @ts-ignore\n    if (!window.JSZip) {\n      const script = document.createElement('script');\n      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';\n      document.head.appendChild(script);\n    }\n    \n    // Загружаем PDF.js для PDF\n    // @ts-ignore\n    if (!window.pdfjsLib) {\n      const script = document.createElement('script');\n      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';\n      script.onload = () => {\n        // @ts-ignore\n        if (window.pdfjsLib) {\n          // @ts-ignore\n          window.pdfjsLib.GlobalWorkerOptions.workerSrc = \n            'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';\n        }\n      };\n      document.head.appendChild(script);\n    }\n  }\n};\n"],"names":["extractTextFromTxt","file","resolve","reject","reader","e","extractTextFromPdf","pdfjsLib","arrayBuffer","pdf","fullText","i","pageText","item","error","extractTextFromOdt","JSZip","contentXml","textNodes","texts","node","text","extractTextFromDocx","documentXml","extractTextFromFile","loadRequiredLibraries","script"],"mappings":"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"}