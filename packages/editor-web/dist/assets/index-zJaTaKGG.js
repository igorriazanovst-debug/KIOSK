import{r as me,d as $e,g as Re,b as y,u as We,R as G,N as ge,B as Be,e as He,f as ie}from"./vendor-COey_eQ5.js";import{I as se,G as K,R as E,T as D,L as re,a as oe,S as Ue,E as qe,C as Ge,b as Ve,c as Xe,d as Ke}from"./konva-CDS8iPAx.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const a of d)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(d){const a={};return d.integrity&&(a.integrity=d.integrity),d.referrerPolicy&&(a.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?a.credentials="include":d.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(d){if(d.ep)return;d.ep=!0;const a=n(d);fetch(d.href,a)}})();var ce={exports:{}},te={};var je;function Ye(){if(je)return te;je=1;var t=me(),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,d=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(l,i,c){var p,u={},f=null,x=null;c!==void 0&&(f=""+c),i.key!==void 0&&(f=""+i.key),i.ref!==void 0&&(x=i.ref);for(p in i)r.call(i,p)&&!a.hasOwnProperty(p)&&(u[p]=i[p]);if(l&&l.defaultProps)for(p in i=l.defaultProps,i)u[p]===void 0&&(u[p]=i[p]);return{$$typeof:o,type:l,key:f,ref:x,props:u,_owner:d.current}}return te.Fragment=n,te.jsx=s,te.jsxs=s,te}var ve;function Ze(){return ve||(ve=1,ce.exports=Ye()),ce.exports}var e=Ze(),ae={},ye;function Je(){if(ye)return ae;ye=1;var t=$e();return ae.createRoot=t.createRoot,ae.hydrateRoot=t.hydrateRoot,ae}var Qe=Je();const et=Re(Qe);var tt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const rt=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),st=(t,o)=>{const n=y.forwardRef(({color:r="currentColor",size:d=24,strokeWidth:a=2,absoluteStrokeWidth:s,children:l,...i},c)=>y.createElement("svg",{ref:c,...tt,width:d,height:d,stroke:r,strokeWidth:s?Number(a)*24/Number(d):a,className:`lucide lucide-${rt(t)}`,...i},[...o.map(([p,u])=>y.createElement(p,u)),...(Array.isArray(l)?l:[l])||[]]));return n.displayName=`${t}`,n};var W=st;const Ae=W("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),nt=W("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),it=W("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),le=W("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),ot=W("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),at=W("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),be=W("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Le=W("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),lt=W("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ct=W("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),dt=W("Magnet",[["path",{d:"m6 15-4-4 6.75-6.77a7.79 7.79 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15",key:"1i3lhw"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}],["path",{d:"m12 15 4 4",key:"lnac28"}]]),ht=W("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),pt=W("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),ut=W("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),xt=W("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ft=W("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]),gt=W("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),mt=W("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),jt=W("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Me=W("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),vt=W("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),yt=W("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),bt=W("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),kt=W("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),St=W("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),De=W("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ct=W("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Nt=W("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);class wt{logs=[];MAX_LOGS=100;log(o,n,r){const d={timestamp:new Date().toISOString(),level:o,message:n,details:r};this.logs.push(d),this.logs.length>this.MAX_LOGS&&this.logs.shift(),(o==="error"?console.error:o==="warn"?console.warn:console.log)(`[${o.toUpperCase()}] ${n}`,r||"")}info(o,n){this.log("info",o,n)}warn(o,n){this.log("warn",o,n)}error(o,n){this.log("error",o,n)}getLogs(){return[...this.logs]}clear(){this.logs=[]}export(){return JSON.stringify(this.logs,null,2)}}const M=new wt;class Tt{DEBUG_MODE=!0;DEBUG_INACTIVITY_MINUTES=3;baseUrl="";token=null;organizationName=null;plan=null;lastActivity=Date.now();inactivityTimer=null;warningTimer=null;INACTIVITY_TIMEOUT=this.DEBUG_MODE?this.DEBUG_INACTIVITY_MINUTES*60*1e3:1800*1e3;WARNING_TIME=this.DEBUG_MODE?(this.DEBUG_INACTIVITY_MINUTES-2)*60*1e3:1680*1e3;constructor(){this.loadToken(),this.startActivityMonitoring()}loadToken(){const o=sessionStorage.getItem("kiosk_auth_token");if(o)try{const n=JSON.parse(o),r=n.lastActivityTime||Date.now(),d=Date.now()-r;d<this.INACTIVITY_TIMEOUT?(this.token=n.token,this.organizationName=n.organizationName||null,this.plan=n.plan||null,this.lastActivity=Date.now(),this.updateActivityTime(),M.info("Token loaded from sessionStorage",{hasToken:!!this.token,organization:this.organizationName,plan:this.plan,inactiveDuration:Math.round(d/1e3)+"s"})):(M.warn("Session expired due to inactivity",{inactiveDuration:Math.round(d/1e3/60)+" minutes"}),this.clearToken())}catch(n){M.error("Failed to parse stored token",n),this.clearToken()}}saveToken(o,n,r){const d={token:o,organizationName:n,plan:r,lastActivityTime:Date.now(),savedAt:new Date().toISOString()};sessionStorage.setItem("kiosk_auth_token",JSON.stringify(d)),sessionStorage.setItem("kiosk_org_data",JSON.stringify({name:n,plan:r})),this.token=o,this.organizationName=n,this.plan=r,this.lastActivity=Date.now(),M.info("Token saved to sessionStorage",{organization:n,plan:r})}updateActivityTime(){const o=sessionStorage.getItem("kiosk_auth_token");if(o)try{const n=JSON.parse(o);n.lastActivityTime=Date.now(),sessionStorage.setItem("kiosk_auth_token",JSON.stringify(n))}catch(n){M.error("Failed to update activity time",n)}}clearToken(){sessionStorage.removeItem("kiosk_auth_token"),sessionStorage.removeItem("kiosk_org_data"),this.token=null,this.organizationName=null,this.plan=null,M.info("Token cleared from sessionStorage")}isAuthenticated(){return this.token!==null}getToken(){return this.token}getOrganizationData(){return{name:this.organizationName,plan:this.plan}}async loginWithLicense(o){M.info("Attempting login with license key");try{const n=await this.request("/api/auth/license",{method:"POST",body:JSON.stringify({licenseKey:o})});return n.token&&n.license&&(this.saveToken(n.token,n.license.organizationName,n.license.plan),M.info("Login successful",{organization:n.license.organizationName,plan:n.license.plan})),n}catch(n){throw M.error("Login failed",n),n}}async refreshToken(){M.info("Refreshing token");try{const o=await this.request("/api/auth/refresh",{method:"POST",authenticated:!0});return o.token&&o.license&&(this.saveToken(o.token,o.license.organizationName,o.license.plan),M.info("Token refreshed successfully")),o}catch(o){throw M.error("Token refresh failed",o),o}}async verifyToken(){try{return await this.request("/api/auth/verify",{method:"GET",authenticated:!0}),M.info("Token verified successfully"),!0}catch(o){return M.warn("Token verification failed",o),this.clearToken(),!1}}logout(){M.info("User logout"),this.clearToken(),this.stopActivityMonitoring(),window.dispatchEvent(new CustomEvent("auth:logout"))}updateActivity(){this.lastActivity=Date.now(),this.updateActivityTime(),this.resetTimers()}resetTimers(){this.warningTimer&&clearTimeout(this.warningTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer=setTimeout(()=>{M.warn("Inactivity warning - 2 minutes until logout"),window.dispatchEvent(new CustomEvent("auth:inactivity-warning",{detail:{timeRemaining:120*1e3}}))},this.WARNING_TIME),this.inactivityTimer=setTimeout(()=>{M.warn("Session expired due to inactivity"),this.logout()},this.INACTIVITY_TIMEOUT)}startActivityMonitoring(){if(!this.isAuthenticated())return;["mousemove","keypress","click","scroll","touchstart"].forEach(n=>{window.addEventListener(n,()=>this.updateActivity(),{passive:!0})}),this.resetTimers(),M.info("Activity monitoring started",{timeout:this.INACTIVITY_TIMEOUT/1e3/60+" minutes",warning:this.WARNING_TIME/1e3/60+" minutes"})}stopActivityMonitoring(){this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null),this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),M.info("Activity monitoring stopped")}async getProjects(o){const n=new URLSearchParams;o?.search&&n.append("search",o.search),o?.tags&&n.append("tags",o.tags.join(",")),o?.isPublished!==void 0&&n.append("isPublished",String(o.isPublished)),o?.page&&n.append("page",String(o.page)),o?.limit&&n.append("limit",String(o.limit));const r=n.toString(),d=`/api/projects${r?"?"+r:""}`;return this.request(d,{method:"GET",authenticated:!0})}async createProject(o){return(await this.request("/api/projects",{method:"POST",authenticated:!0,body:JSON.stringify(o)})).project}async getProject(o){return(await this.request(`/api/projects/${o}`,{method:"GET",authenticated:!0})).project}async updateProject(o,n){return(await this.request(`/api/projects/${o}`,{method:"PUT",authenticated:!0,body:JSON.stringify(n)})).project}async deleteProject(o){await this.request(`/api/projects/${o}`,{method:"DELETE",authenticated:!0})}async getProjectFiles(o){return(await this.request(`/api/projects/${o}/files`,{method:"GET",authenticated:!0})).files}async uploadFile(o,n,r){const d=new FormData;return d.append("file",n),new Promise((a,s)=>{const l=new XMLHttpRequest;r&&l.upload.addEventListener("progress",i=>{if(i.lengthComputable){const c=i.loaded/i.total*100;r(c)}}),l.addEventListener("load",()=>{if(l.status===200||l.status===201)try{const i=JSON.parse(l.responseText);a(i.file||i)}catch{s(new Error("Failed to parse response"))}else try{const i=JSON.parse(l.responseText);s(new Error(i.message||`Upload failed: ${l.status}`))}catch{s(new Error(`Upload failed: ${l.status}`))}}),l.addEventListener("error",()=>{s(new Error("Network error"))}),l.open("POST",`/api/projects/${o}/files`),this.token&&l.setRequestHeader("Authorization",`Bearer ${this.token}`),l.send(d)})}async downloadFile(o,n){const r=await fetch(`/api/projects/${o}/files/${n}`,{method:"GET",headers:this.token?{Authorization:`Bearer ${this.token}`}:{}});if(!r.ok)throw new Error(`Download failed: ${r.status}`);return r.blob()}async deleteFile(o,n){await this.request(`/api/projects/${o}/files/${n}`,{method:"DELETE",authenticated:!0})}async getStorageStats(){return this.request("/api/storage/stats",{method:"GET",authenticated:!0})}async request(o,n){const r=`${this.baseUrl}${o}`,d={"Content-Type":"application/json"};n.authenticated&&this.token&&(d.Authorization=`Bearer ${this.token}`);try{const a=await fetch(r,{method:n.method,headers:d,body:n.body});if(n.authenticated&&a.ok&&this.updateActivity(),!a.ok){if(a.status===401)throw M.warn("Unauthorized - clearing token"),this.clearToken(),window.dispatchEvent(new CustomEvent("auth:unauthorized")),new Error("Unauthorized");const s=await a.json().catch(()=>({}));throw new Error(s.message||`HTTP ${a.status}`)}return await a.json()}catch(a){throw M.error("Request failed",{endpoint:o,method:n.method,error:a}),a}}}const U=new Tt,Et=()=>{const t=We(),[o,n]=y.useState(""),[r,d]=y.useState(!1),[a,s]=y.useState(null);y.useEffect(()=>{const x=sessionStorage.getItem("kiosk_logout_reason");x==="inactivity"?(i("–í—ã –±—ã–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"),M.info("Logout reason: inactivity")):x==="session_expired"&&(i("–í–∞—à–∞ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞"),M.info("Logout reason: session expired")),sessionStorage.removeItem("kiosk_logout_reason"),x&&setTimeout(()=>i(null),5e3)},[]);const[l,i]=y.useState(null),c=x=>(x.replace(/[^A-Z0-9]/gi,"").toUpperCase().match(/.{1,4}/g)||[]).join("-").substring(0,19),p=x=>{const v=c(x.target.value);n(v),s(null)},u=async x=>{if(x.preventDefault(),o.length<19){s("–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∫–ª—é—á –ª–∏—Ü–µ–Ω–∑–∏–∏ (16 —Å–∏–º–≤–æ–ª–æ–≤)");return}d(!0),s(null);try{console.log("[LoginPage] Attempting login");const v=await U.loginWithLicense(o);console.log("[LoginPage] Login successful, redirecting to /editor"),t("/editor",{replace:!0})}catch(v){console.error("[LoginPage] Login failed:",v),s(v.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ö–æ–¥. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –ª–∏—Ü–µ–Ω–∑–∏–∏."),d(!1)}},f=x=>{x.preventDefault();const v=x.clipboardData.getData("text"),m=c(v);n(m)};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-header",children:[e.jsx(be,{size:48,className:"login-icon"}),e.jsx("h1",{children:"Kiosk Editor"}),e.jsx("p",{children:"–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É"})]}),e.jsxs("form",{onSubmit:u,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"licenseKey",children:"–ö–ª—é—á –ª–∏—Ü–µ–Ω–∑–∏–∏"}),e.jsx("input",{type:"text",id:"licenseKey",placeholder:"XXXX-XXXX-XXXX-XXXX",value:o,onChange:p,onPaste:f,disabled:r,autoFocus:!0,maxLength:19,className:a?"error":""}),e.jsx("span",{className:"input-hint",children:"–§–æ—Ä–º–∞—Ç: 4 –≥—Ä—É–ø–ø—ã –ø–æ 4 —Å–∏–º–≤–æ–ª–∞"})]}),a&&e.jsxs("div",{className:"error-message",children:[e.jsx(Ae,{size:16}),e.jsx("span",{children:a})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:r||o.length<19,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:20,className:"spinner"}),e.jsx("span",{children:"–í—Ö–æ–¥..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{size:20}),e.jsx("span",{children:"–í–æ–π—Ç–∏"})]})})]}),e.jsxs("div",{className:"test-keys",children:[e.jsx("p",{children:"–¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"BASIC:"})," ",e.jsx("code",{children:"EWZA-E5LJ-Z558-9LUQ"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PRO:"})," ",e.jsx("code",{children:"3VBN-8ZQ9-1MKO-AK0R"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"MAX:"})," ",e.jsx("code",{children:"T8MH-FJE3-ETAC-YOZF"})]})]})]})]})})},It=()=>{const[t,o]=y.useState(!1),[n,r]=y.useState(120);if(y.useEffect(()=>{const s=()=>{o(!0),r(120)},l=()=>{o(!1)},i=()=>{t&&o(!1)};window.addEventListener("auth:inactivity-warning",s),window.addEventListener("auth:logout",l);const c=["mousemove","keypress","click","scroll","touchstart"];return c.forEach(p=>{window.addEventListener(p,i)}),()=>{window.removeEventListener("auth:inactivity-warning",s),window.removeEventListener("auth:logout",l),c.forEach(p=>{window.removeEventListener(p,i)})}},[t]),y.useEffect(()=>{if(!t)return;const s=setInterval(()=>{r(l=>l<=1?(o(!1),0):l-1)},1e3);return()=>clearInterval(s)},[t]),!t)return null;const d=Math.floor(n/60),a=n%60;return e.jsx("div",{className:"inactivity-warning-overlay",children:e.jsxs("div",{className:"inactivity-warning",children:[e.jsx("div",{className:"warning-icon",children:"‚è±Ô∏è"}),e.jsx("h3",{children:"–°–µ—Å—Å–∏—è —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á—ë—Ç"}),e.jsxs("p",{children:["–í—ã –±—É–¥–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑"," ",e.jsxs("strong",{children:[d,":",a.toString().padStart(2,"0")]})]}),e.jsx("p",{className:"hint",children:"–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –º—ã—à—å—é, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É"}),e.jsx("button",{className:"continue-btn",onClick:()=>o(!1),children:"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É"})]})})},zt={},ke=t=>{let o;const n=new Set,r=(p,u)=>{const f=typeof p=="function"?p(o):p;if(!Object.is(f,o)){const x=o;o=u??(typeof f!="object"||f===null)?f:Object.assign({},o,f),n.forEach(v=>v(o,x))}},d=()=>o,i={setState:r,getState:d,getInitialState:()=>c,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(zt?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},c=o=t(r,d,i);return i},Pt=t=>t?ke(t):ke;var de={exports:{}},he={},pe={exports:{}},ue={};var Se;function Rt(){if(Se)return ue;Se=1;var t=me();function o(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var n=typeof Object.is=="function"?Object.is:o,r=t.useState,d=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function l(u,f){var x=f(),v=r({inst:{value:x,getSnapshot:f}}),m=v[0].inst,k=v[1];return a(function(){m.value=x,m.getSnapshot=f,i(m)&&k({inst:m})},[u,x,f]),d(function(){return i(m)&&k({inst:m}),u(function(){i(m)&&k({inst:m})})},[u]),s(x),x}function i(u){var f=u.getSnapshot;u=u.value;try{var x=f();return!n(u,x)}catch{return!0}}function c(u,f){return f()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:l;return ue.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:p,ue}var Ce;function Wt(){return Ce||(Ce=1,pe.exports=Rt()),pe.exports}var Ne;function At(){if(Ne)return he;Ne=1;var t=me(),o=Wt();function n(c,p){return c===p&&(c!==0||1/c===1/p)||c!==c&&p!==p}var r=typeof Object.is=="function"?Object.is:n,d=o.useSyncExternalStore,a=t.useRef,s=t.useEffect,l=t.useMemo,i=t.useDebugValue;return he.useSyncExternalStoreWithSelector=function(c,p,u,f,x){var v=a(null);if(v.current===null){var m={hasValue:!1,value:null};v.current=m}else m=v.current;v=l(function(){function j(I){if(!N){if(N=!0,S=I,I=f(I),x!==void 0&&m.hasValue){var h=m.value;if(x(h,I))return T=h}return T=I}if(h=T,r(S,I))return h;var b=f(I);return x!==void 0&&x(h,b)?(S=I,h):(S=I,T=b)}var N=!1,S,T,P=u===void 0?null:u;return[function(){return j(p())},P===null?void 0:function(){return j(P())}]},[p,u,f,x]);var k=d(c,v[0],v[1]);return s(function(){m.hasValue=!0,m.value=k},[k]),i(k),k},he}var we;function Lt(){return we||(we=1,de.exports=At()),de.exports}var Mt=Lt();const Dt=Re(Mt),Fe={},{useDebugValue:Ft}=G,{useSyncExternalStoreWithSelector:_t}=Dt;let Te=!1;const Ot=t=>t;function $t(t,o=Ot,n){(Fe?"production":void 0)!=="production"&&n&&!Te&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Te=!0);const r=_t(t.subscribe,t.getState,t.getServerState||t.getInitialState,o,n);return Ft(r),r}const Ee=t=>{(Fe?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof t=="function"?Pt(t):t,n=(r,d)=>$t(o,r,d);return Object.assign(n,o),n},Bt=t=>t?Ee(t):Ee;let ee=null;function q(t,o=18e4){ee&&clearTimeout(ee),ee=setTimeout(async()=>{try{console.log("[Editor] Auto-saving project..."),await t(),console.log("[Editor] Auto-save completed")}catch(n){console.error("[Editor] Auto-save failed:",n)}},o)}function _e(){ee&&(clearTimeout(ee),ee=null)}function xe(t){t?(sessionStorage.setItem("kiosk_current_project_id",t),console.log("[Editor] Current project ID saved:",t)):(sessionStorage.removeItem("kiosk_current_project_id"),console.log("[Editor] Current project ID cleared"))}function Ht(){const t=sessionStorage.getItem("kiosk_current_project_id");return t&&console.log("[Editor] Restoring project ID:",t),t}const B=Bt((t,o)=>({project:{version:"1.0.0",name:"–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,isLoading:!1,isSaving:!1,lastSaved:null,saveError:null,selectedWidgetIds:[],clipboard:[],history:{past:[],future:[]},zoom:1,gridEnabled:!0,snapToGrid:!0,gridSize:20,gridLineWidth:1,gridColor:"#e0e0e0",pendingWidget:null,restoreProject:async()=>{const n=Ht();if(n)try{return console.log("[Editor] Restoring last opened project:",n),await o().loadProject(n),!0}catch(r){return console.error("[Editor] Failed to restore project:",r),xe(null),!1}return!1},createProject:async(n,r)=>{t({isLoading:!0,saveError:null});try{const d={version:"1.0",name:n,canvas:r,widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},a=await U.createProject({name:n,canvasWidth:r.width,canvasHeight:r.height,canvasBackground:r.backgroundColor||"#1a1a1a",projectData:d});t({project:{...d,id:a.id},projectId:a.id,isLoading:!1,lastSaved:new Date,history:{past:[],future:[]}}),console.log("[Editor] Project created:",a.id),xe(a.id),q(o().saveProject)}catch(d){throw console.error("[Editor] Failed to create project:",d),t({isLoading:!1,saveError:d.message||"Failed to create project"}),d}},loadProject:async n=>{t({isLoading:!0,saveError:null});try{const r=await U.getProject(n),d={id:r.id,version:"1.0",name:r.name,canvas:{width:r.canvasWidth,height:r.canvasHeight,backgroundColor:r.canvasBackground},widgets:r.projectData?.widgets||[],metadata:{createdAt:r.createdAt,updatedAt:r.updatedAt}};t({project:d,projectId:r.id,isLoading:!1,lastSaved:new Date(r.updatedAt),history:{past:[],future:[]}}),console.log("[Editor] Project loaded:",n),xe(n),q(o().saveProject)}catch(r){throw console.error("[Editor] Failed to load project:",r),t({isLoading:!1,saveError:r.message||"Failed to load project"}),r}},saveProject:async()=>{const{project:n,projectId:r,isSaving:d}=o();if(!n||!r){console.warn("[Editor] No project to save");return}if(d){console.warn("[Editor] Save already in progress");return}t({isSaving:!0,saveError:null});try{await U.updateProject(r,{name:n.name,projectData:n,canvasWidth:n.canvas.width,canvasHeight:n.canvas.height,canvasBackground:n.canvas.backgroundColor}),t({isSaving:!1,lastSaved:new Date,saveError:null}),console.log("[Editor] Project saved:",r)}catch(a){throw console.error("[Editor] Failed to save project:",a),t({isSaving:!1,saveError:a.message||"Failed to save project"}),a}},deleteProject:async n=>{try{await U.deleteProject(n),o().projectId===n&&(t({project:{version:"1.0.0",name:"–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,selectedWidgetIds:[],history:{past:[],future:[]}}),_e()),console.log("[Editor] Project deleted:",n)}catch(r){throw console.error("[Editor] Failed to delete project:",r),r}},updateProjectMetadata:n=>{const{project:r}=o();r&&(t({project:{...r,...n,metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),q(o().saveProject))},addWidget:n=>{const{project:r}=o();r&&(o().saveToHistory(),t({project:{...r,widgets:[...r.widgets,n],metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),q(o().saveProject))},setPendingWidget:(n,r)=>{t({pendingWidget:{type:n,defaultProps:r}})},clearPendingWidget:()=>{t({pendingWidget:null})},addWidgetAtPosition:(n,r)=>{const{pendingWidget:d,project:a,snapToGrid:s,gridSize:l}=o();if(!d||!a)return;let i=n,c=r;s&&(i=Math.round(n/l)*l,c=Math.round(r/l)*l);const u={shape:{width:200,height:200},button:{width:200,height:60},text:{width:300,height:100},image:{width:300,height:200},video:{width:640,height:360},menu:{width:600,height:40}}[d.type]||{width:200,height:100},f=d.defaultProps.width||u.width,x=d.defaultProps.height||u.height;i=i-f/2,c=c-x/2;const{width:v,height:m,...k}=d.defaultProps,j={id:`widget-${Date.now()}-${Math.random()}`,type:d.type,x:Math.max(0,i),y:Math.max(0,c),width:f,height:x,zIndex:0,properties:k};o().addWidget(j),o().clearPendingWidget()},updateWidget:(n,r)=>{const{project:d}=o();d&&(t({project:{...d,widgets:d.widgets.map(a=>a.id===n?{...a,...r}:a),metadata:{...d.metadata,updatedAt:new Date().toISOString()}}}),q(o().saveProject))},deleteWidget:n=>{const{project:r}=o();r&&(o().saveToHistory(),t({project:{...r,widgets:r.widgets.filter(d=>d.id!==n),metadata:{...r.metadata,updatedAt:new Date().toISOString()}},selectedWidgetIds:o().selectedWidgetIds.filter(d=>d!==n)}),q(o().saveProject))},duplicateWidget:n=>{const{project:r}=o();if(!r)return;const d=r.widgets.find(s=>s.id===n);if(!d)return;const a={...d,id:`widget-${Date.now()}`,x:d.x+20,y:d.y+20};o().addWidget(a)},selectWidget:(n,r=!1)=>{const{selectedWidgetIds:d}=o();r?d.includes(n)?t({selectedWidgetIds:d.filter(a=>a!==n)}):t({selectedWidgetIds:[...d,n]}):t({selectedWidgetIds:[n]})},clearSelection:()=>{t({selectedWidgetIds:[]})},saveToHistory:()=>{const{project:n,history:r}=o();n&&t({history:{past:[...r.past,n],future:[]}})},undo:()=>{const{history:n,project:r}=o();if(n.past.length===0||!r)return;const d=n.past[n.past.length-1],a=n.past.slice(0,-1);t({project:d,history:{past:a,future:[r,...n.future]}}),q(o().saveProject)},redo:()=>{const{history:n,project:r}=o();if(n.future.length===0||!r)return;const d=n.future[0],a=n.future.slice(1);t({project:d,history:{past:[...n.past,r],future:a}}),q(o().saveProject)},copy:()=>{const{project:n,selectedWidgetIds:r}=o();if(!n)return;const d=n.widgets.filter(a=>r.includes(a.id));t({clipboard:d})},paste:()=>{const{clipboard:n,project:r}=o();if(!r||n.length===0)return;const d=n.map(a=>({...a,id:`widget-${Date.now()}-${Math.random()}`,x:a.x+20,y:a.y+20}));o().saveToHistory(),t({project:{...r,widgets:[...r.widgets,...d]},selectedWidgetIds:d.map(a=>a.id)}),q(o().saveProject)},cut:()=>{const{selectedWidgetIds:n}=o();o().copy(),n.forEach(r=>o().deleteWidget(r))},setZoom:n=>{t({zoom:Math.max(.1,Math.min(5,n))})},toggleGrid:()=>{t(n=>({gridEnabled:!n.gridEnabled}))},toggleSnapToGrid:()=>{t(n=>({snapToGrid:!n.snapToGrid}))},setGridSize:n=>{t({gridSize:Math.max(5,Math.min(100,n))})}}));typeof window<"u"&&window.addEventListener("beforeunload",()=>{_e()});const Ut=()=>{const{isSaving:t,lastSaved:o,saveError:n}=B(),d=n?"error":t?"saving":o?"saved":"idle",a=l=>{const c=new Date().getTime()-l.getTime(),p=Math.floor(c/1e3),u=Math.floor(p/60);return p<10?"–¢–æ–ª—å–∫–æ —á—Ç–æ":p<60?`${p} —Å–µ–∫ –Ω–∞–∑–∞–¥`:u===1?"1 –º–∏–Ω –Ω–∞–∑–∞–¥":u<60?`${u} –º–∏–Ω –Ω–∞–∑–∞–¥`:l.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})},s=()=>{switch(d){case"saving":return e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:16,className:"spinner"}),e.jsx("span",{children:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."})]});case"saved":return e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:16}),e.jsxs("span",{children:["–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ",o&&a(o)]})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{size:16}),e.jsx("span",{title:n||void 0,children:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx(it,{size:16}),e.jsx("span",{children:"–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ"})]})}};return e.jsx("div",{className:`autosave-indicator status-${d}`,children:s()})},qt=({onClose:t,onSuccess:o})=>{const[n,r]=y.useState(""),[d,a]=y.useState(""),[s,l]=y.useState(1920),[i,c]=y.useState(1080),[p,u]=y.useState(!1),{createProject:f}=B(),x=async m=>{if(m.preventDefault(),!n.trim()){alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞");return}try{u(!0),console.log("[CreateProjectDialog] Creating project:",n),await f(n.trim(),{width:s,height:i,backgroundColor:"#ffffff"}),console.log("[CreateProjectDialog] Project created successfully"),o?.(),t()}catch(k){console.error("[CreateProjectDialog] Failed to create project:",k),alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç")}finally{u(!1)}},v=[{name:"Full HD (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)",width:1920,height:1080},{name:"Full HD (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)",width:1080,height:1920},{name:"4K (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)",width:3840,height:2160},{name:"HD (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)",width:1280,height:720}];return e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content create-project-dialog",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"–ó–∞–∫—Ä—ã—Ç—å",children:e.jsx(De,{size:24})})]}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"dialog-body",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-name",children:"–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *"}),e.jsx("input",{id:"project-name",type:"text",value:n,onChange:m=>r(m.target.value),placeholder:"–ú–æ–π –ø—Ä–æ–µ–∫—Ç",maxLength:100,autoFocus:!0})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-description",children:"–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"}),e.jsx("textarea",{id:"project-description",value:d,onChange:m=>a(m.target.value),placeholder:"–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞...",maxLength:500,rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"–†–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞"}),e.jsx("div",{className:"presets-grid",children:v.map((m,k)=>e.jsxs("button",{type:"button",className:`preset-btn ${s===m.width&&i===m.height?"active":""}`,onClick:()=>{l(m.width),c(m.height)},children:[e.jsx("span",{className:"preset-name",children:m.name}),e.jsxs("span",{className:"preset-size",children:[m.width,"√ó",m.height]})]},k))}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-width",children:"–®–∏—Ä–∏–Ω–∞ (px)"}),e.jsx("input",{id:"canvas-width",type:"number",value:s,onChange:m=>l(parseInt(m.target.value)||1920),min:320,max:7680})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-height",children:"–í—ã—Å–æ—Ç–∞ (px)"}),e.jsx("input",{id:"canvas-height",type:"number",value:i,onChange:m=>c(parseInt(m.target.value)||1080),min:240,max:4320})]})]})]})]}),e.jsxs("div",{className:"dialog-footer",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:t,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p,children:p?"–°–æ–∑–¥–∞–Ω–∏–µ...":"–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"})]})]})]})})},Gt=({onClose:t,onProjectLoaded:o})=>{const[n,r]=y.useState([]),[d,a]=y.useState(!0),[s,l]=y.useState(""),[i,c]=y.useState(!1),{loadProject:p,projectId:u}=B();y.useEffect(()=>{f()},[]);const f=async()=>{try{a(!0);const j=await U.getProjects();console.log("[ProjectsDialog] Projects loaded:",j.projects.length),r(j.projects)}catch(j){console.error("[ProjectsDialog] Failed to load projects:",j),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤")}finally{a(!1)}},x=async j=>{try{console.log("[ProjectsDialog] Opening project:",j),await p(j),o?.(),t()}catch(N){console.error("[ProjectsDialog] Failed to open project:",N),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç")}},v=async(j,N)=>{if(confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${N}"?`))try{console.log("[ProjectsDialog] Deleting project:",j),await U.deleteProject(j),r(n.filter(S=>S.id!==j)),alert("–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω")}catch(S){console.error("[ProjectsDialog] Failed to delete project:",S),alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç")}},m=()=>{c(!1),f()},k=n.filter(j=>j.name.toLowerCase().includes(s.toLowerCase())||j.description?.toLowerCase().includes(s.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content projects-dialog",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"–ó–∞–∫—Ä—ã—Ç—å",children:e.jsx(De,{size:24})})]}),e.jsxs("div",{className:"projects-toolbar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(mt,{size:18}),e.jsx("input",{type:"text",placeholder:"–ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤...",value:s,onChange:j=>l(j.target.value)})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>c(!0),children:[e.jsx(xt,{size:18}),e.jsx("span",{children:"–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"})]})]}),e.jsx("div",{className:"projects-list",children:d?e.jsx("div",{className:"loading-state",children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤..."})}):k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(le,{size:48}),e.jsx("p",{children:s?"–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã":"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤"}),e.jsx("button",{className:"btn-primary",onClick:()=>c(!0),children:"–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç"})]}):k.map(j=>e.jsxs("div",{className:`project-card ${j.id===u?"active":""}`,children:[e.jsx("div",{className:"project-thumbnail",children:j.thumbnail?e.jsx("img",{src:j.thumbnail,alt:j.name}):e.jsx("div",{className:"thumbnail-placeholder",children:e.jsx(le,{size:32})})}),e.jsxs("div",{className:"project-info",children:[e.jsx("h3",{children:j.name}),j.description&&e.jsx("p",{className:"project-description",children:j.description}),e.jsxs("div",{className:"project-meta",children:[e.jsxs("span",{children:[j.canvasWidth,"√ó",j.canvasHeight]}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:new Date(j.updatedAt).toLocaleDateString("ru-RU")})]}),j.tags&&j.tags.length>0&&e.jsx("div",{className:"project-tags",children:j.tags.map((N,S)=>e.jsx("span",{className:"tag",children:N},S))})]}),e.jsxs("div",{className:"project-actions",children:[e.jsxs("button",{className:"btn-primary",onClick:()=>x(j.id),title:"–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç",children:[e.jsx(le,{size:18}),e.jsx("span",{children:"–û—Ç–∫—Ä—ã—Ç—å"})]}),e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>v(j.id,j.name),title:"–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç",children:e.jsx(Me,{size:18})})]})]},j.id))}),e.jsx("div",{className:"dialog-footer",children:e.jsxs("p",{className:"projects-count",children:["–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: ",n.length]})})]})}),i&&e.jsx(qt,{onClose:()=>c(!1),onSuccess:m})]})},Vt=()=>{const{project:t,history:o,zoom:n,gridEnabled:r,snapToGrid:d,undo:a,redo:s,setZoom:l,toggleGrid:i,toggleSnapToGrid:c,saveProject:p}=B(),[u,f]=y.useState(null),[x,v]=y.useState(null),[m,k]=y.useState(!1);y.useEffect(()=>{const I=U.getOrganizationData();f(I.name),v(I.plan)},[]);const j=()=>{l(Math.min(n+.1,3))},N=()=>{l(Math.max(n-.1,.1))},S=()=>{confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?")&&(M.info("User initiated logout"),U.logout(),window.location.href="/login")},T=o.past.length>0,P=o.future.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsx("div",{className:"toolbar-logo",children:e.jsx("span",{className:"logo-text",children:"Kiosk Editor"})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:()=>p(),disabled:!t,title:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å (Ctrl+S)",children:e.jsx(gt,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:()=>k(!0),disabled:!t,title:"–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã",children:e.jsx(le,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:a,disabled:!T,title:"–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)",children:e.jsx(yt,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:s,disabled:!P,title:"–í–µ—Ä–Ω—É—Ç—å (Ctrl+Shift+Z)",children:e.jsx(ft,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:N,disabled:n<=.1,title:"–£–º–µ–Ω—å—à–∏—Ç—å (Ctrl+-)",children:e.jsx(Nt,{size:18})}),e.jsxs("span",{className:"toolbar-zoom",children:[Math.round(n*100),"%"]}),e.jsx("button",{className:"toolbar-btn",onClick:j,disabled:n>=3,title:"–£–≤–µ–ª–∏—á–∏—Ç—å (Ctrl++)",children:e.jsx(Ct,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-btn ${r?"active":""}`,onClick:i,title:"–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É",children:e.jsx(ot,{size:18})}),e.jsx("button",{className:`toolbar-btn ${d?"active":""}`,onClick:c,title:"–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ",children:e.jsx(dt,{size:18})})]}),e.jsxs("div",{className:"toolbar-section",children:[t&&e.jsx(Ut,{}),e.jsx("div",{className:"toolbar-divider"}),u&&e.jsxs("div",{className:"toolbar-user-info",children:[e.jsx(kt,{size:16}),e.jsx("span",{className:"user-org",children:u}),x&&e.jsx("span",{className:"user-plan",children:x})]}),e.jsx("button",{className:"toolbar-btn logout-btn",onClick:S,title:"–í—ã–π—Ç–∏",children:e.jsx(ct,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("button",{className:"toolbar-btn preview-btn",disabled:!t,title:"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä",children:[e.jsx(ut,{size:18}),e.jsx("span",{children:"–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä"})]})]})]}),m&&e.jsx(Gt,{onClose:()=>k(!1)})]})},Oe=({widget:t,image:o})=>{const n=y.useRef(null),{clipShape:r="rectangle",cornerRadius:d=0,opacity:a=1}=t.properties;return y.useEffect(()=>{if(!n.current||!o)return;const s=n.current,l=document.createElement("canvas"),i=l.getContext("2d");if(!i)return;l.width=t.width,l.height=t.height,i.clearRect(0,0,l.width,l.height),i.save();const c=t.width/2,p=t.height/2,u=Math.min(t.width,t.height)/2;switch(r){case"circle":i.beginPath(),i.arc(c,p,u,0,Math.PI*2),i.closePath();break;case"ellipse":i.beginPath(),i.ellipse(c,p,t.width/2,t.height/2,0,0,Math.PI*2),i.closePath();break;case"triangle":i.beginPath(),i.moveTo(c,p-u),i.lineTo(c+u*Math.cos(Math.PI/6),p+u*Math.sin(Math.PI/6)),i.lineTo(c-u*Math.cos(Math.PI/6),p+u*Math.sin(Math.PI/6)),i.closePath();break;case"diamond":i.beginPath(),i.moveTo(c,0),i.lineTo(t.width,p),i.lineTo(c,t.height),i.lineTo(0,p),i.closePath();break;case"pentagon":fe(i,c,p,u,5);break;case"hexagon":fe(i,c,p,u,6);break;case"octagon":fe(i,c,p,u,8);break;case"star":i.beginPath();for(let h=0;h<10;h++){const b=h*Math.PI/5-Math.PI/2,g=h%2===0?u:u*.5,w=c+g*Math.cos(b),F=p+g*Math.sin(b);h===0?i.moveTo(w,F):i.lineTo(w,F)}i.closePath();break;case"rounded-rectangle":Xt(i,0,0,t.width,t.height,d);break;default:i.rect(0,0,t.width,t.height);break}i.clip();const f=o.width/o.height,x=t.width/t.height;let v=0,m=0,k=o.width,j=o.height,N=0,S=0,T=t.width,P=t.height;f>x?(k=o.height*x,v=(o.width-k)/2):(j=o.width/x,m=(o.height-j)/2),i.drawImage(o,v,m,k,j,N,S,T,P),i.restore();const I=new window.Image;I.src=l.toDataURL(),I.onload=()=>{s&&(s.image(I),s.getLayer()?.batchDraw())}},[o,t.width,t.height,r,d]),o?e.jsx(se,{ref:n,image:void 0,width:t.width,height:t.height,opacity:a,listening:!1}):null};function fe(t,o,n,r,d){t.beginPath();for(let a=0;a<d;a++){const s=a*2*Math.PI/d-Math.PI/2,l=o+r*Math.cos(s),i=n+r*Math.sin(s);a===0?t.moveTo(l,i):t.lineTo(l,i)}t.closePath()}function Xt(t,o,n,r,d,a){t.beginPath(),t.moveTo(o+a,n),t.lineTo(o+r-a,n),t.quadraticCurveTo(o+r,n,o+r,n+a),t.lineTo(o+r,n+d-a),t.quadraticCurveTo(o+r,n+d,o+r-a,n+d),t.lineTo(o+a,n+d),t.quadraticCurveTo(o,n+d,o,n+d-a),t.lineTo(o,n+a),t.quadraticCurveTo(o,n,o+a,n),t.closePath()}const Kt=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),[l,i]=y.useState({}),[c,p]=y.useState(0),[u,f]=y.useState(!1),x=y.useRef(),{sources:v=[],autoSwitch:m=!1,switchInterval:k=3,transition:j="fade",clipShape:N="rectangle",loop:S=!0}=t.properties;y.useEffect(()=>{const h={};let b=0;return v.forEach(g=>{const w=new window.Image;w.crossOrigin="anonymous",w.onload=()=>{h[g.id]=w,b++,b===v.length&&i({...h})},w.onerror=()=>{console.error("Failed to load image:",g.value),b++,b===v.length&&i({...h})},w.src=g.value}),()=>{Object.values(h).forEach(g=>{g.onload=null,g.onerror=null})}},[v]),y.useEffect(()=>{if(!m||v.length<=1){x.current&&clearInterval(x.current);return}return x.current=setInterval(()=>{p(h=>{const b=h+1;return b>=v.length?S?0:h:b})},k*1e3),()=>{x.current&&clearInterval(x.current)}},[m,k,v.length,S]);const T=t.locked||!1,P=v[c],I=P?l[P.id]:null;return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!T,dragBoundFunc:a,opacity:T?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),(!I||v.length===0)&&e.jsx(E,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),I&&(N&&N!=="rectangle"?e.jsx(Oe,{widget:t,image:I}):e.jsx(se,{image:I,x:0,y:0,width:t.width,height:t.height,listening:!1})),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),v.length>1&&e.jsx(E,{x:t.width-40,y:t.height-20,width:35,height:15,fill:"rgba(0, 0, 0, 0.7)",cornerRadius:3,listening:!1}),v.length>1&&e.jsx(se,{x:t.width-35,y:t.height-18,width:10,height:10,image:(()=>{const h=document.createElement("canvas");h.width=10,h.height=10;const b=h.getContext("2d");b&&(b.fillStyle="#fff",b.font="10px Arial",b.fillText("üì∑",0,9));const g=new window.Image;return g.src=h.toDataURL(),g})(),listening:!1})]})},Yt=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{if(t.properties.galleryMode)return e.jsx(Kt,{widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a});const[s,l]=y.useState(null),i=y.useRef(null),{clipShape:c="rectangle"}=t.properties;y.useEffect(()=>{if(!t.properties.src){l(null);return}const S=new window.Image;return S.crossOrigin="anonymous",S.onload=()=>{l(S)},S.onerror=()=>{console.error("Failed to load image:",t.properties.src),l(null)},S.src=t.properties.src,()=>{S.onload=null,S.onerror=null}},[t.properties.src]),y.useEffect(()=>{if(!s||t.properties.objectFit!=="adaptive")return;const{updateWidget:S}=B.getState(),T=s.width/s.height,P=t.width/t.height;if(Math.abs(T-P)>.01){const I=t.width/T;S(t.id,{height:Math.round(I)})}},[s,t.properties.objectFit,t.width,t.height,t.id]);const u=(()=>{if(!s)return null;const{width:S,height:T}=t,{objectFit:P="contain"}=t.properties,I=s.width/s.height,h=S/T;let b=0,g=0,w=s.width,F=s.height;switch(P){case"cover":{I>h?(w=s.height*h,b=(s.width-w)/2):(F=s.width/h,g=(s.height-F)/2);break}case"contain":break;case"fill":break;case"scale-down":{s.width<=S&&s.height<=T&&(w=s.width,F=s.height);break}}return{cropX:b,cropY:g,cropWidth:w,cropHeight:F}})(),{borderEnabled:f,borderStyle:x,borderWidth:v=2,borderColor:m="#000000"}=t.properties,k=S=>{switch(S){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},j=S=>{i.current&&d(S)},N=t.locked||!1;return e.jsxs(K,{ref:i,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!N,dragBoundFunc:a,opacity:N?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:j,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),!s&&e.jsx(E,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),s&&(c&&c!=="rectangle"?e.jsx(Oe,{widget:t,image:s}):u&&e.jsx(se,{image:s,x:0,y:0,width:t.width,height:t.height,crop:{x:u.cropX,y:u.cropY,width:u.cropWidth,height:u.cropHeight},listening:!1})),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),f&&e.jsx(E,{width:t.width,height:t.height,stroke:m,strokeWidth:v,dash:k(x),listening:!1})]})},Zt=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),l=y.useRef(null),{text:i="Button",backgroundColor:c="#2ecc71",textColor:p="#ffffff",fontSize:u=16,fontFamily:f="Arial",fontWeight:x="normal",fontStyle:v="normal",textAlign:m="center",borderRadius:k=8,borderWidth:j=0,borderColor:N="#000000",borderStyle:S="solid",paddingX:T=16,paddingY:P=8,shadowEnabled:I=!1,shadowColor:h="#000000",shadowBlur:b=10,shadowOffsetX:g=0,shadowOffsetY:w=4,shadowOpacity:F=.3}=t.properties,V=t.locked||!1,L=()=>{switch(S){case"dashed":return[10,5];case"dotted":return[3,3];default:return[]}};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!V,dragBoundFunc:a,opacity:V?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[I&&e.jsx(E,{x:g,y:w,width:t.width,height:t.height,cornerRadius:k,fill:h,opacity:F,blur:b,listening:!1}),e.jsx(E,{width:t.width,height:t.height,fill:c,cornerRadius:k,stroke:j>0?N:void 0,strokeWidth:j,dash:L(),listening:!1}),e.jsx(D,{ref:l,text:i,x:T,y:0,width:t.width-T*2,height:t.height,fontSize:u,fontFamily:f,fontStyle:x==="bold"?"bold":v,fill:p,align:m,verticalAlign:"middle",listening:!1}),e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,cornerRadius:k,listening:!1})]})},Jt=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),{text:l="Text",fontSize:i=16,fontFamily:c="Arial",fontWeight:p="normal",fontStyle:u="normal",textAlign:f="left",verticalAlign:x="top",textColor:v="#000000",backgroundColor:m="#ffffff",lineHeight:k=1.2,padding:j=8,textDecoration:N="none"}=t.properties,S=t.locked||!1,T=()=>N==="underline"?"underline":N==="line-through"?"line-through":"";return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!S,dragBoundFunc:a,opacity:S?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[m!=="transparent"&&e.jsx(E,{width:t.width,height:t.height,fill:m,listening:!1}),e.jsx(D,{text:l,x:j,y:j,width:t.width-j*2,height:t.height-j*2,fontSize:i,fontFamily:c,fontStyle:p==="bold"?"bold":u,fill:v,align:f,verticalAlign:x,lineHeight:k,textDecoration:T(),listening:!1}),e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},Qt=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),[l,i]=y.useState(0),{sources:c=[],autoNext:p=!0,loop:u=!0}=t.properties,f=t.locked||!1;return c[l],e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!f,dragBoundFunc:a,opacity:f?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(E,{width:t.width,height:t.height,fill:"#000000",listening:!1}),e.jsx(D,{x:t.width/2,y:t.height/2-30,text:"‚ñ∂",fontSize:60,fill:"#ffffff",align:"center",width:t.width,offsetX:t.width/2,listening:!1}),e.jsx(D,{x:0,y:t.height/2+40,text:"PLAYLIST",fontSize:16,fill:"#ffffff",align:"center",width:t.width,listening:!1}),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(E,{x:t.width-50,y:t.height-25,width:45,height:20,fill:"rgba(0, 0, 0, 0.8)",cornerRadius:4,listening:!1}),e.jsx(D,{x:t.width-48,y:t.height-21,text:`üé¨ ${c.length}`,fontSize:12,fill:"#ffffff",listening:!1})]})]})},er=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{if(t.properties.playlistMode)return e.jsx(Qt,{widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a});const s=y.useRef(null),l=y.useRef(null),[i,c]=y.useState(null),p=y.useRef(),{sourceType:u="url",src:f="",rtspUrl:x="",isLocalFile:v=!1,fileName:m="",objectFit:k="contain",borderEnabled:j=!1,borderStyle:N="solid",borderWidth:S=2,borderColor:T="#000000",autoplay:P=!1,loop:I=!1,muted:h=!0,controls:b=!1}=t.properties;y.useEffect(()=>{const C=document.createElement("video");return C.crossOrigin="anonymous",C.loop=I,C.muted=h,C.playsInline=!0,u==="url"&&f?(C.src=f,C.onloadedmetadata=()=>{c(C),P&&C.play().catch(z=>{console.log("Autoplay prevented:",z)})},C.onerror=()=>{console.error("Failed to load video:",f),c(null)}):c(null),l.current=C,()=>{p.current&&cancelAnimationFrame(p.current),C.pause(),C.src="",C.load()}},[f,u,P,I,h]),y.useEffect(()=>{if(!i)return;const C=()=>{const z=s.current?.getLayer();z&&z.batchDraw(),p.current=requestAnimationFrame(C)};return p.current=requestAnimationFrame(C),()=>{p.current&&cancelAnimationFrame(p.current)}},[i]),y.useEffect(()=>{if(k!=="adaptive"||!i)return;const{updateWidget:C}=B.getState(),z=i.videoWidth/i.videoHeight||16/9,O=t.width/t.height;if(Math.abs(z-O)>.01){const $=t.width/z;C(t.id,{height:Math.round($)})}},[k,i,t.width,t.height,t.id]);const w=(()=>{if(!i||i.videoWidth===0)return null;const{width:C,height:z}=t,O=i.videoWidth/i.videoHeight,$=C/z;let H=0,_=0,Q=i.videoWidth,X=i.videoHeight,Y=0,ne=0,Z=C,J=z;switch(k){case"cover":{O>$?(Q=i.videoHeight*$,H=(i.videoWidth-Q)/2):(X=i.videoWidth/$,_=(i.videoHeight-X)/2);break}case"contain":{O>$?(J=C/O,ne=(z-J)/2):(Z=z*O,Y=(C-Z)/2);break}case"scale-down":{i.videoWidth<=C&&i.videoHeight<=z?(Z=i.videoWidth,J=i.videoHeight,Y=(C-Z)/2,ne=(z-J)/2):O>$?(J=C/O,ne=(z-J)/2):(Z=z*O,Y=(C-Z)/2);break}}return{crop:{x:H,y:_,width:Q,height:X},position:{x:Y,y:ne,width:Z,height:J}}})(),F=C=>{switch(C){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},V=C=>{s.current&&d(C)},L=C=>{n(C),b&&i&&(i.paused?i.play():i.pause())},A=t.locked||!1,R=()=>u==="rtsp"&&x?`üìπ RTSP
${x.substring(0,30)}...`:u==="url"&&f?v&&m?`üìÅ ${m}`:`üé• –í–∏–¥–µ–æ
${f.substring(0,30)}...`:`üé• –í–∏–¥–µ–æ
–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏`;return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!A,dragBoundFunc:a,opacity:A?.6:1,onClick:L,onTap:L,onDragEnd:r,onTransformEnd:V,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(E,{width:t.width,height:t.height,fill:u==="rtsp"?"#2c3e50":"#f39c12",listening:!1}),i&&w?e.jsx(se,{image:i,x:w.position.x,y:w.position.y,width:w.position.width,height:w.position.height,crop:w.crop,listening:!1}):e.jsx(D,{text:R(),x:0,y:0,width:t.width,height:t.height,fontSize:14,fontFamily:"Arial",fill:"#ffffff",align:"center",verticalAlign:"middle",listening:!1}),u==="rtsp"&&e.jsx(E,{x:10,y:10,width:45,height:20,fill:"#ff0000",cornerRadius:4,listening:!1}),u==="rtsp"&&e.jsx(D,{text:"LIVE",x:10,y:13,width:45,fontSize:12,fontFamily:"Arial",fontWeight:"bold",fill:"#ffffff",align:"center",listening:!1}),i&&!i.paused&&e.jsx(D,{text:"‚ñ∂",x:t.width-30,y:10,fontSize:16,fontFamily:"Arial",fill:"#00ff00",listening:!1}),b&&i&&e.jsx(D,{text:i.paused?"‚è∏ –ü–∞—É–∑–∞":"‚ñ∂ –ò–≥—Ä–∞–µ—Ç",x:10,y:t.height-30,fontSize:12,fontFamily:"Arial",fill:"#ffffff",listening:!1}),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),j&&e.jsx(E,{width:t.width,height:t.height,stroke:T,strokeWidth:S,dash:F(N),listening:!1})]})},tr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),{shapeType:l="rectangle",fillColor:i="#4a90e2",strokeColor:c="#2c3e50",strokeWidth:p=0,cornerRadius:u=0,opacity:f=1}=t.properties,x=t.locked||!1,v=()=>{const m={fill:i,stroke:p>0?c:void 0,strokeWidth:p,opacity:f,listening:!1};switch(l){case"rectangle":return e.jsx(E,{x:0,y:0,width:t.width,height:t.height,cornerRadius:u,...m});case"circle":const k=Math.min(t.width,t.height)/2;return e.jsx(Ge,{x:t.width/2,y:t.height/2,radius:k,...m});case"ellipse":return e.jsx(qe,{x:t.width/2,y:t.height/2,radiusX:t.width/2,radiusY:t.height/2,...m});case"triangle":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:3,radius:Math.min(t.width,t.height)/2,...m});case"pentagon":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:5,radius:Math.min(t.width,t.height)/2,...m});case"hexagon":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:6,radius:Math.min(t.width,t.height)/2,...m});case"star":return e.jsx(Ue,{x:t.width/2,y:t.height/2,numPoints:5,innerRadius:Math.min(t.width,t.height)/4,outerRadius:Math.min(t.width,t.height)/2,...m});case"diamond":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:4,radius:Math.min(t.width,t.height)/2,rotation:45,...m});case"line":return e.jsx(re,{points:[0,t.height/2,t.width,t.height/2],stroke:c,strokeWidth:Math.max(p,2),opacity:f,listening:!1});case"arrow":const j=t.width,N=t.height,S=N*.6,T=N*.4;return e.jsx(re,{points:[0,N/2-T/2,j-S,N/2-T/2,j-S,0,j,N/2,j-S,N,j-S,N/2+T/2,0,N/2+T/2],closed:!0,fill:i,stroke:p>0?c:void 0,strokeWidth:p,opacity:f,listening:!1});default:return e.jsx(E,{x:0,y:0,width:t.width,height:t.height,...m})}};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!x,dragBoundFunc:a,opacity:x?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),v(),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},rr=({widget:t,isSelected:o,onSelect:n,onDragEnd:r,onTransformEnd:d,dragBoundFunc:a})=>{const s=y.useRef(null),[l,i]=y.useState(null),[c,p]=y.useState(null),{orientation:u="horizontal",items:f=[{id:"1",label:"–ì–ª–∞–≤–Ω–∞—è"},{id:"2",label:"–û –Ω–∞—Å"},{id:"3",label:"–£—Å–ª—É–≥–∏",children:[{id:"3-1",label:"–£—Å–ª—É–≥–∞ 1"},{id:"3-2",label:"–£—Å–ª—É–≥–∞ 2"}]},{id:"4",label:"–ö–æ–Ω—Ç–∞–∫—Ç—ã"}],backgroundColor:x="#2c3e50",textColor:v="#ffffff",hoverColor:m="#34495e",fontSize:k=16,fontFamily:j="Arial",itemPadding:N=16,submenuBackgroundColor:S="#34495e",submenuTextColor:T="#ffffff",borderWidth:P=0,borderColor:I="#000000",itemHeight:h=40}=t.properties,b=t.locked||!1,g=u==="horizontal",w=L=>L.length*(k*.6)+N*2,F=()=>{const L=[];let A=0;return f.forEach((R,C)=>{const z=w(R.label),O=l===R.id,$=c===R.id,H=R.children&&R.children.length>0;L.push(e.jsx(E,{x:A,y:0,width:z,height:h,fill:O?m:x,listening:!0,onMouseEnter:()=>i(R.id),onMouseLeave:()=>i(null),onClick:()=>{H&&p(c===R.id?null:R.id)}},`bg-${R.id}`)),L.push(e.jsx(D,{x:A,y:0,width:z,height:h,text:R.label,fontSize:k,fontFamily:j,fill:v,align:"center",verticalAlign:"middle",listening:!1},`text-${R.id}`)),H&&L.push(e.jsx(D,{x:A+z-20,y:0,width:20,height:h,text:"‚ñº",fontSize:10,fill:v,align:"center",verticalAlign:"middle",listening:!1},`arrow-${R.id}`)),C<f.length-1&&L.push(e.jsx(re,{points:[A+z,5,A+z,h-5],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-${R.id}`)),$&&H&&R.children.forEach((_,Q)=>{const X=h+Q*h,Y=Math.max(z,w(_.label));L.push(e.jsx(E,{x:A,y:X,width:Y,height:h,fill:S,listening:!0,onMouseEnter:()=>i(_.id),onMouseLeave:()=>i(null)},`submenu-bg-${_.id}`)),L.push(e.jsx(D,{x:A+N/2,y:X,width:Y-N/2,height:h,text:_.label,fontSize:k-2,fontFamily:j,fill:T,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`))}),A+=z}),L},V=()=>{const L=[];let A=0;const R=t.width;return f.forEach((C,z)=>{const O=l===C.id,$=c===C.id,H=C.children&&C.children.length>0;L.push(e.jsx(E,{x:0,y:A,width:R,height:h,fill:O?m:x,listening:!0,onMouseEnter:()=>i(C.id),onMouseLeave:()=>i(null),onClick:()=>{H&&p(c===C.id?null:C.id)}},`bg-${C.id}`)),L.push(e.jsx(D,{x:N,y:A,width:R-N*2-(H?20:0),height:h,text:C.label,fontSize:k,fontFamily:j,fill:v,align:"left",verticalAlign:"middle",listening:!1},`text-${C.id}`)),H&&L.push(e.jsx(D,{x:R-20,y:A,width:20,height:h,text:$?"‚ñº":"‚ñ∂",fontSize:10,fill:v,align:"center",verticalAlign:"middle",listening:!1},`arrow-${C.id}`)),A+=h,z<f.length-1&&!$&&L.push(e.jsx(re,{points:[10,A,R-10,A],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-${C.id}`)),$&&H&&(C.children.forEach((_,Q)=>{const X=l===_.id;L.push(e.jsx(E,{x:0,y:A,width:R,height:h,fill:X?m:S,listening:!0,onMouseEnter:()=>i(_.id),onMouseLeave:()=>i(null)},`submenu-bg-${_.id}`)),L.push(e.jsx(D,{x:N*2,y:A,width:R-N*3,height:h,text:_.label,fontSize:k-2,fontFamily:j,fill:T,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`)),A+=h}),z<f.length-1&&L.push(e.jsx(re,{points:[10,A,R-10,A],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-after-${C.id}`)))}),L};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!b,dragBoundFunc:a,opacity:b?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:d,children:[e.jsx(E,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(E,{width:t.width,height:t.height,fill:x,listening:!1}),P>0&&e.jsx(E,{width:t.width,height:t.height,stroke:I,strokeWidth:P,listening:!1}),g?F():V(),o&&e.jsx(E,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},sr={shape:"#4a90e2",rectangle:"#4a90e2",button:"#2ecc71",text:"#e74c3c",image:"#9b59b6",video:"#f39c12"},nr=()=>{const{project:t,selectedWidgetIds:o,selectWidget:n,clearSelection:r,updateWidget:d,zoom:a,gridEnabled:s,snapToGrid:l,gridSize:i,gridLineWidth:c,gridColor:p,pendingWidget:u,addWidgetAtPosition:f,clearPendingWidget:x}=B(),v=y.useRef(null),m=y.useRef(null),k=h=>l?Math.round(h/i)*i:h,j=h=>({x:k(h.x),y:k(h.y)});if(y.useEffect(()=>{if(!m.current||!t)return;const h=v.current,b=o.map(g=>t.widgets.find(F=>F.id===g)?.locked?null:h.findOne(`#${g}`)).filter(Boolean);m.current.nodes(b),m.current.getLayer().batchDraw()},[o,t]),!t)return null;const N=h=>{if(u){const w=h.target.getStage().getPointerPosition();w&&f(w.x,w.y);return}(h.target===h.target.getStage()||h.target.attrs.id==="canvas-background")&&r()},S=(h,b)=>{b.cancelBubble=!0;const g=b.evt.ctrlKey||b.evt.metaKey;n(h,g)},T=(h,b)=>{const g=k(b.target.x()),w=k(b.target.y());d(h,{x:g,y:w})},P=(h,b)=>{const g=b.target,w=g.scaleX(),F=g.scaleY();g.scaleX(1),g.scaleY(1);const V=g.width?g.width():g.attrs.width||100,L=g.height?g.height():g.attrs.height||100;let A=Math.max(10,V*w),R=Math.max(10,L*F),C=g.x(),z=g.y();l&&(A=k(A),R=k(R),C=k(C),z=k(z)),d(h,{x:C,y:z,width:A,height:R,rotation:g.rotation()})},I=()=>{if(!s)return null;const h=[],{width:b,height:g}=t.canvas;for(let w=0;w<=b/i;w++)h.push(e.jsx(E,{x:w*i,y:0,width:c,height:g,fill:p},`v-${w}`));for(let w=0;w<=g/i;w++)h.push(e.jsx(E,{x:0,y:w*i,width:b,height:c,fill:p},`h-${w}`));return h};return e.jsxs("div",{className:"canvas-container",children:[e.jsx("div",{className:"canvas-scroll",children:e.jsx("div",{className:"canvas-wrapper",style:{transform:`scale(${a})`,transformOrigin:"top left",cursor:u?"crosshair":"default"},children:e.jsx(Ve,{ref:v,width:t.canvas.width,height:t.canvas.height,onClick:N,onTap:N,children:e.jsxs(Xe,{children:[e.jsx(E,{id:"canvas-background",x:0,y:0,width:t.canvas.width,height:t.canvas.height,fill:t.canvas.backgroundColor||"#ffffff"}),I(),t.widgets.slice().sort((h,b)=>(h.zIndex||0)-(b.zIndex||0)).map(h=>{const b=h.locked||!1;return h.type==="image"?e.jsxs(G.Fragment,{children:[e.jsx(Yt,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):h.type==="button"?e.jsxs(G.Fragment,{children:[e.jsx(Zt,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):h.type==="text"?e.jsxs(G.Fragment,{children:[e.jsx(Jt,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):h.type==="video"?e.jsxs(G.Fragment,{children:[e.jsx(er,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):h.type==="shape"||h.type==="rectangle"?e.jsxs(G.Fragment,{children:[e.jsx(tr,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):h.type==="menu"?e.jsxs(G.Fragment,{children:[e.jsx(rr,{widget:h,isSelected:o.includes(h.id),onSelect:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g),dragBoundFunc:l?j:void 0}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id):e.jsxs(G.Fragment,{children:[e.jsx(E,{id:h.id,x:h.x,y:h.y,width:h.width,height:h.height,rotation:h.rotation||0,fill:sr[h.type]||"#4a90e2",stroke:o.includes(h.id)?"#007acc":void 0,strokeWidth:o.includes(h.id)?2:0,opacity:b?.6:1,draggable:!b,onClick:g=>S(h.id,g),onTap:g=>S(h.id,g),onDragEnd:g=>T(h.id,g),onTransformEnd:g=>P(h.id,g)}),b&&e.jsx(D,{x:h.x+5,y:h.y+5,text:"üîí",fontSize:16,listening:!1})]},h.id)}),e.jsx(Ke,{ref:m,boundBoxFunc:(h,b)=>b.width<10||b.height<10?h:b})]})})})}),e.jsxs("div",{className:"canvas-info",children:[e.jsxs("span",{children:[t.canvas.width," √ó ",t.canvas.height," px"]}),o.length>0&&e.jsxs("span",{children:["–í—ã–±—Ä–∞–Ω–æ: ",o.length]})]})]})},ir=()=>{const{project:t,selectedWidgetIds:o,selectWidget:n,updateWidget:r,deleteWidget:d}=B();if(!t)return null;const a=i=>({shape:"üî∑",rectangle:"üî∑",text:"üìù",button:"üîò",image:"üñºÔ∏è",video:"üé¨",menu:"üçî"})[i]||"‚¨ú",s=i=>{if(i.properties.text){const c=i.properties.text.substring(0,20);return c.length<i.properties.text.length?`${c}...`:c}return i.properties.items?`–ú–µ–Ω—é (${i.properties.items.length} –ø—É–Ω–∫—Ç–æ–≤)`:i.type.charAt(0).toUpperCase()+i.type.slice(1)},l=[...t.widgets].sort((i,c)=>(c.zIndex||0)-(i.zIndex||0));return e.jsxs("div",{className:"outline-panel",children:[e.jsxs("div",{className:"outline-header",children:[e.jsx("h3",{children:"–°—Ç—Ä—É–∫—Ç—É—Ä–∞"}),e.jsxs("span",{className:"outline-count",children:[t.widgets.length," –≤–∏–¥–∂–µ—Ç–æ–≤"]})]}),e.jsx("div",{className:"outline-list",children:l.length===0?e.jsxs("div",{className:"outline-empty",children:[e.jsx("p",{children:"–ù–µ—Ç –≤–∏–¥–∂–µ—Ç–æ–≤"}),e.jsx("span",{children:"–î–æ–±–∞–≤—å—Ç–µ –≤–∏–¥–∂–µ—Ç—ã –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"})]}):l.map(i=>{const c=o.includes(i.id),p=i.locked||!1;return e.jsxs("div",{className:`outline-item ${c?"selected":""} ${p?"locked":""}`,onClick:()=>n(i.id,!1),children:[e.jsxs("div",{className:"outline-item-main",children:[e.jsx("span",{className:"outline-icon",children:a(i.type)}),e.jsxs("div",{className:"outline-info",children:[e.jsx("span",{className:"outline-label",children:s(i)}),e.jsxs("span",{className:"outline-meta",children:[i.width,"√ó",i.height," ‚Ä¢ z:",i.zIndex||0]})]})]}),e.jsxs("div",{className:"outline-actions",onClick:u=>u.stopPropagation(),children:[e.jsx("button",{className:"outline-action-btn",onClick:()=>{r(i.id,{locked:!p})},title:p?"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å":"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",children:p?e.jsx(lt,{size:14}):e.jsx(bt,{size:14})}),e.jsx("button",{className:"outline-action-btn delete",onClick:()=>{window.confirm(`–£–¥–∞–ª–∏—Ç—å –≤–∏–¥–∂–µ—Ç "${s(i)}"?`)&&d(i.id)},title:"–£–¥–∞–ª–∏—Ç—å",children:e.jsx(Me,{size:14})})]})]},i.id)})})]})},or=()=>{const{addWidget:t,project:o}=B(),n=[{type:"shape",name:"–§–∏–≥—É—Ä–∞",icon:jt,defaultProps:{shapeType:"rectangle",fillColor:"#4a90e2",strokeColor:"#2c3e50",strokeWidth:0,cornerRadius:0,opacity:1}},{type:"button",name:"–ö–Ω–æ–ø–∫–∞",icon:pt,defaultProps:{text:"–ù–∞–∂–º–∏ –º–µ–Ω—è",backgroundColor:"#4a90e2",textColor:"#ffffff"}},{type:"text",name:"–¢–µ–∫—Å—Ç",icon:vt,defaultProps:{text:"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç",fontSize:24,color:"#000000"}},{type:"image",name:"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",icon:at,defaultProps:{src:""}},{type:"video",name:"–í–∏–¥–µ–æ",icon:St,defaultProps:{src:"",autoplay:!1,loop:!1}},{type:"menu",name:"–ú–µ–Ω—é",icon:ht,defaultProps:{orientation:"horizontal",items:[{id:"1",label:"–ì–ª–∞–≤–Ω–∞—è"},{id:"2",label:"–û –Ω–∞—Å"},{id:"3",label:"–£—Å–ª—É–≥–∏",children:[{id:"3-1",label:"–£—Å–ª—É–≥–∞ 1"},{id:"3-2",label:"–£—Å–ª—É–≥–∞ 2"}]},{id:"4",label:"–ö–æ–Ω—Ç–∞–∫—Ç—ã"}],backgroundColor:"#2c3e50",textColor:"#ffffff",hoverColor:"#34495e",fontSize:16,fontFamily:"Arial",itemPadding:16,submenuBackgroundColor:"#34495e",submenuTextColor:"#ffffff",borderWidth:0,borderColor:"#000000",itemHeight:40}}],r=(d,a)=>{if(!o)return;const{setPendingWidget:s}=B.getState();s(d,a)};return e.jsxs("div",{className:"widget-library panel",children:[e.jsx("div",{className:"widget-library-header",children:e.jsx("h3",{children:"–í–∏–¥–∂–µ—Ç—ã"})}),e.jsx("div",{className:"widget-library-content",children:n.map(d=>{const a=d.icon;return e.jsxs("button",{className:"widget-item",onClick:()=>r(d.type,d.defaultProps),title:`–î–æ–±–∞–≤–∏—Ç—å ${d.name}`,children:[e.jsx(a,{size:24}),e.jsx("span",{children:d.name})]},d.type)})}),e.jsx("div",{className:"widget-library-footer",children:e.jsx("button",{className:"btn-secondary",style:{width:"100%",fontSize:"12px"},children:"+ –ò–º–ø–æ—Ä—Ç –≤–∏–¥–∂–µ—Ç–∞"})}),e.jsx(ir,{})]})},ar="modulepreload",lr=function(t){return"/"+t},Ie={},ze=function(o,n,r){let d=Promise.resolve();if(n&&n.length>0){let i=function(c){return Promise.all(c.map(p=>Promise.resolve(p).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");d=i(n.map(c=>{if(c=lr(c),c in Ie)return;Ie[c]=!0;const p=c.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":ar,p||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),p)return new Promise((x,v)=>{f.addEventListener("load",x),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return d.then(s=>{for(const l of s||[])l.status==="rejected"&&a(l.reason);return o().catch(a)})},Pe=({widget:t,onUpdate:o,allWidgets:n})=>{const r=t.properties.actions||[],d=()=>{const l={type:"url",url:""};o([...r,l])},a=(l,i)=>{const c=[...r];c[l]={...c[l],...i},o(c)},s=l=>{const i=r.filter((c,p)=>p!==l);o(i)};return e.jsxs("div",{className:"action-editor",children:[e.jsx("h4",{style:{marginBottom:"12px",fontSize:"12px",color:"#aaa"},children:"–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ"}),r.length===0&&e.jsx("div",{style:{padding:"16px",background:"#252525",borderRadius:"6px",textAlign:"center",color:"#888",fontSize:"13px",marginBottom:"12px"},children:"–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π. –î–æ–±–∞–≤—å—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ."}),r.map((l,i)=>e.jsxs("div",{className:"action-item",children:[e.jsxs("div",{className:"action-header",children:[e.jsxs("span",{className:"action-number",children:["#",i+1]}),e.jsx("button",{className:"btn-danger-small",onClick:()=>s(i),title:"–£–¥–∞–ª–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ",children:"üóëÔ∏è"})]}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è"}),e.jsxs("select",{value:l.type,onChange:c=>a(i,{type:c.target.value}),children:[e.jsx("option",{value:"url",children:"üîó –û—Ç–∫—Ä—ã—Ç—å URL"}),e.jsx("option",{value:"page",children:"üìÑ –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É"}),e.jsx("option",{value:"popup",children:"üí¨ –ü–æ–∫–∞–∑–∞—Ç—å popup"}),e.jsx("option",{value:"widget_show",children:"üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–∂–µ—Ç"}),e.jsx("option",{value:"widget_hide",children:"üôà –°–∫—Ä—ã—Ç—å –≤–∏–¥–∂–µ—Ç"}),e.jsx("option",{value:"video_play",children:"‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ"}),e.jsx("option",{value:"video_stop",children:"‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ"})]})]}),l.type==="url"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL –∞–¥—Ä–µ—Å"}),e.jsx("input",{type:"text",value:l.url||"",onChange:c=>a(i,{url:c.target.value}),placeholder:"https://example.com"})]}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l.openInNewTab||!1,onChange:c=>a(i,{openInNewTab:c.target.checked})}),"–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ"]})})]}),l.type==="page"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã"}),e.jsx("input",{type:"text",value:l.pageId||"",onChange:c=>a(i,{pageId:c.target.value}),placeholder:"page-1"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"–£–∫–∞–∂–∏—Ç–µ ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞"})]}),l.type==="popup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ó–∞–≥–æ–ª–æ–≤–æ–∫ popup"}),e.jsx("input",{type:"text",value:l.popupTitle||"",onChange:c=>a(i,{popupTitle:c.target.value}),placeholder:"–ó–∞–≥–æ–ª–æ–≤–æ–∫"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–æ–¥–µ—Ä–∂–∏–º–æ–µ popup"}),e.jsx("textarea",{value:l.popupContent||"",onChange:c=>a(i,{popupContent:c.target.value}),rows:4,placeholder:"–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"–®–∏—Ä–∏–Ω–∞ (px)"}),e.jsx("input",{type:"number",value:l.popupWidth||400,onChange:c=>a(i,{popupWidth:parseInt(c.target.value)}),min:200,max:1e3})]}),e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"–í—ã—Å–æ—Ç–∞ (px)"}),e.jsx("input",{type:"number",value:l.popupHeight||300,onChange:c=>a(i,{popupHeight:parseInt(c.target.value)}),min:150,max:800})]})]})]}),(l.type==="widget_show"||l.type==="widget_hide")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–µ–ª–µ–≤–æ–π –≤–∏–¥–∂–µ—Ç"}),e.jsxs("select",{value:l.targetWidgetId||"",onChange:c=>a(i,{targetWidgetId:c.target.value}),children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–∂–µ—Ç..."}),n.filter(c=>c.id!==t.id).map(c=>e.jsxs("option",{value:c.id,children:[c.type," - ",c.id]},c.id))]})]}),(l.type==="video_play"||l.type==="video_stop")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–í–∏–¥–µ–æ –≤–∏–¥–∂–µ—Ç"}),e.jsxs("select",{value:l.targetWidgetId||"",onChange:c=>a(i,{targetWidgetId:c.target.value}),children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ..."}),n.filter(c=>c.type==="video").map(c=>e.jsxs("option",{value:c.id,children:["Video - ",c.id]},c.id))]})]})]})]},i)),e.jsx("button",{className:"btn-secondary",onClick:d,style:{width:"100%",marginTop:"8px"},children:"‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ"})]})},cr=()=>{const{project:t,selectedWidgetIds:o,updateWidget:n}=B();if(!t)return null;const r=o.length===1?t.widgets.find(s=>s.id===o[0]):null,d=(s,l)=>{r&&n(r.id,{[s]:l})},a=(s,l)=>{r&&n(r.id,{properties:{...r.properties,[s]:l}})};return r?e.jsxs("div",{className:"properties-panel panel",children:[e.jsxs("div",{className:"properties-header",children:[e.jsx("h3",{children:"–°–≤–æ–π—Å—Ç–≤–∞"}),e.jsx("span",{className:"widget-type-badge",children:r.type})]}),e.jsxs("div",{className:"properties-content",children:[e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"–ü–æ–∑–∏—Ü–∏—è –∏ —Ä–∞–∑–º–µ—Ä"}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"X"}),e.jsx("input",{type:"number",value:Math.round(r.x),onChange:s=>d("x",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Y"}),e.jsx("input",{type:"number",value:Math.round(r.y),onChange:s=>d("y",parseFloat(s.target.value))})]})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–®–∏—Ä–∏–Ω–∞"}),e.jsx("input",{type:"number",value:Math.round(r.width),onChange:s=>d("width",parseFloat(s.target.value)),min:1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–í—ã—Å–æ—Ç–∞"}),e.jsx("input",{type:"number",value:Math.round(r.height),onChange:s=>d("height",parseFloat(s.target.value)),min:1})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ü–æ–≤–æ—Ä–æ—Ç (–≥—Ä–∞–¥—É—Å—ã)"}),e.jsx("input",{type:"number",value:Math.round(r.rotation||0),onChange:s=>d("rotation",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Z-Index (–ø–æ—Ä—è–¥–æ–∫)"}),e.jsx("input",{type:"number",min:"0",value:r.zIndex||0,onChange:s=>d("zIndex",Math.max(0,parseInt(s.target.value)||0))}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"4px"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"–ù–∞ –ø–µ—Ä–µ–¥–Ω–∏–π –ø–ª–∞–Ω",children:"‚¨ÜÔ∏è –ù–∞–≤–µ—Ä—Ö"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"–ù–∞ –∑–∞–¥–Ω–∏–π –ø–ª–∞–Ω",children:"‚¨áÔ∏è –í–Ω–∏–∑"})]})]}),e.jsxs("div",{className:"property-field",style:{marginTop:"12px"},children:[e.jsx("button",{className:r.locked?"btn-danger":"btn-secondary",onClick:()=>{},style:{width:"100%"},children:r.locked?"üîí –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å":"üîì –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"}),r.locked&&e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å —Ä–∞–∑–º–µ—Ä"})]})]}),e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–∂–µ—Ç–∞"}),r.type==="shape"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø —Ñ–∏–≥—É—Ä—ã"}),e.jsxs("select",{value:r.properties.shapeType||"rectangle",onChange:s=>a("shapeType",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"circle",children:"–ö—Ä—É–≥"}),e.jsx("option",{value:"ellipse",children:"–≠–ª–ª–∏–ø—Å"}),e.jsx("option",{value:"triangle",children:"–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"pentagon",children:"–ü—è—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"hexagon",children:"–®–µ—Å—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"star",children:"–ó–≤–µ–∑–¥–∞"}),e.jsx("option",{value:"diamond",children:"–†–æ–º–±"}),e.jsx("option",{value:"line",children:"–õ–∏–Ω–∏—è"}),e.jsx("option",{value:"arrow",children:"–°—Ç—Ä–µ–ª–∫–∞"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ó–∞–ª–∏–≤–∫–∞"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç –∑–∞–ª–∏–≤–∫–∏"}),e.jsx("input",{type:"color",value:r.properties.fillColor||"#4a90e2",onChange:s=>a("fillColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å"}),e.jsx("input",{type:"range",value:(r.properties.opacity||1)*100,onChange:s=>a("opacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.opacity||1)*100),"%"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ö–æ–Ω—Ç—É—Ä"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–æ–ª—â–∏–Ω–∞ –∫–æ–Ω—Ç—É—Ä–∞"}),e.jsx("input",{type:"number",value:r.properties.strokeWidth||0,onChange:s=>a("strokeWidth",parseInt(s.target.value)),min:0,max:20})]}),r.properties.strokeWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç –∫–æ–Ω—Ç—É—Ä–∞"}),e.jsx("input",{type:"color",value:r.properties.strokeColor||"#2c3e50",onChange:s=>a("strokeColor",s.target.value)})]}),r.properties.shapeType==="rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤"}),e.jsx("input",{type:"number",value:r.properties.cornerRadius||0,onChange:s=>a("cornerRadius",parseInt(s.target.value)),min:0,max:100})]})]}),r.type==="button"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏"}),e.jsxs("select",{onChange:s=>{const l=s.target.value;l!=="custom"&&ze(async()=>{const{buttonStyles:i}=await import("./buttonStyles-VsZJSFTR.js");return{buttonStyles:i}},[]).then(({buttonStyles:i})=>{const c=i.find(p=>p.name===l);c&&n(r.id,{properties:{...r.properties,...c.properties}})})},children:[e.jsx("option",{value:"custom",children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π"}),e.jsx("option",{value:"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é",children:"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é"}),e.jsx("option",{value:"–û—Å–Ω–æ–≤–Ω–∞—è",children:"–û—Å–Ω–æ–≤–Ω–∞—è (—Å–∏–Ω—è—è —Å —Ç–µ–Ω—å—é)"}),e.jsx("option",{value:"–£—Å–ø–µ—Ö",children:"–£—Å–ø–µ—Ö (–∑–µ–ª—ë–Ω–∞—è)"}),e.jsx("option",{value:"–û–ø–∞—Å–Ω–æ—Å—Ç—å",children:"–û–ø–∞—Å–Ω–æ—Å—Ç—å (–∫—Ä–∞—Å–Ω–∞—è)"}),e.jsx("option",{value:"–ö–æ–Ω—Ç—É—Ä–Ω–∞—è",children:"–ö–æ–Ω—Ç—É—Ä–Ω–∞—è"}),e.jsx("option",{value:"–ü—Ä–∏–∑—Ä–∞–∫",children:"–ü—Ä–∏–∑—Ä–∞–∫"}),e.jsx("option",{value:"–ì—Ä–∞–¥–∏–µ–Ω—Ç",children:"–ì—Ä–∞–¥–∏–µ–Ω—Ç"}),e.jsx("option",{value:"–ú–∏–Ω–∏–º–∞–ª–∏–∑–º",children:"–ú–∏–Ω–∏–º–∞–ª–∏–∑–º"}),e.jsx("option",{value:"–ù–µ–æ–Ω",children:"–ù–µ–æ–Ω"}),e.jsx("option",{value:"–ö–ª–∞—Å—Å–∏–∫–∞",children:"–ö–ª–∞—Å—Å–∏–∫–∞"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–¢–µ–∫—Å—Ç"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏"}),e.jsx("input",{type:"text",value:r.properties.text||"Button",onChange:s=>a("text",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:72})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–®—Ä–∏—Ñ—Ç"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ù–∞—á–µ—Ä—Ç–∞–Ω–∏–µ"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"–û–±—ã—á–Ω—ã–π"}),e.jsx("option",{value:"bold",children:"–ñ–∏—Ä–Ω—ã–π"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ"}),e.jsxs("select",{value:r.properties.textAlign||"center",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é"}),e.jsx("option",{value:"center",children:"–ü–æ —Ü–µ–Ω—Ç—Ä—É"}),e.jsx("option",{value:"right",children:"–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–§–æ–Ω"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ñ–æ–Ω–∞"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2ecc71",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤"}),e.jsx("input",{type:"number",value:r.properties.borderRadius||8,onChange:s=>a("borderRadius",parseInt(s.target.value)),min:0,max:50})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–†–∞–º–∫–∞"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–æ–ª—â–∏–Ω–∞ —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°—Ç–∏–ª—å —Ä–∞–º–∫–∏"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"–°–ø–ª–æ—à–Ω–∞—è"}),e.jsx("option",{value:"dashed",children:"–®—Ç—Ä–∏—Ö–æ–≤–∞—è"}),e.jsx("option",{value:"dotted",children:"–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è"})]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–¢–µ–Ω—å"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.shadowEnabled||!1,onChange:s=>a("shadowEnabled",s.target.checked)}),"–í–∫–ª—é—á–∏—Ç—å —Ç–µ–Ω—å"]})}),r.properties.shadowEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ç–µ–Ω–∏"}),e.jsx("input",{type:"color",value:r.properties.shadowColor||"#000000",onChange:s=>a("shadowColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–†–∞–∑–º—ã—Ç–∏–µ"}),e.jsx("input",{type:"number",value:r.properties.shadowBlur||10,onChange:s=>a("shadowBlur",parseInt(s.target.value)),min:0,max:50})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–º–µ—â–µ–Ω–∏–µ X"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetX||0,onChange:s=>a("shadowOffsetX",parseInt(s.target.value)),min:-50,max:50})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–º–µ—â–µ–Ω–∏–µ Y"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetY||4,onChange:s=>a("shadowOffsetY",parseInt(s.target.value)),min:-50,max:50})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å"}),e.jsx("input",{type:"range",value:(r.properties.shadowOpacity||.3)*100,onChange:s=>a("shadowOpacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.shadowOpacity||.3)*100),"%"]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–î–µ–π—Å—Ç–≤–∏—è"}),e.jsx(Pe,{widget:r,onUpdate:s=>{n(r.id,{properties:{...r.properties,actions:s}})},allWidgets:t.widgets})]}),r.type==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–µ–∫—Å—Ç"}),e.jsx("textarea",{value:r.properties.text||"Text",onChange:s=>a("text",s.target.value),rows:6})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª"}),e.jsx("input",{type:"file",accept:".txt,.pdf,.odt,.docx",onChange:async s=>{const l=s.target.files?.[0];if(l)try{const{extractTextFromFile:i,loadRequiredLibraries:c}=await ze(async()=>{const{extractTextFromFile:u,loadRequiredLibraries:f}=await import("./fileTextExtractor-HZqzU4jo.js");return{extractTextFromFile:u,loadRequiredLibraries:f}},[]);c(),a("text","–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...");const p=await i(l);n(r.id,{properties:{...r.properties,text:p,sourceFile:l.name}})}catch(i){console.error("Error loading file:",i),alert(`–û—à–∏–±–∫–∞: ${i instanceof Error?i.message:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"}`),a("text","Text")}s.target.value=""}}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: TXT, PDF, ODT, DOCX"}),r.properties.sourceFile&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["üìÑ ",r.properties.sourceFile]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–®—Ä–∏—Ñ—Ç"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:144})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–µ–º–µ–π—Å—Ç–≤–æ —à—Ä–∏—Ñ—Ç–∞"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Impact",children:"Impact"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ù–∞—á–µ—Ä—Ç–∞–Ω–∏–µ"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"–û–±—ã—á–Ω—ã–π"}),e.jsx("option",{value:"bold",children:"–ñ–∏—Ä–Ω—ã–π"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°—Ç–∏–ª—å"}),e.jsxs("select",{value:r.properties.fontStyle||"normal",onChange:s=>a("fontStyle",s.target.value),children:[e.jsx("option",{value:"normal",children:"–û–±—ã—á–Ω—ã–π"}),e.jsx("option",{value:"italic",children:"–ö—É—Ä—Å–∏–≤"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–î–µ–∫–æ—Ä–∞—Ü–∏—è"}),e.jsxs("select",{value:r.properties.textDecoration||"none",onChange:s=>a("textDecoration",s.target.value),children:[e.jsx("option",{value:"none",children:"–ù–µ—Ç"}),e.jsx("option",{value:"underline",children:"–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π"}),e.jsx("option",{value:"line-through",children:"–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ü–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏"}),e.jsxs("select",{value:r.properties.textAlign||"left",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é"}),e.jsx("option",{value:"center",children:"–ü–æ —Ü–µ–Ω—Ç—Ä—É"}),e.jsx("option",{value:"right",children:"–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ü–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏"}),e.jsxs("select",{value:r.properties.verticalAlign||"top",onChange:s=>a("verticalAlign",s.target.value),children:[e.jsx("option",{value:"top",children:"–°–≤–µ—Ä—Ö—É"}),e.jsx("option",{value:"middle",children:"–ü–æ —Ü–µ–Ω—Ç—Ä—É"}),e.jsx("option",{value:"bottom",children:"–°–Ω–∏–∑—É"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–¶–≤–µ—Ç–∞ –∏ —Ñ–æ–Ω"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#000000",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ñ–æ–Ω–∞"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#ffffff",onChange:s=>a("backgroundColor",s.target.value)}),e.jsxs("label",{style:{marginTop:"4px",fontSize:"11px"},children:[e.jsx("input",{type:"checkbox",checked:r.properties.backgroundColor==="transparent",onChange:s=>a("backgroundColor",s.target.checked?"transparent":"#ffffff")}),"–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ú–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª"}),e.jsx("input",{type:"number",value:r.properties.lineHeight||1.2,onChange:s=>a("lineHeight",parseFloat(s.target.value)),min:.5,max:3,step:.1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–û—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—è"}),e.jsx("input",{type:"number",value:r.properties.padding||8,onChange:s=>a("padding",parseInt(s.target.value)),min:0,max:50})]})]}),r.type==="image"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"0",marginBottom:"12px",fontSize:"13px",fontWeight:"bold"},children:"–†–µ–∂–∏–º"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:!r.properties.galleryMode,onChange:()=>a("galleryMode",!1)})," ","–û–¥–∏–Ω–æ—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:r.properties.galleryMode||!1,onChange:()=>{a("galleryMode",!0),r.properties.sources||a("sources",[])}})," ","–ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"]})}),!r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{const l=s.target.files?.[0];if(l){const i=new FileReader;i.onload=c=>{const p=c.target?.result;p&&n(r.id,{properties:{...r.properties,src:p,isLocalFile:!0,fileName:l.name}})},i.readAsDataURL(l)}s.target.value=""}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["üìÅ ",r.properties.fileName]})]})]}),r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ò—Å—Ç–æ—á–Ω–∏–∫–∏ (–º–∞–∫—Å. 50)"}),e.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"8px",marginBottom:"8px",backgroundColor:"#fafafa"},children:[(r.properties.sources||[]).map((s,l)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",padding:"6px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #e0e0e0"},children:[e.jsxs("span",{style:{fontSize:"11px",color:"#666",minWidth:"20px"},children:[l+1,"."]}),e.jsx("span",{style:{fontSize:"11px",color:s.type==="url"?"#007acc":"#2ecc71"},children:s.type==="url"?"üåê":"üì∑"}),e.jsx("span",{style:{flex:1,fontSize:"11px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.value.length>40?s.value.substring(0,40)+"...":s.value}),e.jsx("button",{onClick:()=>{const i=(r.properties.sources||[]).filter((c,p)=>p!==l);a("sources",i)},style:{padding:"2px 6px",fontSize:"10px",border:"none",background:"#e74c3c",color:"#fff",borderRadius:"3px",cursor:"pointer"},children:"‚úï"})]},s.id)),(!r.properties.sources||r.properties.sources.length===0)&&e.jsx("div",{style:{textAlign:"center",color:"#999",fontSize:"11px",padding:"20px"},children:"–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –≥–∞–ª–µ—Ä–µ–µ"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,id:`gallery-upload-${r.id}`,style:{display:"none"},onChange:s=>{const l=Array.from(s.target.files||[]),i=r.properties.sources||[];if(i.length+l.length>50){alert("–ú–∞–∫—Å–∏–º—É–º 50 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –≥–∞–ª–µ—Ä–µ–µ"),s.target.value="";return}let c=0;const p=[];l.forEach(u=>{const f=new FileReader;f.onload=x=>{const v=x.target?.result;v&&p.push({id:`img-${Date.now()}-${Math.random()}`,type:"local",value:v}),c++,c===l.length&&a("sources",[...i,...p])},f.readAsDataURL(u)}),s.target.value=""}}),e.jsx("button",{onClick:()=>{document.getElementById(`gallery-upload-${r.id}`)?.click()},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"üì∑ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã"}),e.jsx("button",{onClick:()=>{const s=prompt("–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:");if(s){const l=r.properties.sources||[];if(l.length>=50){alert("–ú–∞–∫—Å–∏–º—É–º 50 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –≥–∞–ª–µ—Ä–µ–µ");return}a("sources",[...l,{id:`img-${Date.now()}-${Math.random()}`,type:"url",value:s}])}},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"üåê –î–æ–±–∞–≤–∏—Ç—å URL"})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoSwitch||!1,onChange:s=>a("autoSwitch",s.target.checked)})," ","–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ"]})}),r.properties.autoSwitch&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ò–Ω—Ç–µ—Ä–≤–∞–ª (—Å–µ–∫—É–Ω–¥—ã)"}),e.jsx("input",{type:"number",min:"1",max:"60",value:r.properties.switchInterval||3,onChange:s=>a("switchInterval",parseInt(s.target.value)||3)})]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–≠—Ñ—Ñ–µ–∫—Ç—ã –ø–µ—Ä–µ—Ö–æ–¥–∞"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–≠—Ñ—Ñ–µ–∫—Ç"}),e.jsxs("select",{value:r.properties.transition||"fade",onChange:s=>a("transition",s.target.value),children:[e.jsx("option",{value:"none",children:"–ù–µ—Ç (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)"}),e.jsx("option",{value:"fade",children:"–ó–∞—Ç—É—Ö–∞–Ω–∏–µ"}),e.jsx("option",{value:"slide",children:"–°–∫–æ–ª—å–∂–µ–Ω–∏–µ"}),e.jsx("option",{value:"zoom",children:"–£–≤–µ–ª–∏—á–µ–Ω–∏–µ"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º—Å)"}),e.jsx("input",{type:"number",min:"100",max:"2000",step:"100",value:r.properties.transitionDuration||500,onChange:s=>a("transitionDuration",parseInt(s.target.value)||500)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ö–æ–Ω—Ç—Ä–æ–ª—ã"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showControls!==!1,onChange:s=>a("showControls",s.target.checked)})," ","–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–µ–ª–∫–∏"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showIndicators!==!1,onChange:s=>a("showIndicators",s.target.checked)})," ","–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop!==!1,onChange:s=>a("loop",s.target.checked)})," ","–ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ"]})})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–≤–ø–∏—Å–∞—Ç—å)"}),e.jsx("option",{value:"cover",children:"–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å –≤–∏–¥–∂–µ—Ç"}),e.jsx("option",{value:"fill",children:"–†–∞—Å—Ç—è–Ω—É—Ç—å"}),e.jsx("option",{value:"scale-down",children:"–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä"}),e.jsx("option",{value:"adaptive",children:"–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π (–∏–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∂–µ—Ç)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–§–æ—Ä–º–∞ –æ–±—Ä–µ–∑–∫–∏"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–§–æ—Ä–º–∞"}),e.jsxs("select",{value:r.properties.clipShape||"rectangle",onChange:s=>a("clipShape",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"‚¨ú –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"circle",children:"‚ö´ –ö—Ä—É–≥"}),e.jsx("option",{value:"ellipse",children:"üî¥ –≠–ª–ª–∏–ø—Å"}),e.jsx("option",{value:"triangle",children:"üî∫ –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"diamond",children:"üî∂ –†–æ–º–±"}),e.jsx("option",{value:"pentagon",children:"‚¨¢ –ü—è—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"hexagon",children:"‚¨° –®–µ—Å—Ç–∏—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"octagon",children:"‚≠ê –í–æ—Å—å–º–∏—É–≥–æ–ª—å–Ω–∏–∫"}),e.jsx("option",{value:"rounded-rectangle",children:"üè∑Ô∏è –ó–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫"})]})]}),r.properties.clipShape==="rounded-rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–†–∞–¥–∏—É—Å —É–≥–ª–æ–≤ (px)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.properties.cornerRadius||20,onChange:s=>a("cornerRadius",parseInt(s.target.value)||20)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–†–∞–º–∫–∞"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"–í–∫–ª—é—á–∏—Ç—å —Ä–∞–º–∫—É"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø —Ä–∞–º–∫–∏"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"–°–ø–ª–æ—à–Ω–∞—è"}),e.jsx("option",{value:"dashed",children:"–®—Ç—Ä–∏—Ö–æ–≤–∞—è"}),e.jsx("option",{value:"dotted",children:"–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è"}),e.jsx("option",{value:"double",children:"–î–≤–æ–π–Ω–∞—è"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–æ–ª—â–∏–Ω–∞ —Ä–∞–º–∫–∏ (px)"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseFloat(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="video"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞"}),e.jsxs("select",{value:r.properties.sourceType||"url",onChange:s=>a("sourceType",s.target.value),children:[e.jsx("option",{value:"url",children:"URL / –§–∞–π–ª"}),e.jsx("option",{value:"rtsp",children:"RTSP –ø–æ—Ç–æ–∫"})]})]}),r.properties.sourceType==="rtsp"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"RTSP URL"}),e.jsx("input",{type:"text",value:r.properties.rtspUrl||"",onChange:s=>a("rtspUrl",s.target.value),placeholder:"rtsp://username:password@host:554/stream"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"–ü—Ä–∏–º–µ—Ä: rtsp://admin:12345@192.168.1.100:554/live"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL –≤–∏–¥–µ–æ"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/video.mp4"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"}),e.jsx("input",{type:"file",accept:"video/*",onChange:async s=>{const l=s.target.files?.[0];if(l){if(l.size>524288e3){alert("‚ö†Ô∏è –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 500 MB"),s.target.value="";return}try{if(console.log(`‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ (${(l.size/(1024*1024)).toFixed(1)} MB)...`),!t?.id){alert("‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç"),s.target.value="";return}const c=await U.uploadFile(t.id,l);c&&(n(r.id,{properties:{...r.properties,src:c.url,isLocalFile:!1,fileName:l.name}}),alert("‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä!"))}catch(c){console.error("Upload error:",c),alert("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: "+c.message)}s.target.value=""}}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["üìÅ ",r.properties.fileName]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–∏–ø –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–≤–ø–∏—Å–∞—Ç—å)"}),e.jsx("option",{value:"cover",children:"–ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å –≤–∏–¥–∂–µ—Ç"}),e.jsx("option",{value:"fill",children:"–†–∞—Å—Ç—è–Ω—É—Ç—å"}),e.jsx("option",{value:"scale-down",children:"–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä"}),e.jsx("option",{value:"adaptive",children:"–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π (–∏–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∂–µ—Ç)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoplay||!1,onChange:s=>a("autoplay",s.target.checked)}),"–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop||!1,onChange:s=>a("loop",s.target.checked)}),"–ü–æ–≤—Ç–æ—Ä (loop)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.muted!==!1,onChange:s=>a("muted",s.target.checked)}),"–ë–µ–∑ –∑–≤—É–∫–∞ (muted)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.controls!==!1,onChange:s=>a("controls",s.target.checked)}),"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–†–∞–º–∫–∞"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"–í–∫–ª—é—á–∏—Ç—å —Ä–∞–º–∫—É"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°—Ç–∏–ª—å —Ä–∞–º–∫–∏"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"–°–ø–ª–æ—à–Ω–∞—è"}),e.jsx("option",{value:"dashed",children:"–®—Ç—Ä–∏—Ö–æ–≤–∞—è"}),e.jsx("option",{value:"dotted",children:"–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è"}),e.jsx("option",{value:"double",children:"–î–≤–æ–π–Ω–∞—è"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–æ–ª—â–∏–Ω–∞ —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="menu"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è"}),e.jsxs("select",{value:r.properties.orientation||"horizontal",onChange:s=>a("orientation",s.target.value),children:[e.jsx("option",{value:"horizontal",children:"–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è"}),e.jsx("option",{value:"vertical",children:"–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–í–Ω–µ—à–Ω–∏–π –≤–∏–¥"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ñ–æ–Ω–∞"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2c3e50",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏"}),e.jsx("input",{type:"color",value:r.properties.hoverColor||"#34495e",onChange:s=>a("hoverColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–®—Ä–∏—Ñ—Ç"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:10,max:32})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–°–µ–º–µ–π—Å—Ç–≤–æ —à—Ä–∏—Ñ—Ç–∞"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–†–∞–∑–º–µ—Ä—ã"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–í—ã—Å–æ—Ç–∞ –ø—É–Ω–∫—Ç–∞"}),e.jsx("input",{type:"number",value:r.properties.itemHeight||40,onChange:s=>a("itemHeight",parseInt(s.target.value)),min:30,max:100})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–û—Ç—Å—Ç—É–ø –ø—É–Ω–∫—Ç–∞"}),e.jsx("input",{type:"number",value:r.properties.itemPadding||16,onChange:s=>a("itemPadding",parseInt(s.target.value)),min:8,max:40})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ü–æ–¥–º–µ–Ω—é"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–æ–¥–º–µ–Ω—é"}),e.jsx("input",{type:"color",value:r.properties.submenuBackgroundColor||"#34495e",onChange:s=>a("submenuBackgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥–º–µ–Ω—é"}),e.jsx("input",{type:"color",value:r.properties.submenuTextColor||"#ffffff",onChange:s=>a("submenuTextColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–†–∞–º–∫–∞"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¢–æ–ª—â–∏–Ω–∞ —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–¶–≤–µ—Ç —Ä–∞–º–∫–∏"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"–ü—É–Ω–∫—Ç—ã –º–µ–Ω—é"}),e.jsx("div",{className:"property-field",children:e.jsx("button",{className:"btn-secondary",onClick:()=>{const s=r.properties.items||[],l={id:`item-${Date.now()}`,label:"–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç"};n(r.id,{properties:{...r.properties,items:[...s,l]}})},style:{width:"100%"},children:"‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç"})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:(r.properties.items||[]).map((s,l)=>e.jsxs("div",{style:{background:"#252525",padding:"12px",marginBottom:"8px",borderRadius:"6px",border:"1px solid #333"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("strong",{style:{fontSize:"12px",color:"#aaa"},children:["–ü—É–Ω–∫—Ç ",l+1]}),e.jsx("button",{className:"btn-danger",onClick:()=>{const i=r.properties.items||[];n(r.id,{properties:{...r.properties,items:i.filter(c=>c.id!==s.id)}})},style:{fontSize:"11px",padding:"4px 8px"},children:"üóëÔ∏è –£–¥–∞–ª–∏—Ç—å"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"–ù–∞–∑–≤–∞–Ω–∏–µ"}),e.jsx("input",{type:"text",value:s.label,onChange:i=>{const c=[...r.properties.items||[]];c[l]={...c[l],label:i.target.value},n(r.id,{properties:{...r.properties,items:c}})}})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ"}),e.jsx(Pe,{widget:{...r,id:s.id,properties:s},onUpdate:i=>{const c=[...r.properties.items||[]];c[l]={...c[l],actions:i},n(r.id,{properties:{...r.properties,items:c}})},allWidgets:t.widgets})]}),e.jsxs("div",{style:{marginTop:"12px",paddingLeft:"12px",borderLeft:"2px solid #444"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"–ü–æ–¥–ø—É–Ω–∫—Ç—ã"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{const i=[...r.properties.items||[]],c=i[l].children||[];i[l]={...i[l],children:[...c,{id:`subitem-${Date.now()}`,label:"–ü–æ–¥–ø—É–Ω–∫—Ç"}]},n(r.id,{properties:{...r.properties,items:i}})},style:{width:"100%",fontSize:"11px",padding:"6px",marginBottom:"8px"},children:"‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø—É–Ω–∫—Ç"}),(s.children||[]).map((i,c)=>e.jsx("div",{style:{background:"#1e1e1e",padding:"8px",marginBottom:"6px",borderRadius:"4px",border:"1px solid #2a2a2a"},children:e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"text",value:i.label,onChange:p=>{const u=[...r.properties.items||[]],f=[...u[l].children||[]];f[c]={...f[c],label:p.target.value},u[l]={...u[l],children:f},n(r.id,{properties:{...r.properties,items:u}})},style:{flex:1,fontSize:"12px",padding:"4px 8px"}}),e.jsx("button",{className:"btn-danger",onClick:()=>{const p=[...r.properties.items||[]],u=p[l].children?.filter(f=>f.id!==i.id)||[];p[l]={...p[l],children:u},n(r.id,{properties:{...r.properties,items:p}})},style:{fontSize:"11px",padding:"4px 8px"},children:"üóëÔ∏è"})]})},i.id))]})]},s.id))})]})]}),e.jsx("div",{className:"property-section",children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID"}),e.jsx("input",{type:"text",value:r.id,disabled:!0,style:{opacity:.5,cursor:"not-allowed"}})]})})]})]}):e.jsxs("div",{className:"properties-panel panel",children:[e.jsx("div",{className:"properties-header",children:e.jsx("h3",{children:"–°–≤–æ–π—Å—Ç–≤–∞"})}),e.jsx("div",{className:"properties-empty",children:e.jsx("p",{children:"–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–∂–µ—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"})})]})},dr=()=>{const t=We(),[o,n]=y.useState(0),{project:r,restoreProject:d,selectedWidgetIds:a,copy:s,paste:l,cut:i,deleteWidget:c,undo:p,redo:u}=B();return y.useEffect(()=>{(async()=>{console.log("[Editor] Checking for project to restore...");const x=await d();console.log(x?"[Editor] Project restored successfully":"[Editor] No project to restore")})()},[]),y.useEffect(()=>{const f=v=>{const k=v.detail?.reason||"unknown";console.log("[Editor] Logout event received, reason:",k),k==="inactivity"&&sessionStorage.setItem("kiosk_logout_reason","inactivity"),t("/login",{replace:!0})},x=()=>{console.log("[Editor] Unauthorized event received"),sessionStorage.setItem("kiosk_logout_reason","session_expired"),t("/login",{replace:!0})};return window.addEventListener("auth:logout",f),window.addEventListener("auth:unauthorized",x),()=>{window.removeEventListener("auth:logout",f),window.removeEventListener("auth:unauthorized",x)}},[t]),y.useEffect(()=>{const f=x=>{(x.ctrlKey||x.metaKey)&&x.key==="z"&&!x.shiftKey&&(x.preventDefault(),p()),(x.ctrlKey||x.metaKey)&&x.key==="z"&&x.shiftKey&&(x.preventDefault(),u()),(x.ctrlKey||x.metaKey)&&x.key==="c"&&(x.preventDefault(),s()),(x.ctrlKey||x.metaKey)&&x.key==="v"&&(x.preventDefault(),l()),(x.ctrlKey||x.metaKey)&&x.key==="x"&&(x.preventDefault(),i()),x.key==="Delete"&&(x.preventDefault(),a.forEach(v=>c(v)))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[]),y.useEffect(()=>{const f=()=>{n(x=>x+1)};return window.addEventListener("auth:login",f),()=>window.removeEventListener("auth:login",f)},[]),e.jsxs("div",{className:"editor",children:[e.jsx(It,{}),e.jsx(Vt,{}),e.jsxs("div",{className:"editor-main",children:[e.jsx(or,{}),e.jsx(nr,{}),e.jsx(cr,{})]})]})},hr=({children:t})=>U.isAuthenticated()?e.jsx(e.Fragment,{children:t}):(console.log("[ProtectedRoute] Not authenticated, redirecting to /login"),e.jsx(ge,{to:"/login",replace:!0})),pr=()=>(console.log("[App.tsx] App component rendering with Router"),e.jsx(Be,{children:e.jsxs(He,{children:[e.jsx(ie,{path:"/",element:e.jsx(ge,{to:"/login",replace:!0})}),e.jsx(ie,{path:"/login",element:e.jsx(Et,{})}),e.jsx(ie,{path:"/editor",element:e.jsx(hr,{children:e.jsx(dr,{})})}),e.jsx(ie,{path:"*",element:e.jsx(ge,{to:"/login",replace:!0})})]})}));try{const t=document.getElementById("root");if(!t)throw new Error("Root element not found");et.createRoot(t).render(e.jsx(G.StrictMode,{children:e.jsx(pr,{})}))}catch(t){console.error("Failed to mount React app:",t),document.body.innerHTML=`
    <div style="
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #1e1e1e;
      color: #ff6b6b;
      font-family: Arial, sans-serif;
      padding: 20px;
    ">
      <div style="text-align: center; max-width: 600px;">
        <h1>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h1>
        <p style="color: #cccccc;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>
        <pre style="
          text-align: left;
          background: #2a2a2a;
          padding: 15px;
          border-radius: 5px;
          overflow-x: auto;
          color: #ff6b6b;
        ">${t}</pre>
        <button onclick="location.reload()" style="
          margin-top: 20px;
          padding: 10px 20px;
          background: #4a90e2;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        ">
          –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        </button>
      </div>
    </div>
  `}
//# sourceMappingURL=index-zJaTaKGG.js.map
