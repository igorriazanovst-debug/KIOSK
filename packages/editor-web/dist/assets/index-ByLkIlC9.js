import{r as me,d as Ue,g as Ae,b as k,u as Le,e as qe,R as V,N as fe,B as Ve,f as Xe,h as re}from"./vendor-CAp4Hrcn.js";import{I as ne,G as K,R as A,L as ee,E as Fe,C as De,T as $,a as oe,S as Ge,b as Ye,c as Ke,d as Je}from"./konva-CVeCxRDN.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))r(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(h){if(h.ep)return;h.ep=!0;const a=n(h);fetch(h.href,a)}})();var ce={exports:{}},se={};var ye;function Ze(){if(ye)return se;ye=1;var t=me(),i=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,h=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function s(c,o,d){var p,j={},g=null,m=null;d!==void 0&&(g=""+d),o.key!==void 0&&(g=""+o.key),o.ref!==void 0&&(m=o.ref);for(p in o)r.call(o,p)&&!a.hasOwnProperty(p)&&(j[p]=o[p]);if(c&&c.defaultProps)for(p in o=c.defaultProps,o)j[p]===void 0&&(j[p]=o[p]);return{$$typeof:i,type:c,key:g,ref:m,props:j,_owner:h.current}}return se.Fragment=n,se.jsx=s,se.jsxs=s,se}var be;function Qe(){return be||(be=1,ce.exports=Ze()),ce.exports}var e=Qe(),ae={},ke;function et(){if(ke)return ae;ke=1;var t=Ue();return ae.createRoot=t.createRoot,ae.hydrateRoot=t.hydrateRoot,ae}var tt=et();const rt=Ae(tt);var st={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const nt=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),it=(t,i)=>{const n=k.forwardRef(({color:r="currentColor",size:h=24,strokeWidth:a=2,absoluteStrokeWidth:s,children:c,...o},d)=>k.createElement("svg",{ref:d,...st,width:h,height:h,stroke:r,strokeWidth:s?Number(a)*24/Number(h):a,className:`lucide lucide-${nt(t)}`,...o},[...i.map(([p,j])=>k.createElement(p,j)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${t}`,n};var F=it;const je=F("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ot=F("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),at=F("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),lt=F("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),ct=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),le=F("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),dt=F("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),ht=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Se=F("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),ve=F("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),pt=F("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ut=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),xt=F("Magnet",[["path",{d:"m6 15-4-4 6.75-6.77a7.79 7.79 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15",key:"1i3lhw"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}],["path",{d:"m12 15 4 4",key:"lnac28"}]]),ft=F("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),gt=F("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),ge=F("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),mt=F("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),jt=F("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),vt=F("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]),yt=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),bt=F("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),kt=F("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),$e=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),St=F("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Ct=F("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),wt=F("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Nt=F("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Et=F("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),_e=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),It=F("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Tt=F("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);class Pt{logs=[];MAX_LOGS=100;log(i,n,r){const h={timestamp:new Date().toISOString(),level:i,message:n,details:r};this.logs.push(h),this.logs.length>this.MAX_LOGS&&this.logs.shift(),(i==="error"?console.error:i==="warn"?console.warn:console.log)(`[${i.toUpperCase()}] ${n}`,r||"")}info(i,n){this.log("info",i,n)}warn(i,n){this.log("warn",i,n)}error(i,n){this.log("error",i,n)}getLogs(){return[...this.logs]}clear(){this.logs=[]}export(){return JSON.stringify(this.logs,null,2)}}const D=new Pt;class zt{DEBUG_MODE=!1;DEBUG_INACTIVITY_MINUTES=3;baseUrl="";getBaseUrl(){return this.baseUrl}token=null;organizationName=null;plan=null;lastActivity=Date.now();inactivityTimer=null;warningTimer=null;INACTIVITY_TIMEOUT=this.DEBUG_MODE?this.DEBUG_INACTIVITY_MINUTES*60*1e3:3600*1e3;WARNING_TIME=this.DEBUG_MODE?(this.DEBUG_INACTIVITY_MINUTES-2)*60*1e3:3480*1e3;constructor(){this.loadToken(),this.startActivityMonitoring()}loadToken(){const i=sessionStorage.getItem("kiosk_auth_token");if(i)try{const n=JSON.parse(i),r=n.lastActivityTime||Date.now(),h=Date.now()-r;h<this.INACTIVITY_TIMEOUT?(this.token=n.token,this.organizationName=n.organizationName||null,this.plan=n.plan||null,this.lastActivity=Date.now(),this.updateActivityTime(),D.info("Token loaded from sessionStorage",{hasToken:!!this.token,organization:this.organizationName,plan:this.plan,inactiveDuration:Math.round(h/1e3)+"s"})):(D.warn("Session expired due to inactivity",{inactiveDuration:Math.round(h/1e3/60)+" minutes"}),this.clearToken())}catch(n){D.error("Failed to parse stored token",n),this.clearToken()}}saveToken(i,n,r){const h={token:i,organizationName:n,plan:r,lastActivityTime:Date.now(),savedAt:new Date().toISOString()};sessionStorage.setItem("kiosk_auth_token",JSON.stringify(h)),sessionStorage.setItem("kiosk_org_data",JSON.stringify({name:n,plan:r})),this.token=i,this.organizationName=n,this.plan=r,this.lastActivity=Date.now(),D.info("Token saved to sessionStorage",{organization:n,plan:r})}updateActivityTime(){const i=sessionStorage.getItem("kiosk_auth_token");if(i)try{const n=JSON.parse(i);n.lastActivityTime=Date.now(),sessionStorage.setItem("kiosk_auth_token",JSON.stringify(n))}catch(n){D.error("Failed to update activity time",n)}}clearToken(){sessionStorage.removeItem("kiosk_auth_token"),sessionStorage.removeItem("kiosk_org_data"),this.token=null,this.organizationName=null,this.plan=null,D.info("Token cleared from sessionStorage")}isAuthenticated(){return this.token!==null}getToken(){return this.token}getOrganizationData(){return{name:this.organizationName,plan:this.plan}}async loginWithLicense(i){D.info("Attempting login with license key");try{const n=await this.request("/api/auth/license",{method:"POST",body:JSON.stringify({licenseKey:i})});return n.token&&n.license&&(this.saveToken(n.token,n.license.organizationName,n.license.plan),D.info("Login successful",{organization:n.license.organizationName,plan:n.license.plan})),n}catch(n){throw D.error("Login failed",n),n}}async refreshToken(){D.info("Refreshing token");try{const i=await this.request("/api/auth/refresh",{method:"POST",authenticated:!0});return i.token&&i.license&&(this.saveToken(i.token,i.license.organizationName,i.license.plan),D.info("Token refreshed successfully")),i}catch(i){throw D.error("Token refresh failed",i),i}}async verifyToken(){try{return await this.request("/api/auth/verify",{method:"GET",authenticated:!0}),D.info("Token verified successfully"),!0}catch(i){return D.warn("Token verification failed",i),this.clearToken(),!1}}logout(){D.info("User logout"),this.clearToken(),this.stopActivityMonitoring(),window.dispatchEvent(new CustomEvent("auth:logout"))}updateActivity(){this.lastActivity=Date.now(),this.updateActivityTime(),this.resetTimers()}resetTimers(){this.warningTimer&&clearTimeout(this.warningTimer),this.inactivityTimer&&clearTimeout(this.inactivityTimer),this.warningTimer=setTimeout(()=>{D.warn("Inactivity warning - 2 minutes until logout"),window.dispatchEvent(new CustomEvent("auth:inactivity-warning",{detail:{timeRemaining:120*1e3}}))},this.WARNING_TIME),this.inactivityTimer=setTimeout(()=>{D.warn("Session expired due to inactivity"),this.logout()},this.INACTIVITY_TIMEOUT)}startActivityMonitoring(){if(!this.isAuthenticated())return;["mousemove","keypress","click","scroll","touchstart"].forEach(n=>{window.addEventListener(n,()=>this.updateActivity(),{passive:!0})}),this.resetTimers(),D.info("Activity monitoring started",{timeout:this.INACTIVITY_TIMEOUT/1e3/60+" minutes",warning:this.WARNING_TIME/1e3/60+" minutes"})}stopActivityMonitoring(){this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null),this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),D.info("Activity monitoring stopped")}async getProjects(i){const n=new URLSearchParams;i?.search&&n.append("search",i.search),i?.tags&&n.append("tags",i.tags.join(",")),i?.isPublished!==void 0&&n.append("isPublished",String(i.isPublished)),i?.page&&n.append("page",String(i.page)),i?.limit&&n.append("limit",String(i.limit));const r=n.toString(),h=`/api/projects${r?"?"+r:""}`;return this.request(h,{method:"GET",authenticated:!0})}async createProject(i){return(await this.request("/api/projects",{method:"POST",authenticated:!0,body:JSON.stringify(i)})).project}async getProject(i){return(await this.request(`/api/projects/${i}`,{method:"GET",authenticated:!0})).project}async updateProject(i,n){return(await this.request(`/api/projects/${i}`,{method:"PUT",authenticated:!0,body:JSON.stringify(n)})).project}async deleteProject(i){await this.request(`/api/projects/${i}`,{method:"DELETE",authenticated:!0})}async getProjectFiles(i){return(await this.request(`/api/projects/${i}/files`,{method:"GET",authenticated:!0})).files}async uploadFile(i,n,r){const h=new FormData;return h.append("file",n),new Promise((a,s)=>{const c=new XMLHttpRequest;r&&c.upload.addEventListener("progress",o=>{if(o.lengthComputable){const d=o.loaded/o.total*100;r(d)}}),c.addEventListener("load",()=>{if(c.status===200||c.status===201)try{const o=JSON.parse(c.responseText);a(o.file||o)}catch{s(new Error("Failed to parse response"))}else try{const o=JSON.parse(c.responseText);s(new Error(o.message||`Upload failed: ${c.status}`))}catch{s(new Error(`Upload failed: ${c.status}`))}}),c.addEventListener("error",()=>{s(new Error("Network error"))}),c.open("POST",`/api/projects/${i}/files`),this.token&&c.setRequestHeader("Authorization",`Bearer ${this.token}`),c.send(h)})}async downloadFile(i,n){const r=await fetch(`/api/projects/${i}/files/${n}`,{method:"GET",headers:this.token?{Authorization:`Bearer ${this.token}`}:{}});if(!r.ok)throw new Error(`Download failed: ${r.status}`);return r.blob()}async deleteFile(i,n){await this.request(`/api/projects/${i}/files/${n}`,{method:"DELETE",authenticated:!0})}async getStorageStats(){return this.request("/api/storage/stats",{method:"GET",authenticated:!0})}async request(i,n){const r=`${this.baseUrl}${i}`,h={"Content-Type":"application/json"};n.authenticated&&this.token&&(h.Authorization=`Bearer ${this.token}`);try{const a=await fetch(r,{method:n.method,headers:h,body:n.body});if(n.authenticated&&a.ok&&this.updateActivity(),!a.ok){if(a.status===401)throw D.warn("Unauthorized - clearing token"),this.clearToken(),window.dispatchEvent(new CustomEvent("auth:unauthorized")),new Error("Unauthorized");const s=await a.json().catch(()=>({}));throw new Error(s.message||`HTTP ${a.status}`)}return await a.json()}catch(a){throw D.error("Request failed",{endpoint:i,method:n.method,error:a}),a}}}const O=new zt,Wt=()=>{const t=Le(),[i,n]=k.useState(""),[r,h]=k.useState(!1),[a,s]=k.useState(null);k.useEffect(()=>{const m=sessionStorage.getItem("kiosk_logout_reason");m==="inactivity"?(o("Вы были автоматически выведены из системы из-за неактивности"),D.info("Logout reason: inactivity")):m==="session_expired"&&(o("Ваша сессия истекла. Пожалуйста, войдите снова"),D.info("Logout reason: session expired")),sessionStorage.removeItem("kiosk_logout_reason"),m&&setTimeout(()=>o(null),5e3)},[]);const[c,o]=k.useState(null),d=m=>(m.replace(/[^A-Z0-9]/gi,"").toUpperCase().match(/.{1,4}/g)||[]).join("-").substring(0,19),p=m=>{const S=d(m.target.value);n(S),s(null)},j=async m=>{if(m.preventDefault(),i.length<19){s("Введите полный ключ лицензии (16 символов)");return}h(!0),s(null);try{console.log("[LoginPage] Attempting login");const S=await O.loginWithLicense(i);console.log("[LoginPage] Login successful, redirecting to /editor"),t("/editor",{replace:!0})}catch(S){console.error("[LoginPage] Login failed:",S),s(S.message||"Не удалось выполнить вход. Проверьте ключ лицензии."),h(!1)}},g=m=>{m.preventDefault();const S=m.clipboardData.getData("text"),y=d(S);n(y)};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-header",children:[e.jsx(Se,{size:48,className:"login-icon"}),e.jsx("h1",{children:"Kiosk Editor"}),e.jsx("p",{children:"Вход в систему"})]}),e.jsxs("form",{onSubmit:j,className:"login-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"licenseKey",children:"Ключ лицензии"}),e.jsx("input",{type:"text",id:"licenseKey",placeholder:"XXXX-XXXX-XXXX-XXXX",value:i,onChange:p,onPaste:g,disabled:r,autoFocus:!0,maxLength:19,className:a?"error":""}),e.jsx("span",{className:"input-hint",children:"Формат: 4 группы по 4 символа"})]}),a&&e.jsxs("div",{className:"error-message",children:[e.jsx(je,{size:16}),e.jsx("span",{children:a})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:r||i.length<19,children:r?e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:20,className:"spinner"}),e.jsx("span",{children:"Вход..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{size:20}),e.jsx("span",{children:"Войти"})]})})]}),e.jsxs("div",{className:"test-keys",children:[e.jsx("p",{children:"Тестовые ключи:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"BASIC:"})," ",e.jsx("code",{children:"EWZA-E5LJ-Z558-9LUQ"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"PRO:"})," ",e.jsx("code",{children:"3VBN-8ZQ9-1MKO-AK0R"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"MAX:"})," ",e.jsx("code",{children:"T8MH-FJE3-ETAC-YOZF"})]})]})]})]})})};function Ce(t,i,n,r=0,h=!1){const a=i/2,s=n/2,c=Math.min(i,n)/2,o=(p,j)=>h?`${p.toFixed(1)}px ${j.toFixed(1)}px`:`${(p/i*100).toFixed(1)}% ${(j/n*100).toFixed(1)}%`,d=(p,j=-Math.PI/2)=>{const g=[];for(let m=0;m<p;m++){const S=j+2*Math.PI*m/p;g.push(o(a+c*Math.cos(S),s+c*Math.sin(S)))}return`polygon(${g.join(", ")})`};switch(t){case"circle":return h?`circle(${c.toFixed(1)}px at ${a.toFixed(1)}px ${s.toFixed(1)}px)`:`circle(${c}px at ${a}px ${s}px)`;case"ellipse":return h?`ellipse(${(i/2).toFixed(1)}px ${(n/2).toFixed(1)}px at ${a.toFixed(1)}px ${s.toFixed(1)}px)`:"ellipse(50% 50% at 50% 50%)";case"triangle":return`polygon(${[-Math.PI/2,Math.PI/6,5*Math.PI/6].map(g=>o(a+c*Math.cos(g),s+c*Math.sin(g))).join(", ")})`;case"diamond":return`polygon(${o(a,0)}, ${o(i,s)}, ${o(a,n)}, ${o(0,s)})`;case"pentagon":return d(5);case"hexagon":return d(6);case"octagon":return d(8);case"star":{const p=[];for(let j=0;j<10;j++){const g=j*Math.PI/5-Math.PI/2,m=j%2===0?c:c*.5;p.push(o(a+m*Math.cos(g),s+m*Math.sin(g)))}return`polygon(${p.join(", ")})`}default:return}}const Rt=({widgetId:t,commonStyle:i,items:n,isHorizontal:r,backgroundColor:h,textColor:a,hoverColor:s,fontSize:c,fontFamily:o,itemPadding:d,itemHeight:p,submenuBackgroundColor:j,submenuTextColor:g,borderWidth:m,borderColor:S,executeActions:y})=>{const[u,f]=k.useState(null),[w,E]=k.useState(null),N={...i,backgroundColor:h,display:"flex",flexDirection:r?"row":"column",border:m>0?`${m}px solid ${S}`:"none",overflow:"visible",position:"absolute"},b=l=>({display:"flex",alignItems:"center",padding:`0 ${d}px`,height:`${p}px`,minWidth:r?"auto":"100%",color:u===l?g:a,backgroundColor:u===l?s:"transparent",fontSize:`${c}px`,fontFamily:o,cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",transition:"background-color 0.15s",position:"relative",boxSizing:"border-box"}),I=l=>({display:w===l?"flex":"none",flexDirection:"column",position:"absolute",top:r?`${p}px`:"0",left:r?"0":"100%",backgroundColor:j,zIndex:9999,minWidth:"150px",boxShadow:"2px 4px 12px rgba(0,0,0,0.4)"});return e.jsx("div",{"data-widget-id":t,style:N,children:n.map(l=>{const v=l.children&&l.children.length>0;return e.jsxs("div",{style:{position:"relative"},onMouseEnter:()=>{f(l.id),v&&E(l.id)},onMouseLeave:()=>{f(null),v&&E(null)},children:[e.jsxs("div",{style:b(l.id),onClick:()=>{l.actions&&l.actions.length>0&&y(l.actions)},children:[l.label,v&&e.jsx("span",{style:{marginLeft:"6px",fontSize:"10px",opacity:.7},children:r?"▼":"▶"})]}),v&&e.jsx("div",{style:I(l.id),children:l.children.map(x=>e.jsx("div",{style:{padding:`0 ${d}px`,height:`${p}px`,display:"flex",alignItems:"center",color:u===x.id?a:g,backgroundColor:u===x.id?s:"transparent",fontSize:`${c-2}px`,fontFamily:o,cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",transition:"background-color 0.15s"},onMouseEnter:()=>f(x.id),onMouseLeave:()=>f(null),onClick:()=>{x.actions&&x.actions.length>0&&y(x.actions)},children:x.label},x.id))})]},l.id)})})},Mt=()=>{const[t]=qe(),i=t.get("projectId"),[n,r]=k.useState(null),[h,a]=k.useState(!0),[s,c]=k.useState(null),[o,d]=k.useState(!1),[p,j]=k.useState(null),[g,m]=k.useState(new Set);k.useEffect(()=>{if(!i){c("Project ID not provided"),a(!1);return}(async()=>{try{const f=await O.getProject(i),w={id:f.id,version:"1.0",name:f.name,canvas:{width:f.canvasWidth,height:f.canvasHeight,backgroundColor:f.canvasBackground},widgets:f.projectData?.widgets||[]};r(w)}catch(f){c(f.message||"Failed to load project")}finally{a(!1)}})()},[i]),k.useEffect(()=>{if(!i)return;const u=()=>{const f=localStorage.getItem("kiosk_client_token")||sessionStorage.getItem("kiosk_client_token");if(!f||!i)return;const E=`${window.location.origin}/api/projects/${i}`;try{const N=new Blob([JSON.stringify({_method:"DELETE"})],{type:"application/json"}),b=new XMLHttpRequest;b.open("DELETE",E,!1),b.setRequestHeader("Authorization",`Bearer ${f}`),b.send()}catch{fetch(E,{method:"DELETE",headers:{Authorization:`Bearer ${f}`},keepalive:!0}).catch(()=>{})}};return window.addEventListener("beforeunload",u),window.addEventListener("pagehide",u),()=>{window.removeEventListener("beforeunload",u),window.removeEventListener("pagehide",u),u()}},[i]),k.useEffect(()=>{const u=f=>{f.key==="Escape"&&(o?d(!1):window.close())};return document.documentElement.requestFullscreen?.().catch(()=>{}),window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[o]);const S=u=>{u.forEach(f=>{switch(f.type){case"url":f.url&&(f.openInNewTab?window.open(f.url,"_blank"):window.location.href=f.url);break;case"popup":j({title:f.popupTitle||"Информация",content:f.popupContent||"",width:f.popupWidth||400,height:f.popupHeight||300}),d(!0);break;case"widget_show":f.targetWidgetId&&m(w=>{const E=new Set(w);return E.delete(f.targetWidgetId),E});break;case"widget_hide":f.targetWidgetId&&m(w=>new Set(w).add(f.targetWidgetId));break;case"video_play":if(f.targetWidgetId){const w=document.querySelector(`[data-widget-id="${f.targetWidgetId}"] video`);w&&w.play()}break;case"video_stop":if(f.targetWidgetId){const w=document.querySelector(`[data-widget-id="${f.targetWidgetId}"] video`);w&&(w.pause(),w.currentTime=0)}break}})},y=u=>{if(g.has(u.id))return null;const f=u.events,w=()=>{f&&f.filter(N=>N.trigger==="click").forEach(N=>S(N.actions))},E={position:"absolute",left:u.x,top:u.y,width:u.width,height:u.height,transform:u.rotation?`rotate(${u.rotation}deg)`:void 0,transformOrigin:"top left",cursor:f&&f.some(N=>N.trigger==="click")?"pointer":"default",zIndex:u.zIndex||0};if(u.type==="shape"){const{shapeType:N="rectangle",fillColor:b="#4a90e2",strokeColor:I="#000000",strokeWidth:l=0,cornerRadius:v=0,opacity:x=1}=u.properties,C=Ce(N,u.width,u.height,v),M=C!==void 0,W=N==="circle"?"50%":N==="rounded-rectangle"||N==="rectangle"?`${v}px`:void 0;if(M&&l>0){const T=(u.width-l*4)/u.width,z=(u.height-l*4)/u.height;return e.jsxs("div",{"data-widget-id":u.id,style:{...E,opacity:x},onClick:w,children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:I,clipPath:C,WebkitClipPath:C}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:b,clipPath:C,WebkitClipPath:C,transform:`scale(${T}, ${z})`}})]},u.id)}return M?e.jsx("div",{"data-widget-id":u.id,style:{...E,backgroundColor:b,clipPath:C,WebkitClipPath:C,opacity:x},onClick:w},u.id):e.jsx("div",{"data-widget-id":u.id,style:{...E,backgroundColor:b,border:l>0?`${l}px solid ${I}`:"none",borderRadius:W,opacity:x},onClick:w},u.id)}if(u.type==="text"){const{text:N="Text",fontSize:b=24,color:I="#000000",fontFamily:l="Arial",fontWeight:v="normal",textAlign:x="left",verticalAlign:C="top",backgroundColor:M="transparent"}=u.properties;return e.jsx("div",{"data-widget-id":u.id,style:{...E,fontSize:`${b}px`,color:I,fontFamily:l,fontWeight:v,backgroundColor:M,textAlign:x,display:"flex",alignItems:C==="middle"?"center":C==="bottom"?"flex-end":"flex-start",whiteSpace:"pre-wrap",wordWrap:"break-word"},onClick:w,children:N},u.id)}if(u.type==="image"){const{src:N="",objectFit:b="contain",opacity:I=1,clipShape:l="rectangle",cornerRadius:v=0,borderEnabled:x=!1,borderWidth:C=2,borderColor:M="#000000"}=u.properties;if(!N)return null;const W=l&&l!=="rectangle",T=W?Ce(l,u.width,u.height,v):void 0,z=W?"cover":b,R=l==="rounded-rectangle"&&v?`${v}px`:void 0;if(W&&x&&C>0){const P=(u.width-C*4)/u.width,L=(u.height-C*4)/u.height;return e.jsxs("div",{"data-widget-id":u.id,style:{...E,opacity:I},onClick:w,children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:M,clipPath:T,WebkitClipPath:T}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",clipPath:T,WebkitClipPath:T,transform:`scale(${P}, ${L})`},children:e.jsx("img",{src:N,alt:"",style:{width:"100%",height:"100%",objectFit:z}})})]},u.id)}return e.jsx("div",{"data-widget-id":u.id,style:{...E,opacity:I,borderRadius:R,overflow:"hidden",clipPath:T,WebkitClipPath:T,border:x&&C>0&&!W?`${C}px solid ${M}`:void 0},onClick:w,children:e.jsx("img",{src:N,alt:"",style:{width:"100%",height:"100%",objectFit:z}})},u.id)}if(u.type==="video"){const{src:N="",autoplay:b=!1,loop:I=!1,muted:l=!0,objectFit:v="contain"}=u.properties;return N?e.jsx("div",{"data-widget-id":u.id,style:E,onClick:w,children:e.jsx("video",{src:N,autoPlay:b,loop:I,muted:l,style:{width:"100%",height:"100%",objectFit:v}})},u.id):null}if(u.type==="button"){const{text:N="Button",backgroundColor:b="#4a90e2",textColor:I="#ffffff",fontSize:l=16,fontFamily:v="Arial",fontWeight:x="normal",textAlign:C="center",borderRadius:M=4,borderWidth:W=0,borderColor:T="#000000",borderStyle:z="solid",paddingX:R=16,paddingY:P=8,shadowEnabled:L=!1,shadowColor:B="#000000",shadowBlur:H=10,shadowOffsetX:q=0,shadowOffsetY:_=4,shadowOpacity:G=.3}=u.properties;return e.jsx("div",{"data-widget-id":u.id,style:{...E,backgroundColor:b,color:I,fontSize:`${l}px`,fontFamily:v,fontWeight:x,borderRadius:`${M}px`,border:W>0?`${W}px ${z} ${T}`:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",userSelect:"none",boxShadow:L?`${q}px ${_}px ${H}px ${B}${Math.round(G*255).toString(16).padStart(2,"0")}`:void 0},onClick:w,children:N},u.id)}if(u.type==="menu"){const{items:N=[],orientation:b="horizontal",backgroundColor:I="#2c3e50",textColor:l="#ffffff",hoverColor:v="#34495e",fontSize:x=16,fontFamily:C="Arial",itemPadding:M=16,itemHeight:W=40,submenuBackgroundColor:T="#34495e",submenuTextColor:z="#ffffff",borderWidth:R=0,borderColor:P="#000000"}=u.properties;return e.jsx(Rt,{widgetId:u.id,commonStyle:E,items:N,isHorizontal:b==="horizontal",backgroundColor:I,textColor:l,hoverColor:v,fontSize:x,fontFamily:C,itemPadding:M,itemHeight:W,submenuBackgroundColor:T,submenuTextColor:z,borderWidth:R,borderColor:P,executeActions:S},u.id)}return null};return h?e.jsx("div",{className:"preview-page preview-loading",children:e.jsx("div",{className:"loading-spinner"})}):s||!n?e.jsx("div",{className:"preview-page preview-error",children:e.jsx("p",{children:s||"Проект не найден"})}):e.jsxs("div",{className:"preview-page",children:[e.jsx("div",{className:"preview-canvas",style:{width:n.canvas.width,height:n.canvas.height,backgroundColor:n.canvas.backgroundColor||"#ffffff",position:"relative"},children:n.widgets.slice().sort((u,f)=>(u.zIndex||0)-(f.zIndex||0)).map(u=>y(u))}),o&&p&&e.jsx("div",{className:"preview-popup-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"preview-popup",style:{width:p.width,maxHeight:p.height},onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"preview-popup-header",children:[e.jsx("h3",{children:p.title}),e.jsx("button",{onClick:()=>d(!1),children:"×"})]}),e.jsx("div",{className:"preview-popup-content",children:p.content})]})})]})},At=()=>{const[t,i]=k.useState(!1),[n,r]=k.useState(120);if(k.useEffect(()=>{const s=()=>{i(!0),r(120)},c=()=>{i(!1)},o=()=>{t&&i(!1)};window.addEventListener("auth:inactivity-warning",s),window.addEventListener("auth:logout",c);const d=["mousemove","keypress","click","scroll","touchstart"];return d.forEach(p=>{window.addEventListener(p,o)}),()=>{window.removeEventListener("auth:inactivity-warning",s),window.removeEventListener("auth:logout",c),d.forEach(p=>{window.removeEventListener(p,o)})}},[t]),k.useEffect(()=>{if(!t)return;const s=setInterval(()=>{r(c=>c<=1?(i(!1),0):c-1)},1e3);return()=>clearInterval(s)},[t]),!t)return null;const h=Math.floor(n/60),a=n%60;return e.jsx("div",{className:"inactivity-warning-overlay",children:e.jsxs("div",{className:"inactivity-warning",children:[e.jsx("div",{className:"warning-icon",children:"⏱️"}),e.jsx("h3",{children:"Сессия скоро истечёт"}),e.jsxs("p",{children:["Вы будете автоматически выведены из системы через"," ",e.jsxs("strong",{children:[h,":",a.toString().padStart(2,"0")]})]}),e.jsx("p",{className:"hint",children:"Нажмите любую клавишу или кликните мышью, чтобы продолжить работу"}),e.jsx("button",{className:"continue-btn",onClick:()=>i(!1),children:"Продолжить работу"})]})})},Lt={},we=t=>{let i;const n=new Set,r=(p,j)=>{const g=typeof p=="function"?p(i):p;if(!Object.is(g,i)){const m=i;i=j??(typeof g!="object"||g===null)?g:Object.assign({},i,g),n.forEach(S=>S(i,m))}},h=()=>i,o={setState:r,getState:h,getInitialState:()=>d,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{(Lt?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},d=i=t(r,h,o);return o},Ft=t=>t?we(t):we;var de={exports:{}},he={},pe={exports:{}},ue={};var Ne;function Dt(){if(Ne)return ue;Ne=1;var t=me();function i(j,g){return j===g&&(j!==0||1/j===1/g)||j!==j&&g!==g}var n=typeof Object.is=="function"?Object.is:i,r=t.useState,h=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function c(j,g){var m=g(),S=r({inst:{value:m,getSnapshot:g}}),y=S[0].inst,u=S[1];return a(function(){y.value=m,y.getSnapshot=g,o(y)&&u({inst:y})},[j,m,g]),h(function(){return o(y)&&u({inst:y}),j(function(){o(y)&&u({inst:y})})},[j]),s(m),m}function o(j){var g=j.getSnapshot;j=j.value;try{var m=g();return!n(j,m)}catch{return!0}}function d(j,g){return g()}var p=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:c;return ue.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:p,ue}var Ee;function $t(){return Ee||(Ee=1,pe.exports=Dt()),pe.exports}var Ie;function _t(){if(Ie)return he;Ie=1;var t=me(),i=$t();function n(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var r=typeof Object.is=="function"?Object.is:n,h=i.useSyncExternalStore,a=t.useRef,s=t.useEffect,c=t.useMemo,o=t.useDebugValue;return he.useSyncExternalStoreWithSelector=function(d,p,j,g,m){var S=a(null);if(S.current===null){var y={hasValue:!1,value:null};S.current=y}else y=S.current;S=c(function(){function f(I){if(!w){if(w=!0,E=I,I=g(I),m!==void 0&&y.hasValue){var l=y.value;if(m(l,I))return N=l}return N=I}if(l=N,r(E,I))return l;var v=g(I);return m!==void 0&&m(l,v)?(E=I,l):(E=I,N=v)}var w=!1,E,N,b=j===void 0?null:j;return[function(){return f(p())},b===null?void 0:function(){return f(b())}]},[p,j,g,m]);var u=h(d,S[0],S[1]);return s(function(){y.hasValue=!0,y.value=u},[u]),o(u),u},he}var Te;function Ot(){return Te||(Te=1,de.exports=_t()),de.exports}var Bt=Ot();const Ht=Ae(Bt),Oe={},{useDebugValue:Ut}=V,{useSyncExternalStoreWithSelector:qt}=Ht;let Pe=!1;const Vt=t=>t;function Xt(t,i=Vt,n){(Oe?"production":void 0)!=="production"&&n&&!Pe&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Pe=!0);const r=qt(t.subscribe,t.getState,t.getServerState||t.getInitialState,i,n);return Ut(r),r}const ze=t=>{(Oe?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const i=typeof t=="function"?Ft(t):t,n=(r,h)=>Xt(i,r,h);return Object.assign(n,i),n},Gt=t=>t?ze(t):ze;let te=null;function X(t,i=18e4){te&&clearTimeout(te),te=setTimeout(async()=>{try{console.log("[Editor] Auto-saving project..."),await t(),console.log("[Editor] Auto-save completed")}catch(n){console.error("[Editor] Auto-save failed:",n)}},i)}function Be(){te&&(clearTimeout(te),te=null)}function xe(t){t?(sessionStorage.setItem("kiosk_current_project_id",t),console.log("[Editor] Current project ID saved:",t)):(sessionStorage.removeItem("kiosk_current_project_id"),console.log("[Editor] Current project ID cleared"))}function Yt(){const t=sessionStorage.getItem("kiosk_current_project_id");return t&&console.log("[Editor] Restoring project ID:",t),t}const U=Gt((t,i)=>({project:{version:"1.0.0",name:"Новый проект",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,isLoading:!1,isSaving:!1,lastSaved:null,saveError:null,selectedWidgetIds:[],clipboard:[],history:{past:[],future:[]},zoom:1,gridEnabled:!0,snapToGrid:!0,gridSize:20,gridLineWidth:1,gridColor:"#e0e0e0",pendingWidget:null,restoreProject:async()=>{const n=Yt();if(n)try{return console.log("[Editor] Restoring last opened project:",n),await i().loadProject(n),!0}catch(r){return console.error("[Editor] Failed to restore project:",r),xe(null),!1}return!1},createProject:async(n,r)=>{t({isLoading:!0,saveError:null});try{const h={version:"1.0",name:n,canvas:r,widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},a=await O.createProject({name:n,canvasWidth:r.width,canvasHeight:r.height,canvasBackground:r.backgroundColor||"#1a1a1a",projectData:h});t({project:{...h,id:a.id},projectId:a.id,isLoading:!1,lastSaved:new Date,history:{past:[],future:[]}}),console.log("[Editor] Project created:",a.id),xe(a.id),X(i().saveProject)}catch(h){throw console.error("[Editor] Failed to create project:",h),t({isLoading:!1,saveError:h.message||"Failed to create project"}),h}},loadProject:async n=>{t({isLoading:!0,saveError:null});try{const r=await O.getProject(n),h={id:r.id,version:"1.0",name:r.name,canvas:{width:r.canvasWidth,height:r.canvasHeight,backgroundColor:r.canvasBackground},widgets:r.projectData?.widgets||[],metadata:{createdAt:r.createdAt,updatedAt:r.updatedAt}};t({project:h,projectId:r.id,isLoading:!1,lastSaved:new Date(r.updatedAt),history:{past:[],future:[]}}),console.log("[Editor] Project loaded:",n),xe(n),X(i().saveProject)}catch(r){throw console.error("[Editor] Failed to load project:",r),t({isLoading:!1,saveError:r.message||"Failed to load project"}),r}},saveProject:async()=>{const{project:n,projectId:r,isSaving:h}=i();if(!n||!r){console.warn("[Editor] No project to save");return}if(h){console.warn("[Editor] Save already in progress");return}t({isSaving:!0,saveError:null});try{await O.updateProject(r,{name:n.name,projectData:n,canvasWidth:n.canvas.width,canvasHeight:n.canvas.height,canvasBackground:n.canvas.backgroundColor}),t({isSaving:!1,lastSaved:new Date,saveError:null}),console.log("[Editor] Project saved:",r)}catch(a){throw console.error("[Editor] Failed to save project:",a),t({isSaving:!1,saveError:a.message||"Failed to save project"}),a}},deleteProject:async n=>{try{await O.deleteProject(n),i().projectId===n&&(t({project:{version:"1.0.0",name:"Новый проект",canvas:{width:1920,height:1080,backgroundColor:"#1a1a1a"},widgets:[],metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},projectId:null,selectedWidgetIds:[],history:{past:[],future:[]}}),Be()),console.log("[Editor] Project deleted:",n)}catch(r){throw console.error("[Editor] Failed to delete project:",r),r}},savePreviewSnapshot:async()=>{const{project:n}=i();if(!n)throw new Error("No project to preview");console.log("[Editor] Creating preview snapshot...");try{const r=i()._lastPreviewSnapshotId;r&&(console.log("[Editor] Deleting previous snapshot:",r),O.deleteProject(r).catch(s=>{console.warn("[Editor] Failed to delete previous snapshot:",s.message)}));const h=`_preview_${n.name}_${Date.now()}`,a=await O.createProject({name:h,canvasWidth:n.canvas.width,canvasHeight:n.canvas.height,canvasBackground:n.canvas.backgroundColor||"#1a1a1a",projectData:n});return t({_lastPreviewSnapshotId:a.id}),console.log("[Editor] Preview snapshot created:",a.id),a.id}catch(r){throw console.error("[Editor] Failed to create preview snapshot:",r),r}},updateProjectMetadata:n=>{const{project:r}=i();r&&(t({project:{...r,...n,metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),X(i().saveProject))},addWidget:n=>{const{project:r}=i();r&&(i().saveToHistory(),t({project:{...r,widgets:[...r.widgets,n],metadata:{...r.metadata,updatedAt:new Date().toISOString()}}}),X(i().saveProject))},setPendingWidget:(n,r)=>{t({pendingWidget:{type:n,defaultProps:r}})},clearPendingWidget:()=>{t({pendingWidget:null})},addWidgetAtPosition:(n,r)=>{const{pendingWidget:h,project:a,snapToGrid:s,gridSize:c}=i();if(!h||!a)return;let o=n,d=r;s&&(o=Math.round(n/c)*c,d=Math.round(r/c)*c);const j={shape:{width:200,height:200},button:{width:200,height:60},text:{width:300,height:100},image:{width:300,height:200},video:{width:640,height:360},menu:{width:600,height:40}}[h.type]||{width:200,height:100},g=h.defaultProps.width||j.width,m=h.defaultProps.height||j.height;o=o-g/2,d=d-m/2;const{width:S,height:y,...u}=h.defaultProps,f={id:`widget-${Date.now()}-${Math.random()}`,type:h.type,x:Math.max(0,o),y:Math.max(0,d),width:g,height:m,zIndex:0,properties:u};i().addWidget(f),i().clearPendingWidget()},updateWidget:(n,r)=>{const{project:h}=i();h&&(t({project:{...h,widgets:h.widgets.map(a=>a.id===n?{...a,...r}:a),metadata:{...h.metadata,updatedAt:new Date().toISOString()}}}),X(i().saveProject))},deleteWidget:n=>{const{project:r}=i();r&&(i().saveToHistory(),t({project:{...r,widgets:r.widgets.filter(h=>h.id!==n),metadata:{...r.metadata,updatedAt:new Date().toISOString()}},selectedWidgetIds:i().selectedWidgetIds.filter(h=>h!==n)}),X(i().saveProject))},duplicateWidget:n=>{const{project:r}=i();if(!r)return;const h=r.widgets.find(s=>s.id===n);if(!h)return;const a={...h,id:`widget-${Date.now()}`,x:h.x+20,y:h.y+20};i().addWidget(a)},selectWidget:(n,r=!1)=>{const{selectedWidgetIds:h}=i();r?h.includes(n)?t({selectedWidgetIds:h.filter(a=>a!==n)}):t({selectedWidgetIds:[...h,n]}):t({selectedWidgetIds:[n]})},clearSelection:()=>{t({selectedWidgetIds:[]})},saveToHistory:()=>{const{project:n,history:r}=i();n&&t({history:{past:[...r.past,n],future:[]}})},undo:()=>{const{history:n,project:r}=i();if(n.past.length===0||!r)return;const h=n.past[n.past.length-1],a=n.past.slice(0,-1);t({project:h,history:{past:a,future:[r,...n.future]}}),X(i().saveProject)},redo:()=>{const{history:n,project:r}=i();if(n.future.length===0||!r)return;const h=n.future[0],a=n.future.slice(1);t({project:h,history:{past:[...n.past,r],future:a}}),X(i().saveProject)},copy:()=>{const{project:n,selectedWidgetIds:r}=i();if(!n)return;const h=n.widgets.filter(a=>r.includes(a.id));t({clipboard:h})},paste:()=>{const{clipboard:n,project:r}=i();if(!r||n.length===0)return;const h=n.map(a=>({...a,id:`widget-${Date.now()}-${Math.random()}`,x:a.x+20,y:a.y+20}));i().saveToHistory(),t({project:{...r,widgets:[...r.widgets,...h]},selectedWidgetIds:h.map(a=>a.id)}),X(i().saveProject)},cut:()=>{const{selectedWidgetIds:n}=i();i().copy(),n.forEach(r=>i().deleteWidget(r))},setZoom:n=>{t({zoom:Math.max(.1,Math.min(5,n))})},toggleGrid:()=>{t(n=>({gridEnabled:!n.gridEnabled}))},toggleSnapToGrid:()=>{t(n=>({snapToGrid:!n.snapToGrid}))},setGridSize:n=>{t({gridSize:Math.max(5,Math.min(100,n))})}}));typeof window<"u"&&window.addEventListener("beforeunload",()=>{Be()});const Kt=()=>{const{isSaving:t,lastSaved:i,saveError:n}=U(),h=n?"error":t?"saving":i?"saved":"idle",a=c=>{const d=new Date().getTime()-c.getTime(),p=Math.floor(d/1e3),j=Math.floor(p/60);return p<10?"Только что":p<60?`${p} сек назад`:j===1?"1 мин назад":j<60?`${j} мин назад`:c.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})},s=()=>{switch(h){case"saving":return e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:16,className:"spinner"}),e.jsx("span",{children:"Сохранение..."})]});case"saved":return e.jsxs(e.Fragment,{children:[e.jsx(at,{size:16}),e.jsxs("span",{children:["Сохранено ",i&&a(i)]})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(je,{size:16}),e.jsx("span",{title:n||void 0,children:"Ошибка сохранения"})]});default:return e.jsxs(e.Fragment,{children:[e.jsx(lt,{size:16}),e.jsx("span",{children:"Не сохранено"})]})}};return e.jsx("div",{className:`autosave-indicator status-${h}`,children:s()})},Jt=({onClose:t,onSuccess:i})=>{const[n,r]=k.useState(""),[h,a]=k.useState(""),[s,c]=k.useState(1920),[o,d]=k.useState(1080),[p,j]=k.useState(!1),{createProject:g}=U(),m=async y=>{if(y.preventDefault(),!n.trim()){alert("Введите название проекта");return}try{j(!0),console.log("[CreateProjectDialog] Creating project:",n),await g(n.trim(),{width:s,height:o,backgroundColor:"#ffffff"}),console.log("[CreateProjectDialog] Project created successfully"),i?.(),t()}catch(u){console.error("[CreateProjectDialog] Failed to create project:",u),alert("Не удалось создать проект")}finally{j(!1)}},S=[{name:"Full HD (горизонтально)",width:1920,height:1080},{name:"Full HD (вертикально)",width:1080,height:1920},{name:"4K (горизонтально)",width:3840,height:2160},{name:"HD (горизонтально)",width:1280,height:720}];return e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content create-project-dialog",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"Создать новый проект"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"Закрыть",children:e.jsx(_e,{size:24})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"dialog-body",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-name",children:"Название проекта *"}),e.jsx("input",{id:"project-name",type:"text",value:n,onChange:y=>r(y.target.value),placeholder:"Мой проект",maxLength:100,autoFocus:!0})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"project-description",children:"Описание (необязательно)"}),e.jsx("textarea",{id:"project-description",value:h,onChange:y=>a(y.target.value),placeholder:"Краткое описание проекта...",maxLength:500,rows:3})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Размер холста"}),e.jsx("div",{className:"presets-grid",children:S.map((y,u)=>e.jsxs("button",{type:"button",className:`preset-btn ${s===y.width&&o===y.height?"active":""}`,onClick:()=>{c(y.width),d(y.height)},children:[e.jsx("span",{className:"preset-name",children:y.name}),e.jsxs("span",{className:"preset-size",children:[y.width,"×",y.height]})]},u))}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-width",children:"Ширина (px)"}),e.jsx("input",{id:"canvas-width",type:"number",value:s,onChange:y=>c(parseInt(y.target.value)||1920),min:320,max:7680})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"canvas-height",children:"Высота (px)"}),e.jsx("input",{id:"canvas-height",type:"number",value:o,onChange:y=>d(parseInt(y.target.value)||1080),min:240,max:4320})]})]})]})]}),e.jsxs("div",{className:"dialog-footer",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:t,children:"Отмена"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p,children:p?"Создание...":"Создать проект"})]})]})]})})},Zt=({onClose:t,onProjectLoaded:i})=>{const[n,r]=k.useState([]),[h,a]=k.useState(!0),[s,c]=k.useState(""),[o,d]=k.useState(!1),{loadProject:p,projectId:j}=U();k.useEffect(()=>{g()},[]);const g=async()=>{try{a(!0);const f=await O.getProjects();console.log("[ProjectsDialog] Projects loaded:",f.projects.length),r(f.projects)}catch(f){console.error("[ProjectsDialog] Failed to load projects:",f),alert("Не удалось загрузить список проектов")}finally{a(!1)}},m=async f=>{try{console.log("[ProjectsDialog] Opening project:",f),await p(f),i?.(),t()}catch(w){console.error("[ProjectsDialog] Failed to open project:",w),alert("Не удалось открыть проект")}},S=async(f,w)=>{if(confirm(`Вы уверены что хотите удалить проект "${w}"?`))try{console.log("[ProjectsDialog] Deleting project:",f),await O.deleteProject(f),r(n.filter(E=>E.id!==f)),alert("Проект удалён")}catch(E){console.error("[ProjectsDialog] Failed to delete project:",E),alert("Не удалось удалить проект")}},y=()=>{d(!1),g()},u=n.filter(f=>f.name.toLowerCase().includes(s.toLowerCase())||f.description?.toLowerCase().includes(s.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dialog-overlay",onClick:t,children:e.jsxs("div",{className:"dialog-content projects-dialog",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"dialog-header",children:[e.jsx("h2",{children:"Мои проекты"}),e.jsxs("div",{className:"header-actions",children:[j&&e.jsx("button",{className:"btn-back-to-project",onClick:t,title:"Вернуться к текущему проекту",children:"← Вернуться к проекту"}),e.jsx("button",{className:"btn-icon",onClick:t,title:"Закрыть",children:e.jsx(_e,{size:24})})]})]}),e.jsxs("div",{className:"projects-toolbar",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(bt,{size:18}),e.jsx("input",{type:"text",placeholder:"Поиск проектов...",value:s,onChange:f=>c(f.target.value)})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>d(!0),children:[e.jsx(jt,{size:18}),e.jsx("span",{children:"Создать проект"})]})]}),e.jsx("div",{className:"projects-list",children:h?e.jsx("div",{className:"loading-state",children:e.jsx("p",{children:"Загрузка проектов..."})}):u.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(le,{size:48}),e.jsx("p",{children:s?"Проекты не найдены":"У вас пока нет проектов"}),e.jsx("button",{className:"btn-primary",onClick:()=>d(!0),children:"Создать первый проект"})]}):u.map(f=>e.jsxs("div",{className:`project-card ${f.id===j?"active":""}`,children:[e.jsx("div",{className:"project-thumbnail",children:f.thumbnail?e.jsx("img",{src:f.thumbnail,alt:f.name}):e.jsx("div",{className:"thumbnail-placeholder",children:e.jsx(le,{size:32})})}),e.jsxs("div",{className:"project-info",children:[e.jsx("h3",{children:f.name}),f.description&&e.jsx("p",{className:"project-description",children:f.description}),e.jsxs("div",{className:"project-meta",children:[e.jsxs("span",{children:[f.canvasWidth,"×",f.canvasHeight]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(f.updatedAt).toLocaleDateString("ru-RU")})]}),f.tags&&f.tags.length>0&&e.jsx("div",{className:"project-tags",children:f.tags.map((w,E)=>e.jsx("span",{className:"tag",children:w},E))})]}),e.jsxs("div",{className:"project-actions",children:[e.jsxs("button",{className:"btn-primary",onClick:()=>m(f.id),title:"Открыть проект",children:[e.jsx(le,{size:18}),e.jsx("span",{children:"Открыть"})]}),e.jsx("button",{className:"btn-icon btn-danger",onClick:()=>S(f.id,f.name),title:"Удалить проект",children:e.jsx($e,{size:18})})]})]},f.id))}),e.jsx("div",{className:"dialog-footer",children:e.jsxs("p",{className:"projects-count",children:["Всего проектов: ",n.length]})})]})}),o&&e.jsx(Jt,{onClose:()=>d(!1),onSuccess:y})]})},Qt=({onClose:t})=>{const{project:i}=U(),[n,r]=k.useState(i?.name||"Kiosk Player"),[h,a]=k.useState(null),[s,c]=k.useState(null),[o,d]=k.useState(!1),[p,j]=k.useState(null),[g,m]=k.useState(null),S=k.useRef(null);if(k.useEffect(()=>()=>{g&&clearInterval(g)},[g]),!i)return null;const y=b=>{const I=b.target.files?.[0];if(I){a(I);const l=new FileReader;l.onload=v=>c(v.target?.result),l.readAsDataURL(I)}},u=async()=>{d(!0),j(null);try{const b=new FormData;b.append("project",JSON.stringify(i)),b.append("appName",n),b.append("appId","com.kiosk.player"),h&&b.append("icon",h);const I=O.getBaseUrl(),v=await(await fetch(`${I}/api/builds`,{method:"POST",body:b})).json();if(!v.success)throw new Error(v.error||"Ошибка запуска сборки");const x=v.data.build_id,C=setInterval(async()=>{try{const W=await(await fetch(`${I}/api/builds/${x}`)).json();W.success&&(j(W.data),(W.data.status==="completed"||W.data.status==="failed")&&(clearInterval(C),d(!1)))}catch(M){console.error("Poll error:",M)}},2e3);m(C),j({id:x,status:"queued",progress:0,message:"Запуск сборки..."})}catch(b){console.error("Build error:",b),j({id:"",status:"failed",progress:0,message:b.message,error:b.message}),d(!1)}},f=()=>{if(p?.download_url){const b=O.getBaseUrl();window.open(`${b}${p.download_url}`,"_blank")}},w=p?.status==="completed",E=p?.status==="failed",N=o&&!w&&!E;return e.jsx("div",{className:"build-dialog-overlay",onClick:N?void 0:t,children:e.jsxs("div",{className:"build-dialog",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"build-dialog-header",children:[e.jsxs("h2",{children:[e.jsx(ge,{size:20})," Сборка плеера Windows"]}),!N&&e.jsx("button",{className:"build-dialog-close",onClick:t,children:"×"})]}),e.jsxs("div",{className:"build-dialog-body",children:[e.jsxs("div",{className:"build-project-info",children:[e.jsx("h4",{children:"Проект"}),e.jsxs("div",{className:"build-project-info-grid",children:[e.jsxs("div",{children:["Название: ",e.jsx("span",{children:i.name})]}),e.jsxs("div",{children:["Виджетов: ",e.jsx("span",{children:i.widgets.length})]}),e.jsxs("div",{children:["Размер: ",e.jsxs("span",{children:[i.canvas.width,"×",i.canvas.height]})]})]})]}),!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"build-form-group",children:[e.jsx("label",{children:"Имя приложения"}),e.jsx("input",{type:"text",value:n,onChange:b=>r(b.target.value),placeholder:"Kiosk Player"})]}),e.jsxs("div",{className:"build-form-group",children:[e.jsx("label",{children:"Иконка приложения (.ico)"}),e.jsxs("div",{className:"build-icon-upload",children:[e.jsx("button",{className:"build-icon-btn",onClick:()=>S.current?.click(),children:h?"Изменить":"Выбрать .ico файл"}),s&&e.jsx("div",{className:"build-icon-preview",children:e.jsx("img",{src:s,alt:"icon"})}),h&&e.jsx("span",{className:"build-icon-name",children:h.name}),e.jsx("input",{ref:S,type:"file",accept:".ico",onChange:y,style:{display:"none"}})]})]})]}),p&&e.jsxs("div",{className:"build-progress-section",children:[N&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"build-progress-percent",children:[p.progress,"%"]}),e.jsx("div",{className:"build-progress-bar-bg",children:e.jsx("div",{className:"build-progress-bar-fill",style:{width:`${p.progress}%`}})}),e.jsxs("div",{className:"build-progress-status",children:[e.jsx(ve,{size:14,style:{display:"inline",marginRight:6,animation:"spin 1s linear infinite"}}),p.message]})]}),w&&e.jsxs("div",{className:"build-result",children:[e.jsx(ot,{size:48,color:"#48bb78"}),e.jsx("div",{className:"build-result-success",children:"Установщик готов!"}),e.jsxs("div",{className:"build-result-info",children:[p.file_name,e.jsx("br",{}),"Размер: ",p.file_size]})]}),E&&e.jsxs("div",{className:"build-result",children:[e.jsx(je,{size:48,color:"#f56565"}),e.jsx("div",{className:"build-result-error",children:p.error||p.message})]})]})]}),e.jsxs("div",{className:"build-dialog-footer",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Отмена"}),e.jsxs("button",{className:"build-btn build-btn-primary",onClick:u,disabled:!n.trim(),children:[e.jsx(ge,{size:16})," Собрать .exe"]})]}),N&&e.jsx("button",{className:"build-btn build-btn-secondary",disabled:!0,children:"Сборка... ~2 мин"}),w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Закрыть"}),e.jsxs("button",{className:"build-btn build-btn-success",onClick:f,children:[e.jsx(ct,{size:16})," Скачать .exe"]})]}),E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"build-btn build-btn-secondary",onClick:t,children:"Закрыть"}),e.jsx("button",{className:"build-btn build-btn-primary",onClick:()=>{j(null),d(!1)},children:"Попробовать снова"})]})]})]})})},er=()=>{const{project:t,history:i,zoom:n,gridEnabled:r,snapToGrid:h,undo:a,redo:s,setZoom:c,toggleGrid:o,toggleSnapToGrid:d,saveProject:p}=U(),{project:j,savePreviewSnapshot:g}=U(),[m,S]=V.useState(!1),[y,u]=k.useState(null),[f,w]=k.useState(null),[E,N]=k.useState(!1),[b,I]=k.useState(!1);k.useEffect(()=>{const T=O.getOrganizationData();u(T.name),w(T.plan)},[]);const l=()=>{c(Math.min(n+.1,3))},v=()=>{c(Math.max(n-.1,.1))},x=()=>{confirm("Вы уверены что хотите выйти?")&&(D.info("User initiated logout"),O.logout(),window.location.href="/login")},C=async()=>{if(!(j||t)){alert("Нет открытого проекта для предпросмотра");return}S(!0);try{console.log("[Toolbar] Starting preview...");const z=await g();window.open(`/preview?projectId=${z}`,"_blank"),console.log("[Toolbar] Preview opened")}catch(z){console.error("[Toolbar] Error:",z),alert(`Ошибка: ${z.message}`)}finally{S(!1)}},M=i.past.length>0,W=i.future.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolbar",children:[e.jsxs("div",{className:"toolbar-section",children:[e.jsx("div",{className:"toolbar-logo",children:e.jsx("span",{className:"logo-text",children:"Kiosk Editor"})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:()=>p(),disabled:!t,title:"Сохранить (Ctrl+S)",children:e.jsx(yt,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:()=>N(!0),disabled:!t,title:"Мои проекты",children:e.jsx(le,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:a,disabled:!M,title:"Отменить (Ctrl+Z)",children:e.jsx(Ct,{size:18})}),e.jsx("button",{className:"toolbar-btn",onClick:s,disabled:!W,title:"Вернуть (Ctrl+Shift+Z)",children:e.jsx(vt,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:v,disabled:n<=.1,title:"Уменьшить (Ctrl+-)",children:e.jsx(Tt,{size:18})}),e.jsxs("span",{className:"toolbar-zoom",children:[Math.round(n*100),"%"]}),e.jsx("button",{className:"toolbar-btn",onClick:l,disabled:n>=3,title:"Увеличить (Ctrl++)",children:e.jsx(It,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-btn ${r?"active":""}`,onClick:o,title:"Показать сетку",children:e.jsx(dt,{size:18})}),e.jsx("button",{className:`toolbar-btn ${h?"active":""}`,onClick:d,title:"Привязка к сетке",children:e.jsx(xt,{size:18})})]}),e.jsxs("div",{className:"toolbar-section",children:[t&&e.jsx(Kt,{}),e.jsx("div",{className:"toolbar-divider"}),y&&e.jsxs("div",{className:"toolbar-user-info",children:[e.jsx(Nt,{size:16}),e.jsx("span",{className:"user-org",children:y}),f&&e.jsx("span",{className:"user-plan",children:f})]}),e.jsx("button",{className:"toolbar-btn logout-btn",onClick:x,title:"Выйти",children:e.jsx(ut,{size:18})}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",disabled:!t,onClick:()=>I(!0),title:"Собрать плеер Windows",children:e.jsx(ge,{size:18})}),e.jsxs("button",{className:"toolbar-btn preview-btn",disabled:!t||m,onClick:C,title:"Предпросмотр",children:[e.jsx(mt,{size:18}),e.jsx("span",{children:m?"Загрузка...":"Предпросмотр"})]})]})]}),E&&e.jsx(Zt,{onClose:()=>N(!1)}),b&&e.jsx(Qt,{onClose:()=>I(!1)})]})},He=({widget:t,image:i})=>{const n=k.useRef(null),{clipShape:r="rectangle",cornerRadius:h=0,opacity:a=1}=t.properties;return k.useEffect(()=>{if(!n.current||!i)return;const s=n.current,c=document.createElement("canvas"),o=c.getContext("2d");if(!o)return;c.width=t.width,c.height=t.height,o.clearRect(0,0,c.width,c.height),o.save();const d=t.width,p=t.height,j=d/2,g=p/2,m=Math.min(d,p)/2;(()=>{const C=(M,W=-Math.PI/2)=>{o.beginPath();for(let T=0;T<M;T++){const z=W+2*Math.PI*T/M,R=j+m*Math.cos(z),P=g+m*Math.sin(z);T===0?o.moveTo(R,P):o.lineTo(R,P)}o.closePath()};switch(r){case"circle":o.beginPath(),o.arc(j,g,m,0,Math.PI*2),o.closePath();break;case"ellipse":o.beginPath(),o.ellipse(j,g,d/2,p/2,0,0,Math.PI*2),o.closePath();break;case"triangle":{const M=[-Math.PI/2,Math.PI/6,5*Math.PI/6];o.beginPath(),M.forEach((W,T)=>{const z=j+m*Math.cos(W),R=g+m*Math.sin(W);T===0?o.moveTo(z,R):o.lineTo(z,R)}),o.closePath();break}case"diamond":o.beginPath(),o.moveTo(j,0),o.lineTo(d,g),o.lineTo(j,p),o.lineTo(0,g),o.closePath();break;case"pentagon":C(5);break;case"hexagon":C(6);break;case"octagon":C(8);break;case"star":{o.beginPath();for(let M=0;M<10;M++){const W=M*Math.PI/5-Math.PI/2,T=M%2===0?m:m*.5,z=j+T*Math.cos(W),R=g+T*Math.sin(W);M===0?o.moveTo(z,R):o.lineTo(z,R)}o.closePath();break}case"rounded-rectangle":tr(o,0,0,d,p,h);break;default:o.rect(0,0,d,p);break}})(),o.clip();const y=i.width/i.height,u=d/p;let f=0,w=0,E=i.width,N=i.height,b=0,I=0,l=d,v=p;y>u?(E=i.height*u,f=(i.width-E)/2):(N=i.width/u,w=(i.height-N)/2),o.drawImage(i,f,w,E,N,b,I,l,v),o.restore();const x=new window.Image;x.src=c.toDataURL(),x.onload=()=>{s&&(s.image(x),s.getLayer()?.batchDraw())}},[i,t.width,t.height,r,h]),i?e.jsx(ne,{ref:n,image:void 0,width:t.width,height:t.height,opacity:a,listening:!1}):null};function tr(t,i,n,r,h,a){t.beginPath(),t.moveTo(i+a,n),t.lineTo(i+r-a,n),t.quadraticCurveTo(i+r,n,i+r,n+a),t.lineTo(i+r,n+h-a),t.quadraticCurveTo(i+r,n+h,i+r-a,n+h),t.lineTo(i+a,n+h),t.quadraticCurveTo(i,n+h,i,n+h-a),t.lineTo(i,n+a),t.quadraticCurveTo(i,n,i+a,n),t.closePath()}const rr=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),[c,o]=k.useState({}),[d,p]=k.useState(0),[j,g]=k.useState(!1),m=k.useRef(),{sources:S=[],autoSwitch:y=!1,switchInterval:u=3,transition:f="fade",clipShape:w="rectangle",loop:E=!0}=t.properties;k.useEffect(()=>{const l={};let v=0;return S.forEach(x=>{const C=new window.Image;C.crossOrigin="anonymous",C.onload=()=>{l[x.id]=C,v++,v===S.length&&o({...l})},C.onerror=()=>{console.error("Failed to load image:",x.value),v++,v===S.length&&o({...l})},C.src=x.value}),()=>{Object.values(l).forEach(x=>{x.onload=null,x.onerror=null})}},[S]),k.useEffect(()=>{if(!y||S.length<=1){m.current&&clearInterval(m.current);return}return m.current=setInterval(()=>{p(l=>{const v=l+1;return v>=S.length?E?0:l:v})},u*1e3),()=>{m.current&&clearInterval(m.current)}},[y,u,S.length,E]);const N=t.locked||!1,b=S[d],I=b?c[b.id]:null;return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!N,dragBoundFunc:a,opacity:N?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),(!I||S.length===0)&&e.jsx(A,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),I&&(w&&w!=="rectangle"?e.jsx(He,{widget:t,image:I}):e.jsx(ne,{image:I,x:0,y:0,width:t.width,height:t.height,listening:!1})),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),S.length>1&&e.jsx(A,{x:t.width-40,y:t.height-20,width:35,height:15,fill:"rgba(0, 0, 0, 0.7)",cornerRadius:3,listening:!1}),S.length>1&&e.jsx(ne,{x:t.width-35,y:t.height-18,width:10,height:10,image:(()=>{const l=document.createElement("canvas");l.width=10,l.height=10;const v=l.getContext("2d");v&&(v.fillStyle="#fff",v.font="10px Arial",v.fillText("📷",0,9));const x=new window.Image;return x.src=l.toDataURL(),x})(),listening:!1})]})},sr=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{if(t.properties.galleryMode)return e.jsx(rr,{widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a});const[s,c]=k.useState(null),o=k.useRef(null),{clipShape:d="rectangle"}=t.properties;k.useEffect(()=>{if(!t.properties.src){c(null);return}const b=new window.Image;return b.crossOrigin="anonymous",b.onload=()=>{c(b)},b.onerror=()=>{console.error("Failed to load image:",t.properties.src),c(null)},b.src=t.properties.src,()=>{b.onload=null,b.onerror=null}},[t.properties.src]),k.useEffect(()=>{if(!s||t.properties.objectFit!=="adaptive")return;const{updateWidget:b}=U.getState(),I=s.width/s.height,l=t.width/t.height;if(Math.abs(I-l)>.01){const v=t.width/I;b(t.id,{height:Math.round(v)})}},[s,t.properties.objectFit,t.width,t.height,t.id]);const j=(()=>{if(!s)return null;const{width:b,height:I}=t,{objectFit:l="contain"}=t.properties,v=s.width/s.height,x=b/I;let C=0,M=0,W=s.width,T=s.height;switch(l){case"cover":{v>x?(W=s.height*x,C=(s.width-W)/2):(T=s.width/x,M=(s.height-T)/2);break}case"contain":break;case"fill":break;case"scale-down":{s.width<=b&&s.height<=I&&(W=s.width,T=s.height);break}}return{cropX:C,cropY:M,cropWidth:W,cropHeight:T}})(),{borderEnabled:g,borderStyle:m,borderWidth:S=2,borderColor:y="#000000"}=t.properties,u=b=>{switch(b){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},f=b=>{o.current&&h(b)},w=t.locked||!1,E=(b,I,l)=>{const v=I/2,x=l/2,C=Math.min(I,l)/2,M=(W,T=-Math.PI/2)=>{const z=[];for(let R=0;R<W;R++){const P=T+2*Math.PI*R/W;z.push(v+C*Math.cos(P)),z.push(x+C*Math.sin(P))}return z};switch(b){case"triangle":{const W=[-Math.PI/2,Math.PI/6,5*Math.PI/6],T=[];return W.forEach(z=>{T.push(v+C*Math.cos(z)),T.push(x+C*Math.sin(z))}),T}case"diamond":return[v,0,I,x,v,l,0,x];case"pentagon":return M(5);case"hexagon":return M(6);case"octagon":return M(8);case"star":{const W=[];for(let T=0;T<10;T++){const z=T*Math.PI/5-Math.PI/2,R=T%2===0?C:C*.5;W.push(v+R*Math.cos(z)),W.push(x+R*Math.sin(z))}return W}default:return null}},N=()=>{if(!g)return null;const b={stroke:y,strokeWidth:S,dash:u(m),fill:void 0,listening:!1},I=d||"rectangle",l=t.width,v=t.height,x=Math.min(l,v)/2,C=l/2,M=v/2,W=E(I,l,v);if(W)return e.jsx(ee,{points:W,closed:!0,stroke:y,strokeWidth:S,dash:u(m),listening:!1});switch(I){case"circle":return e.jsx(De,{x:C,y:M,radius:x,...b});case"ellipse":return e.jsx(Fe,{x:C,y:M,radiusX:l/2,radiusY:v/2,...b});case"rounded-rectangle":return e.jsx(A,{width:l,height:v,cornerRadius:t.properties.cornerRadius||20,...b});default:return e.jsx(A,{width:l,height:v,...b})}};return e.jsxs(K,{ref:o,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!w,dragBoundFunc:a,opacity:w?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:f,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),!s&&e.jsx(A,{width:t.width,height:t.height,fill:"#9b59b6",listening:!1}),s&&(d&&d!=="rectangle"?e.jsx(He,{widget:t,image:s}):j&&e.jsx(ne,{image:s,x:0,y:0,width:t.width,height:t.height,crop:{x:j.cropX,y:j.cropY,width:j.cropWidth,height:j.cropHeight},listening:!1})),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),N()]})},nr=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),c=k.useRef(null),{text:o="Button",backgroundColor:d="#2ecc71",textColor:p="#ffffff",fontSize:j=16,fontFamily:g="Arial",fontWeight:m="normal",fontStyle:S="normal",textAlign:y="center",borderRadius:u=8,borderWidth:f=0,borderColor:w="#000000",borderStyle:E="solid",paddingX:N=16,paddingY:b=8,shadowEnabled:I=!1,shadowColor:l="#000000",shadowBlur:v=10,shadowOffsetX:x=0,shadowOffsetY:C=4,shadowOpacity:M=.3}=t.properties,W=t.locked||!1,T=()=>{switch(E){case"dashed":return[10,5];case"dotted":return[3,3];default:return[]}};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!W,dragBoundFunc:a,opacity:W?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[I&&e.jsx(A,{x,y:C,width:t.width,height:t.height,cornerRadius:u,fill:l,opacity:M,blur:v,listening:!1}),e.jsx(A,{width:t.width,height:t.height,fill:d,cornerRadius:u,stroke:f>0?w:void 0,strokeWidth:f,dash:T(),listening:!1}),e.jsx($,{ref:c,text:o,x:N,y:0,width:t.width-N*2,height:t.height,fontSize:j,fontFamily:g,fontStyle:m==="bold"?"bold":S,fill:p,align:y,verticalAlign:"middle",listening:!1}),e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,cornerRadius:u,listening:!1})]})},ir=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),{text:c="Text",fontSize:o=16,fontFamily:d="Arial",fontWeight:p="normal",fontStyle:j="normal",textAlign:g="left",verticalAlign:m="top",textColor:S="#000000",backgroundColor:y="#ffffff",lineHeight:u=1.2,padding:f=8,textDecoration:w="none"}=t.properties,E=t.locked||!1,N=()=>w==="underline"?"underline":w==="line-through"?"line-through":"";return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!E,dragBoundFunc:a,opacity:E?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[y!=="transparent"&&e.jsx(A,{width:t.width,height:t.height,fill:y,listening:!1}),e.jsx($,{text:c,x:f,y:f,width:t.width-f*2,height:t.height-f*2,fontSize:o,fontFamily:d,fontStyle:p==="bold"?"bold":j,fill:S,align:g,verticalAlign:m,lineHeight:u,textDecoration:N(),listening:!1}),e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},or=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),[c,o]=k.useState(0),{sources:d=[],autoNext:p=!0,loop:j=!0}=t.properties,g=t.locked||!1;return d[c],e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!g,dragBoundFunc:a,opacity:g?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(A,{width:t.width,height:t.height,fill:"#000000",listening:!1}),e.jsx($,{x:t.width/2,y:t.height/2-30,text:"▶",fontSize:60,fill:"#ffffff",align:"center",width:t.width,offsetX:t.width/2,listening:!1}),e.jsx($,{x:0,y:t.height/2+40,text:"PLAYLIST",fontSize:16,fill:"#ffffff",align:"center",width:t.width,listening:!1}),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(A,{x:t.width-50,y:t.height-25,width:45,height:20,fill:"rgba(0, 0, 0, 0.8)",cornerRadius:4,listening:!1}),e.jsx($,{x:t.width-48,y:t.height-21,text:`🎬 ${d.length}`,fontSize:12,fill:"#ffffff",listening:!1})]})]})},ar=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{if(t.properties.playlistMode)return e.jsx(or,{widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a});const s=k.useRef(null),c=k.useRef(null),[o,d]=k.useState(null),p=k.useRef(),{sourceType:j="url",src:g="",rtspUrl:m="",isLocalFile:S=!1,fileName:y="",objectFit:u="contain",borderEnabled:f=!1,borderStyle:w="solid",borderWidth:E=2,borderColor:N="#000000",autoplay:b=!1,loop:I=!1,muted:l=!0,controls:v=!1}=t.properties;k.useEffect(()=>{const P=document.createElement("video");return P.crossOrigin="anonymous",P.loop=I,P.muted=l,P.playsInline=!0,j==="url"&&g?(P.src=g,P.onloadedmetadata=()=>{d(P),b&&P.play().catch(L=>{console.log("Autoplay prevented:",L)})},P.onerror=()=>{console.error("Failed to load video:",g),d(null)}):d(null),c.current=P,()=>{p.current&&cancelAnimationFrame(p.current),P.pause(),P.src="",P.load()}},[g,j,b,I,l]),k.useEffect(()=>{if(!o)return;const P=()=>{const L=s.current?.getLayer();L&&L.batchDraw(),p.current=requestAnimationFrame(P)};return p.current=requestAnimationFrame(P),()=>{p.current&&cancelAnimationFrame(p.current)}},[o]),k.useEffect(()=>{if(u!=="adaptive"||!o)return;const{updateWidget:P}=U.getState(),L=o.videoWidth/o.videoHeight||16/9,B=t.width/t.height;if(Math.abs(L-B)>.01){const H=t.width/L;P(t.id,{height:Math.round(H)})}},[u,o,t.width,t.height,t.id]);const C=(()=>{if(!o||o.videoWidth===0)return null;const{width:P,height:L}=t,B=o.videoWidth/o.videoHeight,H=P/L;let q=0,_=0,G=o.videoWidth,Y=o.videoHeight,J=0,ie=0,Z=P,Q=L;switch(u){case"cover":{B>H?(G=o.videoHeight*H,q=(o.videoWidth-G)/2):(Y=o.videoWidth/H,_=(o.videoHeight-Y)/2);break}case"contain":{B>H?(Q=P/B,ie=(L-Q)/2):(Z=L*B,J=(P-Z)/2);break}case"scale-down":{o.videoWidth<=P&&o.videoHeight<=L?(Z=o.videoWidth,Q=o.videoHeight,J=(P-Z)/2,ie=(L-Q)/2):B>H?(Q=P/B,ie=(L-Q)/2):(Z=L*B,J=(P-Z)/2);break}}return{crop:{x:q,y:_,width:G,height:Y},position:{x:J,y:ie,width:Z,height:Q}}})(),M=P=>{switch(P){case"dashed":return[10,5];case"dotted":return[2,2];case"double":return[];default:return[]}},W=P=>{s.current&&h(P)},T=P=>{n(P),v&&o&&(o.paused?o.play():o.pause())},z=t.locked||!1,R=()=>j==="rtsp"&&m?`📹 RTSP
${m.substring(0,30)}...`:j==="url"&&g?S&&y?`📁 ${y}`:`🎥 Видео
${g.substring(0,30)}...`:`🎥 Видео
Нажмите для настройки`;return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!z,dragBoundFunc:a,opacity:z?.6:1,onClick:T,onTap:T,onDragEnd:r,onTransformEnd:W,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(A,{width:t.width,height:t.height,fill:j==="rtsp"?"#2c3e50":"#f39c12",listening:!1}),o&&C?e.jsx(ne,{image:o,x:C.position.x,y:C.position.y,width:C.position.width,height:C.position.height,crop:C.crop,listening:!1}):e.jsx($,{text:R(),x:0,y:0,width:t.width,height:t.height,fontSize:14,fontFamily:"Arial",fill:"#ffffff",align:"center",verticalAlign:"middle",listening:!1}),j==="rtsp"&&e.jsx(A,{x:10,y:10,width:45,height:20,fill:"#ff0000",cornerRadius:4,listening:!1}),j==="rtsp"&&e.jsx($,{text:"LIVE",x:10,y:13,width:45,fontSize:12,fontFamily:"Arial",fontWeight:"bold",fill:"#ffffff",align:"center",listening:!1}),o&&!o.paused&&e.jsx($,{text:"▶",x:t.width-30,y:10,fontSize:16,fontFamily:"Arial",fill:"#00ff00",listening:!1}),v&&o&&e.jsx($,{text:o.paused?"⏸ Пауза":"▶ Играет",x:10,y:t.height-30,fontSize:12,fontFamily:"Arial",fill:"#ffffff",listening:!1}),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1}),f&&e.jsx(A,{width:t.width,height:t.height,stroke:N,strokeWidth:E,dash:M(w),listening:!1})]})},lr=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),{shapeType:c="rectangle",fillColor:o="#4a90e2",strokeColor:d="#2c3e50",strokeWidth:p=0,cornerRadius:j=0,opacity:g=1}=t.properties,m=t.locked||!1,S=()=>{const y={fill:o,stroke:p>0?d:void 0,strokeWidth:p,opacity:g,listening:!1};switch(c){case"rectangle":return e.jsx(A,{x:0,y:0,width:t.width,height:t.height,cornerRadius:j,...y});case"circle":const u=Math.min(t.width,t.height)/2;return e.jsx(De,{x:t.width/2,y:t.height/2,radius:u,...y});case"ellipse":return e.jsx(Fe,{x:t.width/2,y:t.height/2,radiusX:t.width/2,radiusY:t.height/2,...y});case"triangle":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:3,radius:Math.min(t.width,t.height)/2,...y});case"pentagon":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:5,radius:Math.min(t.width,t.height)/2,...y});case"hexagon":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:6,radius:Math.min(t.width,t.height)/2,...y});case"star":return e.jsx(Ge,{x:t.width/2,y:t.height/2,numPoints:5,innerRadius:Math.min(t.width,t.height)/4,outerRadius:Math.min(t.width,t.height)/2,...y});case"diamond":return e.jsx(oe,{x:t.width/2,y:t.height/2,sides:4,radius:Math.min(t.width,t.height)/2,rotation:45,...y});case"line":return e.jsx(ee,{points:[0,t.height/2,t.width,t.height/2],stroke:d,strokeWidth:Math.max(p,2),opacity:g,listening:!1});case"arrow":const f=t.width,w=t.height,E=w*.6,N=w*.4;return e.jsx(ee,{points:[0,w/2-N/2,f-E,w/2-N/2,f-E,0,f,w/2,f-E,w,f-E,w/2+N/2,0,w/2+N/2],closed:!0,fill:o,stroke:p>0?d:void 0,strokeWidth:p,opacity:g,listening:!1});default:return e.jsx(A,{x:0,y:0,width:t.width,height:t.height,...y})}};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!m,dragBoundFunc:a,opacity:m?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),S(),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},cr=({widget:t,isSelected:i,onSelect:n,onDragEnd:r,onTransformEnd:h,dragBoundFunc:a})=>{const s=k.useRef(null),[c,o]=k.useState(null),[d,p]=k.useState(null),{orientation:j="horizontal",items:g=[{id:"1",label:"Главная"},{id:"2",label:"О нас"},{id:"3",label:"Услуги",children:[{id:"3-1",label:"Услуга 1"},{id:"3-2",label:"Услуга 2"}]},{id:"4",label:"Контакты"}],backgroundColor:m="#2c3e50",textColor:S="#ffffff",hoverColor:y="#34495e",fontSize:u=16,fontFamily:f="Arial",itemPadding:w=16,submenuBackgroundColor:E="#34495e",submenuTextColor:N="#ffffff",borderWidth:b=0,borderColor:I="#000000",itemHeight:l=40}=t.properties,v=t.locked||!1,x=j==="horizontal",C=T=>T.length*(u*.6)+w*2,M=()=>{const T=[];let z=0;return g.forEach((R,P)=>{const L=C(R.label),B=c===R.id,H=d===R.id,q=R.children&&R.children.length>0;T.push(e.jsx(A,{x:z,y:0,width:L,height:l,fill:B?y:m,listening:!0,onMouseEnter:()=>o(R.id),onMouseLeave:()=>o(null),onClick:()=>{q&&p(d===R.id?null:R.id)}},`bg-${R.id}`)),T.push(e.jsx($,{x:z,y:0,width:L,height:l,text:R.label,fontSize:u,fontFamily:f,fill:S,align:"center",verticalAlign:"middle",listening:!1},`text-${R.id}`)),q&&T.push(e.jsx($,{x:z+L-20,y:0,width:20,height:l,text:"▼",fontSize:10,fill:S,align:"center",verticalAlign:"middle",listening:!1},`arrow-${R.id}`)),P<g.length-1&&T.push(e.jsx(ee,{points:[z+L,5,z+L,l-5],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-${R.id}`)),H&&q&&R.children.forEach((_,G)=>{const Y=l+G*l,J=Math.max(L,C(_.label));T.push(e.jsx(A,{x:z,y:Y,width:J,height:l,fill:E,listening:!0,onMouseEnter:()=>o(_.id),onMouseLeave:()=>o(null)},`submenu-bg-${_.id}`)),T.push(e.jsx($,{x:z+w/2,y:Y,width:J-w/2,height:l,text:_.label,fontSize:u-2,fontFamily:f,fill:N,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`))}),z+=L}),T},W=()=>{const T=[];let z=0;const R=t.width;return g.forEach((P,L)=>{const B=c===P.id,H=d===P.id,q=P.children&&P.children.length>0;T.push(e.jsx(A,{x:0,y:z,width:R,height:l,fill:B?y:m,listening:!0,onMouseEnter:()=>o(P.id),onMouseLeave:()=>o(null),onClick:()=>{q&&p(d===P.id?null:P.id)}},`bg-${P.id}`)),T.push(e.jsx($,{x:w,y:z,width:R-w*2-(q?20:0),height:l,text:P.label,fontSize:u,fontFamily:f,fill:S,align:"left",verticalAlign:"middle",listening:!1},`text-${P.id}`)),q&&T.push(e.jsx($,{x:R-20,y:z,width:20,height:l,text:H?"▼":"▶",fontSize:10,fill:S,align:"center",verticalAlign:"middle",listening:!1},`arrow-${P.id}`)),z+=l,L<g.length-1&&!H&&T.push(e.jsx(ee,{points:[10,z,R-10,z],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-${P.id}`)),H&&q&&(P.children.forEach((_,G)=>{const Y=c===_.id;T.push(e.jsx(A,{x:0,y:z,width:R,height:l,fill:Y?y:E,listening:!0,onMouseEnter:()=>o(_.id),onMouseLeave:()=>o(null)},`submenu-bg-${_.id}`)),T.push(e.jsx($,{x:w*2,y:z,width:R-w*3,height:l,text:_.label,fontSize:u-2,fontFamily:f,fill:N,align:"left",verticalAlign:"middle",listening:!1},`submenu-text-${_.id}`)),z+=l}),L<g.length-1&&T.push(e.jsx(ee,{points:[10,z,R-10,z],stroke:I,strokeWidth:1,opacity:.3,listening:!1},`divider-after-${P.id}`)))}),T};return e.jsxs(K,{ref:s,id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation||0,draggable:!v,dragBoundFunc:a,opacity:v?.6:1,onClick:n,onTap:n,onDragEnd:r,onTransformEnd:h,children:[e.jsx(A,{width:t.width,height:t.height,fill:"transparent",listening:!0}),e.jsx(A,{width:t.width,height:t.height,fill:m,listening:!1}),b>0&&e.jsx(A,{width:t.width,height:t.height,stroke:I,strokeWidth:b,listening:!1}),x?M():W(),i&&e.jsx(A,{width:t.width,height:t.height,stroke:"#007acc",strokeWidth:2,listening:!1})]})},dr={shape:"#4a90e2",rectangle:"#4a90e2",button:"#2ecc71",text:"#e74c3c",image:"#9b59b6",video:"#f39c12"},hr=()=>{const{project:t,selectedWidgetIds:i,selectWidget:n,clearSelection:r,updateWidget:h,zoom:a,gridEnabled:s,snapToGrid:c,gridSize:o,gridLineWidth:d,gridColor:p,pendingWidget:j,addWidgetAtPosition:g,clearPendingWidget:m}=U(),S=k.useRef(null),y=k.useRef(null),u=l=>c?Math.round(l/o)*o:l,f=l=>({x:u(l.x),y:u(l.y)});if(k.useEffect(()=>{if(!y.current||!t)return;const l=S.current,v=i.map(x=>t.widgets.find(M=>M.id===x)?.locked?null:l.findOne(`#${x}`)).filter(Boolean);y.current.nodes(v),y.current.getLayer().batchDraw()},[i,t]),!t)return null;const w=l=>{if(j){const C=l.target.getStage().getPointerPosition();C&&g(C.x,C.y);return}(l.target===l.target.getStage()||l.target.attrs.id==="canvas-background")&&r()},E=(l,v)=>{v.cancelBubble=!0;const x=v.evt.ctrlKey||v.evt.metaKey;n(l,x)},N=(l,v)=>{const x=u(v.target.x()),C=u(v.target.y());h(l,{x,y:C})},b=(l,v)=>{const x=v.target,C=x.scaleX(),M=x.scaleY();x.scaleX(1),x.scaleY(1);const W=x.width?x.width():x.attrs.width||100,T=x.height?x.height():x.attrs.height||100;let z=Math.max(10,W*C),R=Math.max(10,T*M),P=x.x(),L=x.y();c&&(z=u(z),R=u(R),P=u(P),L=u(L)),h(l,{x:P,y:L,width:z,height:R,rotation:x.rotation()})},I=()=>{if(!s)return null;const l=[],{width:v,height:x}=t.canvas;for(let C=0;C<=v/o;C++)l.push(e.jsx(A,{x:C*o,y:0,width:d,height:x,fill:p},`v-${C}`));for(let C=0;C<=x/o;C++)l.push(e.jsx(A,{x:0,y:C*o,width:v,height:d,fill:p},`h-${C}`));return l};return e.jsxs("div",{className:"canvas-container",children:[e.jsx("div",{className:"canvas-scroll",children:e.jsx("div",{className:"canvas-wrapper",style:{transform:`scale(${a})`,transformOrigin:"top left",cursor:j?"crosshair":"default"},children:e.jsx(Ye,{ref:S,width:t.canvas.width,height:t.canvas.height,onClick:w,onTap:w,children:e.jsxs(Ke,{children:[e.jsx(A,{id:"canvas-background",x:0,y:0,width:t.canvas.width,height:t.canvas.height,fill:t.canvas.backgroundColor||"#ffffff"}),I(),t.widgets.slice().sort((l,v)=>(l.zIndex||0)-(v.zIndex||0)).map(l=>{const v=l.locked||!1;return l.type==="image"?e.jsxs(V.Fragment,{children:[e.jsx(sr,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="button"?e.jsxs(V.Fragment,{children:[e.jsx(nr,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="text"?e.jsxs(V.Fragment,{children:[e.jsx(ir,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="video"?e.jsxs(V.Fragment,{children:[e.jsx(ar,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="shape"||l.type==="rectangle"?e.jsxs(V.Fragment,{children:[e.jsx(lr,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):l.type==="menu"?e.jsxs(V.Fragment,{children:[e.jsx(cr,{widget:l,isSelected:i.includes(l.id),onSelect:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x),dragBoundFunc:c?f:void 0}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id):e.jsxs(V.Fragment,{children:[e.jsx(A,{id:l.id,x:l.x,y:l.y,width:l.width,height:l.height,rotation:l.rotation||0,fill:dr[l.type]||"#4a90e2",stroke:i.includes(l.id)?"#007acc":void 0,strokeWidth:i.includes(l.id)?2:0,opacity:v?.6:1,draggable:!v,onClick:x=>E(l.id,x),onTap:x=>E(l.id,x),onDragEnd:x=>N(l.id,x),onTransformEnd:x=>b(l.id,x)}),v&&e.jsx($,{x:l.x+5,y:l.y+5,text:"🔒",fontSize:16,listening:!1})]},l.id)}),e.jsx(Je,{ref:y,boundBoxFunc:(l,v)=>v.width<10||v.height<10?l:v})]})})})}),e.jsxs("div",{className:"canvas-info",children:[e.jsxs("span",{children:[t.canvas.width," × ",t.canvas.height," px"]}),i.length>0&&e.jsxs("span",{children:["Выбрано: ",i.length]})]})]})},pr=()=>{const{project:t,selectedWidgetIds:i,selectWidget:n,updateWidget:r,deleteWidget:h}=U();if(!t)return null;const a=o=>({shape:"🔷",rectangle:"🔷",text:"📝",button:"🔘",image:"🖼️",video:"🎬",menu:"🍔"})[o]||"⬜",s=o=>{if(o.properties.text){const d=o.properties.text.substring(0,20);return d.length<o.properties.text.length?`${d}...`:d}return o.properties.items?`Меню (${o.properties.items.length} пунктов)`:o.type.charAt(0).toUpperCase()+o.type.slice(1)},c=[...t.widgets].sort((o,d)=>(d.zIndex||0)-(o.zIndex||0));return e.jsxs("div",{className:"outline-panel",children:[e.jsxs("div",{className:"outline-header",children:[e.jsx("h3",{children:"Структура"}),e.jsxs("span",{className:"outline-count",children:[t.widgets.length," виджетов"]})]}),e.jsx("div",{className:"outline-list",children:c.length===0?e.jsxs("div",{className:"outline-empty",children:[e.jsx("p",{children:"Нет виджетов"}),e.jsx("span",{children:"Добавьте виджеты из библиотеки"})]}):c.map(o=>{const d=i.includes(o.id),p=o.locked||!1;return e.jsxs("div",{className:`outline-item ${d?"selected":""} ${p?"locked":""}`,onClick:()=>n(o.id,!1),children:[e.jsxs("div",{className:"outline-item-main",children:[e.jsx("span",{className:"outline-icon",children:a(o.type)}),e.jsxs("div",{className:"outline-info",children:[e.jsx("span",{className:"outline-label",children:s(o)}),e.jsxs("span",{className:"outline-meta",children:[o.width,"×",o.height," • z:",o.zIndex||0]})]})]}),e.jsxs("div",{className:"outline-actions",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{className:"outline-action-btn",onClick:()=>{r(o.id,{locked:!p})},title:p?"Разблокировать":"Заблокировать",children:p?e.jsx(pt,{size:14}):e.jsx(wt,{size:14})}),e.jsx("button",{className:"outline-action-btn delete",onClick:()=>{window.confirm(`Удалить виджет "${s(o)}"?`)&&h(o.id)},title:"Удалить",children:e.jsx($e,{size:14})})]})]},o.id)})})]})},ur=()=>{const{addWidget:t,project:i}=U(),n=[{type:"shape",name:"Фигура",icon:kt,defaultProps:{shapeType:"rectangle",fillColor:"#4a90e2",strokeColor:"#2c3e50",strokeWidth:0,cornerRadius:0,opacity:1}},{type:"button",name:"Кнопка",icon:gt,defaultProps:{text:"Нажми меня",backgroundColor:"#4a90e2",textColor:"#ffffff"}},{type:"text",name:"Текст",icon:St,defaultProps:{text:"Введите текст",fontSize:24,color:"#000000"}},{type:"image",name:"Изображение",icon:ht,defaultProps:{src:""}},{type:"video",name:"Видео",icon:Et,defaultProps:{src:"",autoplay:!1,loop:!1}},{type:"menu",name:"Меню",icon:ft,defaultProps:{orientation:"horizontal",items:[{id:"1",label:"Главная"},{id:"2",label:"О нас"},{id:"3",label:"Услуги",children:[{id:"3-1",label:"Услуга 1"},{id:"3-2",label:"Услуга 2"}]},{id:"4",label:"Контакты"}],backgroundColor:"#2c3e50",textColor:"#ffffff",hoverColor:"#34495e",fontSize:16,fontFamily:"Arial",itemPadding:16,submenuBackgroundColor:"#34495e",submenuTextColor:"#ffffff",borderWidth:0,borderColor:"#000000",itemHeight:40}}],r=(h,a)=>{if(!i)return;const{setPendingWidget:s}=U.getState();s(h,a)};return e.jsxs("div",{className:"widget-library panel",children:[e.jsx("div",{className:"widget-library-header",children:e.jsx("h3",{children:"Виджеты"})}),e.jsx("div",{className:"widget-library-content",children:n.map(h=>{const a=h.icon;return e.jsxs("button",{className:"widget-item",onClick:()=>r(h.type,h.defaultProps),title:`Добавить ${h.name}`,children:[e.jsx(a,{size:24}),e.jsx("span",{children:h.name})]},h.type)})}),e.jsx("div",{className:"widget-library-footer",children:e.jsx("button",{className:"btn-secondary",style:{width:"100%",fontSize:"12px"},children:"+ Импорт виджета"})}),e.jsx(pr,{})]})},xr="modulepreload",fr=function(t){return"/"+t},We={},Re=function(i,n,r){let h=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),c=s?.nonce||s?.getAttribute("nonce");h=o(n.map(d=>{if(d=fr(d),d in We)return;We[d]=!0;const p=d.endsWith(".css"),j=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${j}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":xr,p||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),p)return new Promise((m,S)=>{g.addEventListener("load",m),g.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=s,window.dispatchEvent(c),!c.defaultPrevented)throw s}return h.then(s=>{for(const c of s||[])c.status==="rejected"&&a(c.reason);return i().catch(a)})},Me=({widget:t,onUpdate:i,allWidgets:n})=>{const r=t.properties.actions||[],h=()=>{const c={type:"url",url:""};i([...r,c])},a=(c,o)=>{const d=[...r];d[c]={...d[c],...o},i(d)},s=c=>{const o=r.filter((d,p)=>p!==c);i(o)};return e.jsxs("div",{className:"action-editor",children:[e.jsx("h4",{style:{marginBottom:"12px",fontSize:"12px",color:"#aaa"},children:"Действия при клике"}),r.length===0&&e.jsx("div",{style:{padding:"16px",background:"#252525",borderRadius:"6px",textAlign:"center",color:"#888",fontSize:"13px",marginBottom:"12px"},children:"Нет действий. Добавьте действие ниже."}),r.map((c,o)=>e.jsxs("div",{className:"action-item",children:[e.jsxs("div",{className:"action-header",children:[e.jsxs("span",{className:"action-number",children:["#",o+1]}),e.jsx("button",{className:"btn-danger-small",onClick:()=>s(o),title:"Удалить действие",children:"🗑️"})]}),e.jsxs("div",{className:"action-body",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип действия"}),e.jsxs("select",{value:c.type,onChange:d=>a(o,{type:d.target.value}),children:[e.jsx("option",{value:"url",children:"🔗 Открыть URL"}),e.jsx("option",{value:"page",children:"📄 Перейти на страницу"}),e.jsx("option",{value:"popup",children:"💬 Показать popup"}),e.jsx("option",{value:"widget_show",children:"👁️ Показать виджет"}),e.jsx("option",{value:"widget_hide",children:"🙈 Скрыть виджет"}),e.jsx("option",{value:"video_play",children:"▶️ Воспроизвести видео"}),e.jsx("option",{value:"video_stop",children:"⏸️ Остановить видео"})]})]}),c.type==="url"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL адрес"}),e.jsx("input",{type:"text",value:c.url||"",onChange:d=>a(o,{url:d.target.value}),placeholder:"https://example.com"})]}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:c.openInNewTab||!1,onChange:d=>a(o,{openInNewTab:d.target.checked})}),"Открыть в новой вкладке"]})})]}),c.type==="page"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID страницы"}),e.jsx("input",{type:"text",value:c.pageId||"",onChange:d=>a(o,{pageId:d.target.value}),placeholder:"page-1"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Укажите ID страницы для перехода"})]}),c.type==="popup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Заголовок popup"}),e.jsx("input",{type:"text",value:c.popupTitle||"",onChange:d=>a(o,{popupTitle:d.target.value}),placeholder:"Заголовок"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Содержимое popup"}),e.jsx("textarea",{value:c.popupContent||"",onChange:d=>a(o,{popupContent:d.target.value}),rows:4,placeholder:"Текст сообщения..."})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"Ширина (px)"}),e.jsx("input",{type:"number",value:c.popupWidth||400,onChange:d=>a(o,{popupWidth:parseInt(d.target.value)}),min:200,max:1e3})]}),e.jsxs("div",{className:"property-field",style:{flex:1},children:[e.jsx("label",{children:"Высота (px)"}),e.jsx("input",{type:"number",value:c.popupHeight||300,onChange:d=>a(o,{popupHeight:parseInt(d.target.value)}),min:150,max:800})]})]})]}),(c.type==="widget_show"||c.type==="widget_hide")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Целевой виджет"}),e.jsxs("select",{value:c.targetWidgetId||"",onChange:d=>a(o,{targetWidgetId:d.target.value}),children:[e.jsx("option",{value:"",children:"Выберите виджет..."}),n.filter(d=>d.id!==t.id).map(d=>e.jsxs("option",{value:d.id,children:[d.type," - ",d.id]},d.id))]})]}),(c.type==="video_play"||c.type==="video_stop")&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Видео виджет"}),e.jsxs("select",{value:c.targetWidgetId||"",onChange:d=>a(o,{targetWidgetId:d.target.value}),children:[e.jsx("option",{value:"",children:"Выберите видео..."}),n.filter(d=>d.type==="video").map(d=>e.jsxs("option",{value:d.id,children:["Video - ",d.id]},d.id))]})]})]})]},o)),e.jsx("button",{className:"btn-secondary",onClick:h,style:{width:"100%",marginTop:"8px"},children:"➕ Добавить действие"})]})},gr=()=>{const{project:t,selectedWidgetIds:i,updateWidget:n}=U();if(!t)return null;const r=i.length===1?t.widgets.find(s=>s.id===i[0]):null,h=(s,c)=>{r&&n(r.id,{[s]:c})},a=(s,c)=>{r&&n(r.id,{properties:{...r.properties,[s]:c}})};return r?e.jsxs("div",{className:"properties-panel panel",children:[e.jsxs("div",{className:"properties-header",children:[e.jsx("h3",{children:"Свойства"}),e.jsx("span",{className:"widget-type-badge",children:r.type})]}),e.jsxs("div",{className:"properties-content",children:[e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"Позиция и размер"}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"X"}),e.jsx("input",{type:"number",value:Math.round(r.x),onChange:s=>h("x",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Y"}),e.jsx("input",{type:"number",value:Math.round(r.y),onChange:s=>h("y",parseFloat(s.target.value))})]})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Ширина"}),e.jsx("input",{type:"number",value:Math.round(r.width),onChange:s=>h("width",parseFloat(s.target.value)),min:1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Высота"}),e.jsx("input",{type:"number",value:Math.round(r.height),onChange:s=>h("height",parseFloat(s.target.value)),min:1})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Поворот (градусы)"}),e.jsx("input",{type:"number",value:Math.round(r.rotation||0),onChange:s=>h("rotation",parseFloat(s.target.value))})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Z-Index (порядок)"}),e.jsx("input",{type:"number",min:"0",value:r.zIndex||0,onChange:s=>h("zIndex",Math.max(0,parseInt(s.target.value)||0))}),e.jsxs("div",{style:{marginTop:"8px",display:"flex",gap:"4px"},children:[e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"На передний план",children:"⬆️ Наверх"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{},style:{flex:1,fontSize:"11px",padding:"4px"},title:"На задний план",children:"⬇️ Вниз"})]})]}),e.jsxs("div",{className:"property-field",style:{marginTop:"12px"},children:[e.jsx("button",{className:r.locked?"btn-danger":"btn-secondary",onClick:()=>{},style:{width:"100%"},children:r.locked?"🔒 Разблокировать":"🔓 Заблокировать"}),r.locked&&e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Заблокированный виджет нельзя перемещать и изменять размер"})]})]}),e.jsxs("div",{className:"property-section",children:[e.jsx("h4",{children:"Параметры виджета"}),r.type==="shape"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип фигуры"}),e.jsxs("select",{value:r.properties.shapeType||"rectangle",onChange:s=>a("shapeType",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"Прямоугольник"}),e.jsx("option",{value:"circle",children:"Круг"}),e.jsx("option",{value:"ellipse",children:"Эллипс"}),e.jsx("option",{value:"triangle",children:"Треугольник"}),e.jsx("option",{value:"pentagon",children:"Пятиугольник"}),e.jsx("option",{value:"hexagon",children:"Шестиугольник"}),e.jsx("option",{value:"star",children:"Звезда"}),e.jsx("option",{value:"diamond",children:"Ромб"}),e.jsx("option",{value:"line",children:"Линия"}),e.jsx("option",{value:"arrow",children:"Стрелка"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Заливка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет заливки"}),e.jsx("input",{type:"color",value:r.properties.fillColor||"#4a90e2",onChange:s=>a("fillColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Прозрачность"}),e.jsx("input",{type:"range",value:(r.properties.opacity||1)*100,onChange:s=>a("opacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.opacity||1)*100),"%"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Контур"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина контура"}),e.jsx("input",{type:"number",value:r.properties.strokeWidth||0,onChange:s=>a("strokeWidth",parseInt(s.target.value)),min:0,max:20})]}),r.properties.strokeWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет контура"}),e.jsx("input",{type:"color",value:r.properties.strokeColor||"#2c3e50",onChange:s=>a("strokeColor",s.target.value)})]}),r.properties.shapeType==="rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Скругление углов"}),e.jsx("input",{type:"number",value:r.properties.cornerRadius||0,onChange:s=>a("cornerRadius",parseInt(s.target.value)),min:0,max:100})]})]}),r.type==="button"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль кнопки"}),e.jsxs("select",{onChange:s=>{const c=s.target.value;c!=="custom"&&Re(async()=>{const{buttonStyles:o}=await import("./buttonStyles-VsZJSFTR.js");return{buttonStyles:o}},[]).then(({buttonStyles:o})=>{const d=o.find(p=>p.name===c);d&&n(r.id,{properties:{...r.properties,...d.properties}})})},children:[e.jsx("option",{value:"custom",children:"Пользовательский"}),e.jsx("option",{value:"По умолчанию",children:"По умолчанию"}),e.jsx("option",{value:"Основная",children:"Основная (синяя с тенью)"}),e.jsx("option",{value:"Успех",children:"Успех (зелёная)"}),e.jsx("option",{value:"Опасность",children:"Опасность (красная)"}),e.jsx("option",{value:"Контурная",children:"Контурная"}),e.jsx("option",{value:"Призрак",children:"Призрак"}),e.jsx("option",{value:"Градиент",children:"Градиент"}),e.jsx("option",{value:"Минимализм",children:"Минимализм"}),e.jsx("option",{value:"Неон",children:"Неон"}),e.jsx("option",{value:"Классика",children:"Классика"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Текст"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Текст кнопки"}),e.jsx("input",{type:"text",value:r.properties.text||"Button",onChange:s=>a("text",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:72})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Шрифт"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Начертание"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"bold",children:"Жирный"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Выравнивание"}),e.jsxs("select",{value:r.properties.textAlign||"center",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"По левому краю"}),e.jsx("option",{value:"center",children:"По центру"}),e.jsx("option",{value:"right",children:"По правому краю"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Фон"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2ecc71",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Скругление углов"}),e.jsx("input",{type:"number",value:r.properties.borderRadius||8,onChange:s=>a("borderRadius",parseInt(s.target.value)),min:0,max:50})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"})]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Тень"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.shadowEnabled||!1,onChange:s=>a("shadowEnabled",s.target.checked)}),"Включить тень"]})}),r.properties.shadowEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет тени"}),e.jsx("input",{type:"color",value:r.properties.shadowColor||"#000000",onChange:s=>a("shadowColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размытие"}),e.jsx("input",{type:"number",value:r.properties.shadowBlur||10,onChange:s=>a("shadowBlur",parseInt(s.target.value)),min:0,max:50})]}),e.jsxs("div",{className:"property-row",children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Смещение X"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetX||0,onChange:s=>a("shadowOffsetX",parseInt(s.target.value)),min:-50,max:50})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Смещение Y"}),e.jsx("input",{type:"number",value:r.properties.shadowOffsetY||4,onChange:s=>a("shadowOffsetY",parseInt(s.target.value)),min:-50,max:50})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Прозрачность"}),e.jsx("input",{type:"range",value:(r.properties.shadowOpacity||.3)*100,onChange:s=>a("shadowOpacity",parseInt(s.target.value)/100),min:0,max:100}),e.jsxs("span",{style:{fontSize:"11px",color:"#888"},children:[Math.round((r.properties.shadowOpacity||.3)*100),"%"]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Действия"}),e.jsx(Me,{widget:r,onUpdate:s=>{n(r.id,{properties:{...r.properties,actions:s}})},allWidgets:t.widgets})]}),r.type==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Текст"}),e.jsx("textarea",{value:r.properties.text||"Text",onChange:s=>a("text",s.target.value),rows:6})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить текстовый файл"}),e.jsx("input",{type:"file",accept:".txt,.pdf,.odt,.docx",onChange:async s=>{const c=s.target.files?.[0];if(c)try{const{extractTextFromFile:o,loadRequiredLibraries:d}=await Re(async()=>{const{extractTextFromFile:j,loadRequiredLibraries:g}=await import("./fileTextExtractor-HZqzU4jo.js");return{extractTextFromFile:j,loadRequiredLibraries:g}},[]);d(),a("text","Загрузка файла...");const p=await o(c);n(r.id,{properties:{...r.properties,text:p,sourceFile:c.name}})}catch(o){console.error("Error loading file:",o),alert(`Ошибка: ${o instanceof Error?o.message:"Не удалось загрузить файл"}`),a("text","Text")}s.target.value=""}}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Поддерживаются: TXT, PDF, ODT, DOCX"}),r.properties.sourceFile&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📄 ",r.properties.sourceFile]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Шрифт"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:8,max:144})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Семейство шрифта"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Comic Sans MS",children:"Comic Sans MS"}),e.jsx("option",{value:"Impact",children:"Impact"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Начертание"}),e.jsxs("select",{value:r.properties.fontWeight||"normal",onChange:s=>a("fontWeight",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"bold",children:"Жирный"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль"}),e.jsxs("select",{value:r.properties.fontStyle||"normal",onChange:s=>a("fontStyle",s.target.value),children:[e.jsx("option",{value:"normal",children:"Обычный"}),e.jsx("option",{value:"italic",children:"Курсив"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Декорация"}),e.jsxs("select",{value:r.properties.textDecoration||"none",onChange:s=>a("textDecoration",s.target.value),children:[e.jsx("option",{value:"none",children:"Нет"}),e.jsx("option",{value:"underline",children:"Подчёркнутый"}),e.jsx("option",{value:"line-through",children:"Зачёркнутый"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Выравнивание"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"По горизонтали"}),e.jsxs("select",{value:r.properties.textAlign||"left",onChange:s=>a("textAlign",s.target.value),children:[e.jsx("option",{value:"left",children:"По левому краю"}),e.jsx("option",{value:"center",children:"По центру"}),e.jsx("option",{value:"right",children:"По правому краю"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"По вертикали"}),e.jsxs("select",{value:r.properties.verticalAlign||"top",onChange:s=>a("verticalAlign",s.target.value),children:[e.jsx("option",{value:"top",children:"Сверху"}),e.jsx("option",{value:"middle",children:"По центру"}),e.jsx("option",{value:"bottom",children:"Снизу"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Цвета и фон"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#000000",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#ffffff",onChange:s=>a("backgroundColor",s.target.value)}),e.jsxs("label",{style:{marginTop:"4px",fontSize:"11px"},children:[e.jsx("input",{type:"checkbox",checked:r.properties.backgroundColor==="transparent",onChange:s=>a("backgroundColor",s.target.checked?"transparent":"#ffffff")}),"Прозрачный фон"]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Дополнительно"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Межстрочный интервал"}),e.jsx("input",{type:"number",value:r.properties.lineHeight||1.2,onChange:s=>a("lineHeight",parseFloat(s.target.value)),min:.5,max:3,step:.1})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Отступ от края"}),e.jsx("input",{type:"number",value:r.properties.padding||8,onChange:s=>a("padding",parseInt(s.target.value)),min:0,max:50})]})]}),r.type==="image"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"0",marginBottom:"12px",fontSize:"13px",fontWeight:"bold"},children:"Режим"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:!r.properties.galleryMode,onChange:()=>a("galleryMode",!1)})," ","Одиночное изображение"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"imageMode",checked:r.properties.galleryMode||!1,onChange:()=>{a("galleryMode",!0),r.properties.sources||a("sources",[])}})," ","Галерея изображений"]})}),!r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL изображения"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить файл"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{const c=s.target.files?.[0];if(c){const o=new FileReader;o.onload=d=>{const p=d.target?.result;p&&n(r.id,{properties:{...r.properties,src:p,isLocalFile:!0,fileName:c.name}})},o.readAsDataURL(c)}s.target.value=""}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📁 ",r.properties.fileName]})]})]}),r.properties.galleryMode&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Источники (макс. 50)"}),e.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"8px",marginBottom:"8px",backgroundColor:"#fafafa"},children:[(r.properties.sources||[]).map((s,c)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px",padding:"6px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #e0e0e0"},children:[e.jsxs("span",{style:{fontSize:"11px",color:"#666",minWidth:"20px"},children:[c+1,"."]}),e.jsx("span",{style:{fontSize:"11px",color:s.type==="url"?"#007acc":"#2ecc71"},children:s.type==="url"?"🌐":"📷"}),e.jsx("span",{style:{flex:1,fontSize:"11px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.value.length>40?s.value.substring(0,40)+"...":s.value}),e.jsx("button",{onClick:()=>{const o=(r.properties.sources||[]).filter((d,p)=>p!==c);a("sources",o)},style:{padding:"2px 6px",fontSize:"10px",border:"none",background:"#e74c3c",color:"#fff",borderRadius:"3px",cursor:"pointer"},children:"✕"})]},s.id)),(!r.properties.sources||r.properties.sources.length===0)&&e.jsx("div",{style:{textAlign:"center",color:"#999",fontSize:"11px",padding:"20px"},children:"Нет изображений в галерее"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,id:`gallery-upload-${r.id}`,style:{display:"none"},onChange:s=>{const c=Array.from(s.target.files||[]),o=r.properties.sources||[];if(o.length+c.length>50){alert("Максимум 50 изображений в галерее"),s.target.value="";return}let d=0;const p=[];c.forEach(j=>{const g=new FileReader;g.onload=m=>{const S=m.target?.result;S&&p.push({id:`img-${Date.now()}-${Math.random()}`,type:"local",value:S}),d++,d===c.length&&a("sources",[...o,...p])},g.readAsDataURL(j)}),s.target.value=""}}),e.jsx("button",{onClick:()=>{document.getElementById(`gallery-upload-${r.id}`)?.click()},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"📷 Добавить файлы"}),e.jsx("button",{onClick:()=>{const s=prompt("Введите URL изображения:");if(s){const c=r.properties.sources||[];if(c.length>=50){alert("Максимум 50 изображений в галерее");return}a("sources",[...c,{id:`img-${Date.now()}-${Math.random()}`,type:"url",value:s}])}},className:"btn-secondary",style:{flex:1,fontSize:"11px",padding:"6px"},children:"🌐 Добавить URL"})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Автопереключение"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoSwitch||!1,onChange:s=>a("autoSwitch",s.target.checked)})," ","Включить автопереключение"]})}),r.properties.autoSwitch&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Интервал (секунды)"}),e.jsx("input",{type:"number",min:"1",max:"60",value:r.properties.switchInterval||3,onChange:s=>a("switchInterval",parseInt(s.target.value)||3)})]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Эффекты перехода"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Эффект"}),e.jsxs("select",{value:r.properties.transition||"fade",onChange:s=>a("transition",s.target.value),children:[e.jsx("option",{value:"none",children:"Нет (мгновенно)"}),e.jsx("option",{value:"fade",children:"Затухание"}),e.jsx("option",{value:"slide",children:"Скольжение"}),e.jsx("option",{value:"zoom",children:"Увеличение"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Длительность (мс)"}),e.jsx("input",{type:"number",min:"100",max:"2000",step:"100",value:r.properties.transitionDuration||500,onChange:s=>a("transitionDuration",parseInt(s.target.value)||500)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Контролы"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showControls!==!1,onChange:s=>a("showControls",s.target.checked)})," ","Показать стрелки"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.showIndicators!==!1,onChange:s=>a("showIndicators",s.target.checked)})," ","Показать индикаторы"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop!==!1,onChange:s=>a("loop",s.target.checked)})," ","Зацикливание"]})})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип заполнения"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"Пропорционально (вписать)"}),e.jsx("option",{value:"cover",children:"Заполнить весь виджет"}),e.jsx("option",{value:"fill",children:"Растянуть"}),e.jsx("option",{value:"scale-down",children:"Оригинальный размер"}),e.jsx("option",{value:"adaptive",children:"Адаптивный (изменить виджет)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Форма обрезки"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Форма"}),e.jsxs("select",{value:r.properties.clipShape||"rectangle",onChange:s=>a("clipShape",s.target.value),children:[e.jsx("option",{value:"rectangle",children:"⬜ Прямоугольник"}),e.jsx("option",{value:"circle",children:"⚫ Круг"}),e.jsx("option",{value:"ellipse",children:"🔴 Эллипс"}),e.jsx("option",{value:"triangle",children:"🔺 Треугольник"}),e.jsx("option",{value:"diamond",children:"🔶 Ромб"}),e.jsx("option",{value:"pentagon",children:"⬢ Пятиугольник"}),e.jsx("option",{value:"hexagon",children:"⬡ Шестиугольник"}),e.jsx("option",{value:"octagon",children:"⭐ Восьмиугольник"}),e.jsx("option",{value:"rounded-rectangle",children:"🏷️ Закругленный прямоугольник"})]})]}),r.properties.clipShape==="rounded-rectangle"&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Радиус углов (px)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.properties.cornerRadius||20,onChange:s=>a("cornerRadius",parseInt(s.target.value)||20)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"Включить рамку"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"}),e.jsx("option",{value:"double",children:"Двойная"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки (px)"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseFloat(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="video"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип источника"}),e.jsxs("select",{value:r.properties.sourceType||"url",onChange:s=>a("sourceType",s.target.value),children:[e.jsx("option",{value:"url",children:"URL / Файл"}),e.jsx("option",{value:"rtsp",children:"RTSP поток"})]})]}),r.properties.sourceType==="rtsp"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"RTSP URL"}),e.jsx("input",{type:"text",value:r.properties.rtspUrl||"",onChange:s=>a("rtspUrl",s.target.value),placeholder:"rtsp://username:password@host:554/stream"}),e.jsx("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:"Пример: rtsp://admin:12345@192.168.1.100:554/live"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"URL видео"}),e.jsx("input",{type:"text",value:r.properties.src||"",onChange:s=>a("src",s.target.value),placeholder:"https://example.com/video.mp4"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Загрузить файл"}),e.jsx("input",{type:"file",accept:"video/*",onChange:async s=>{const c=s.target.files?.[0];if(c){if(c.size>524288e3){alert("⚠️ Файл слишком большой! Максимум 500 MB"),s.target.value="";return}try{if(console.log(`⏳ Загрузка видео (${(c.size/(1024*1024)).toFixed(1)} MB)...`),!t?.id){alert("❌ Сначала создайте или откройте проект"),s.target.value="";return}const d=await O.uploadFile(t.id,c);d&&(n(r.id,{properties:{...r.properties,src:d.url,isLocalFile:!1,fileName:c.name}}),alert("✅ Видео загружено на сервер!"))}catch(d){console.error("Upload error:",d),alert("❌ Ошибка загрузки: "+d.message)}s.target.value=""}}}),r.properties.isLocalFile&&r.properties.fileName&&e.jsxs("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:["📁 ",r.properties.fileName]})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Отображение"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Тип заполнения"}),e.jsxs("select",{value:r.properties.objectFit||"contain",onChange:s=>a("objectFit",s.target.value),children:[e.jsx("option",{value:"contain",children:"Пропорционально (вписать)"}),e.jsx("option",{value:"cover",children:"Заполнить весь виджет"}),e.jsx("option",{value:"fill",children:"Растянуть"}),e.jsx("option",{value:"scale-down",children:"Оригинальный размер"}),e.jsx("option",{value:"adaptive",children:"Адаптивный (изменить виджет)"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Воспроизведение"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.autoplay||!1,onChange:s=>a("autoplay",s.target.checked)}),"Автовоспроизведение"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.loop||!1,onChange:s=>a("loop",s.target.checked)}),"Повтор (loop)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.muted!==!1,onChange:s=>a("muted",s.target.checked)}),"Без звука (muted)"]})}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.controls!==!1,onChange:s=>a("controls",s.target.checked)}),"Показывать элементы управления"]})}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsx("div",{className:"property-field",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:r.properties.borderEnabled||!1,onChange:s=>a("borderEnabled",s.target.checked)}),"Включить рамку"]})}),r.properties.borderEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Стиль рамки"}),e.jsxs("select",{value:r.properties.borderStyle||"solid",onChange:s=>a("borderStyle",s.target.value),children:[e.jsx("option",{value:"solid",children:"Сплошная"}),e.jsx("option",{value:"dashed",children:"Штриховая"}),e.jsx("option",{value:"dotted",children:"Пунктирная"}),e.jsx("option",{value:"double",children:"Двойная"})]})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||2,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:1,max:20})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]})]})]}),r.type==="menu"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Ориентация"}),e.jsxs("select",{value:r.properties.orientation||"horizontal",onChange:s=>a("orientation",s.target.value),children:[e.jsx("option",{value:"horizontal",children:"Горизонтальная"}),e.jsx("option",{value:"vertical",children:"Вертикальная"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Внешний вид"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона"}),e.jsx("input",{type:"color",value:r.properties.backgroundColor||"#2c3e50",onChange:s=>a("backgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста"}),e.jsx("input",{type:"color",value:r.properties.textColor||"#ffffff",onChange:s=>a("textColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет при наведении"}),e.jsx("input",{type:"color",value:r.properties.hoverColor||"#34495e",onChange:s=>a("hoverColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Шрифт"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Размер шрифта"}),e.jsx("input",{type:"number",value:r.properties.fontSize||16,onChange:s=>a("fontSize",parseInt(s.target.value)),min:10,max:32})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Семейство шрифта"}),e.jsxs("select",{value:r.properties.fontFamily||"Arial",onChange:s=>a("fontFamily",s.target.value),children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Helvetica",children:"Helvetica"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"Verdana",children:"Verdana"}),e.jsx("option",{value:"Georgia",children:"Georgia"})]})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Размеры"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Высота пункта"}),e.jsx("input",{type:"number",value:r.properties.itemHeight||40,onChange:s=>a("itemHeight",parseInt(s.target.value)),min:30,max:100})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Отступ пункта"}),e.jsx("input",{type:"number",value:r.properties.itemPadding||16,onChange:s=>a("itemPadding",parseInt(s.target.value)),min:8,max:40})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Подменю"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет фона подменю"}),e.jsx("input",{type:"color",value:r.properties.submenuBackgroundColor||"#34495e",onChange:s=>a("submenuBackgroundColor",s.target.value)})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет текста подменю"}),e.jsx("input",{type:"color",value:r.properties.submenuTextColor||"#ffffff",onChange:s=>a("submenuTextColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Рамка"}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Толщина рамки"}),e.jsx("input",{type:"number",value:r.properties.borderWidth||0,onChange:s=>a("borderWidth",parseInt(s.target.value)),min:0,max:10})]}),r.properties.borderWidth>0&&e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Цвет рамки"}),e.jsx("input",{type:"color",value:r.properties.borderColor||"#000000",onChange:s=>a("borderColor",s.target.value)})]}),e.jsx("h4",{style:{marginTop:"16px",marginBottom:"8px",fontSize:"12px"},children:"Пункты меню"}),e.jsx("div",{className:"property-field",children:e.jsx("button",{className:"btn-secondary",onClick:()=>{const s=r.properties.items||[],c={id:`item-${Date.now()}`,label:"Новый пункт"};n(r.id,{properties:{...r.properties,items:[...s,c]}})},style:{width:"100%"},children:"➕ Добавить пункт"})}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:(r.properties.items||[]).map((s,c)=>e.jsxs("div",{style:{background:"#252525",padding:"12px",marginBottom:"8px",borderRadius:"6px",border:"1px solid #333"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("strong",{style:{fontSize:"12px",color:"#aaa"},children:["Пункт ",c+1]}),e.jsx("button",{className:"btn-danger",onClick:()=>{const o=r.properties.items||[];n(r.id,{properties:{...r.properties,items:o.filter(d=>d.id!==s.id)}})},style:{fontSize:"11px",padding:"4px 8px"},children:"🗑️ Удалить"})]}),e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"Название"}),e.jsx("input",{type:"text",value:s.label,onChange:o=>{const d=[...r.properties.items||[]];d[c]={...d[c],label:o.target.value},n(r.id,{properties:{...r.properties,items:d}})}})]}),e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"Действия при клике"}),e.jsx(Me,{widget:{...r,id:s.id,properties:s},onUpdate:o=>{const d=[...r.properties.items||[]];d[c]={...d[c],actions:o},n(r.id,{properties:{...r.properties,items:d}})},allWidgets:t.widgets})]}),e.jsxs("div",{style:{marginTop:"12px",paddingLeft:"12px",borderLeft:"2px solid #444"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#888",marginBottom:"8px"},children:"Подпункты"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{const o=[...r.properties.items||[]],d=o[c].children||[];o[c]={...o[c],children:[...d,{id:`subitem-${Date.now()}`,label:"Подпункт"}]},n(r.id,{properties:{...r.properties,items:o}})},style:{width:"100%",fontSize:"11px",padding:"6px",marginBottom:"8px"},children:"➕ Добавить подпункт"}),(s.children||[]).map((o,d)=>e.jsx("div",{style:{background:"#1e1e1e",padding:"8px",marginBottom:"6px",borderRadius:"4px",border:"1px solid #2a2a2a"},children:e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"text",value:o.label,onChange:p=>{const j=[...r.properties.items||[]],g=[...j[c].children||[]];g[d]={...g[d],label:p.target.value},j[c]={...j[c],children:g},n(r.id,{properties:{...r.properties,items:j}})},style:{flex:1,fontSize:"12px",padding:"4px 8px"}}),e.jsx("button",{className:"btn-danger",onClick:()=>{const p=[...r.properties.items||[]],j=p[c].children?.filter(g=>g.id!==o.id)||[];p[c]={...p[c],children:j},n(r.id,{properties:{...r.properties,items:p}})},style:{fontSize:"11px",padding:"4px 8px"},children:"🗑️"})]})},o.id))]})]},s.id))})]})]}),e.jsx("div",{className:"property-section",children:e.jsxs("div",{className:"property-field",children:[e.jsx("label",{children:"ID"}),e.jsx("input",{type:"text",value:r.id,disabled:!0,style:{opacity:.5,cursor:"not-allowed"}})]})})]})]}):e.jsxs("div",{className:"properties-panel panel",children:[e.jsx("div",{className:"properties-header",children:e.jsx("h3",{children:"Свойства"})}),e.jsx("div",{className:"properties-empty",children:e.jsx("p",{children:"Выберите виджет для редактирования"})})]})},mr=()=>{const t=Le(),[i,n]=k.useState(0),{project:r,restoreProject:h,selectedWidgetIds:a,copy:s,paste:c,cut:o,deleteWidget:d,undo:p,redo:j}=U();return k.useEffect(()=>{(async()=>{console.log("[Editor] Checking for project to restore...");const m=await h();console.log(m?"[Editor] Project restored successfully":"[Editor] No project to restore")})()},[]),k.useEffect(()=>{const g=S=>{const u=S.detail?.reason||"unknown";console.log("[Editor] Logout event received, reason:",u),u==="inactivity"&&sessionStorage.setItem("kiosk_logout_reason","inactivity"),t("/login",{replace:!0})},m=()=>{console.log("[Editor] Unauthorized event received"),sessionStorage.setItem("kiosk_logout_reason","session_expired"),t("/login",{replace:!0})};return window.addEventListener("auth:logout",g),window.addEventListener("auth:unauthorized",m),()=>{window.removeEventListener("auth:logout",g),window.removeEventListener("auth:unauthorized",m)}},[t]),k.useEffect(()=>{const g=m=>{(m.ctrlKey||m.metaKey)&&m.key==="z"&&!m.shiftKey&&(m.preventDefault(),p()),(m.ctrlKey||m.metaKey)&&m.key==="z"&&m.shiftKey&&(m.preventDefault(),j()),(m.ctrlKey||m.metaKey)&&m.key==="c"&&(m.preventDefault(),s()),(m.ctrlKey||m.metaKey)&&m.key==="v"&&(m.preventDefault(),c()),(m.ctrlKey||m.metaKey)&&m.key==="x"&&(m.preventDefault(),o()),m.key==="Delete"&&(m.preventDefault(),a.forEach(S=>d(S)))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[]),k.useEffect(()=>{const g=()=>{n(m=>m+1)};return window.addEventListener("auth:login",g),()=>window.removeEventListener("auth:login",g)},[]),e.jsxs("div",{className:"editor",children:[e.jsx(At,{}),e.jsx(er,{}),e.jsxs("div",{className:"editor-main",children:[e.jsx(ur,{}),e.jsx(hr,{}),e.jsx(gr,{})]})]})},jr=({children:t})=>O.isAuthenticated()?e.jsx(e.Fragment,{children:t}):(console.log("[ProtectedRoute] Not authenticated, redirecting to /login"),e.jsx(fe,{to:"/login",replace:!0})),vr=()=>(console.log("[App.tsx] App component rendering with Router"),e.jsx(Ve,{children:e.jsxs(Xe,{children:[e.jsx(re,{path:"/",element:e.jsx(fe,{to:"/login",replace:!0})}),e.jsx(re,{path:"/login",element:e.jsx(Wt,{})}),e.jsx(re,{path:"/editor",element:e.jsx(jr,{children:e.jsx(mr,{})})}),e.jsx(re,{path:"*",element:e.jsx(fe,{to:"/login",replace:!0})}),e.jsx(re,{path:"/preview",element:e.jsx(Mt,{})})]})}));try{const t=document.getElementById("root");if(!t)throw new Error("Root element not found");rt.createRoot(t).render(e.jsx(V.StrictMode,{children:e.jsx(vr,{})}))}catch(t){console.error("Failed to mount React app:",t),document.body.innerHTML=`
    <div style="
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #1e1e1e;
      color: #ff6b6b;
      font-family: Arial, sans-serif;
      padding: 20px;
    ">
      <div style="text-align: center; max-width: 600px;">
        <h1>❌ Ошибка загрузки редактора</h1>
        <p style="color: #cccccc;">Проверьте консоль браузера (F12) для деталей.</p>
        <pre style="
          text-align: left;
          background: #2a2a2a;
          padding: 15px;
          border-radius: 5px;
          overflow-x: auto;
          color: #ff6b6b;
        ">${t}</pre>
        <button onclick="location.reload()" style="
          margin-top: 20px;
          padding: 10px 20px;
          background: #4a90e2;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        ">
          Перезагрузить страницу
        </button>
      </div>
    </div>
  `}
//# sourceMappingURL=index-ByLkIlC9.js.map
